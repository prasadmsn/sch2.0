
function w2ui_hide_items_flyout(){var n=$("#w2ui-global-items"),t;!window.w2uiIsflyout&&n.length>0&&(t=n.data("hide"),t?(n.data("hide",null),t()):n.remove())}var w2ui=w2ui||{},w2obj=w2obj||{},w2utils=function(){function t(n){var t=/^[-]?[0-9]+$/;return t.test(n)}function i(n){var t=new RegExp(w2utils.settings.float);return t.test(n)}function r(n){var t=new RegExp(w2utils.settings.currency);return t.test(n)}function u(n){return/^[a-fA-F0-9]+$/.test(n)}function f(n){return/^[a-zA-Z0-9_-]+$/.test(n)}function e(n){return/^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(n)}function o(n,t,i){if(!n)return!1;t||(t=w2utils.settings.date_format);var r=n.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/"),o=t.replace(/-/g,"/").replace(/\./g,"/").toLowerCase(),s="Invalid Date",u,f,e;return(o=="mm/dd/yyyy"&&(u=r[0],f=r[1],e=r[2]),o=="m/d/yyyy"&&(u=r[0],f=r[1],e=r[2]),o=="dd/mm/yyyy"&&(u=r[1],f=r[0],e=r[2]),o=="d/m/yyyy"&&(u=r[1],f=r[0],e=r[2]),o=="yyyy/dd/mm"&&(u=r[2],f=r[1],e=r[0]),o=="yyyy/d/m"&&(u=r[2],f=r[1],e=r[0]),o=="yyyy/mm/dd"&&(u=r[1],f=r[2],e=r[0]),o=="yyyy/m/d"&&(u=r[1],f=r[2],e=r[0]),o=="mm/dd/yy"&&(u=r[0],f=r[1],e=parseInt(r[2])+1900),o=="m/d/yy"&&(u=r[0],f=r[1],e=parseInt(r[2])+1900),o=="dd/mm/yy"&&(u=r[1],f=r[0],e=parseInt(r[2])+1900),o=="d/m/yy"&&(u=r[1],f=r[0],e=parseInt(r[2])+1900),o=="yy/dd/mm"&&(u=r[2],f=r[1],e=parseInt(r[0])+1900),o=="yy/d/m"&&(u=r[2],f=r[1],e=parseInt(r[0])+1900),o=="yy/mm/dd"&&(u=r[1],f=r[2],e=parseInt(r[0])+1900),o=="yy/m/d"&&(u=r[1],f=r[2],e=parseInt(r[0])+1900),s=new Date(u+"/"+f+"/"+e),typeof u=="undefined")?!1:s=="Invalid Date"?!1:s.getMonth()+1!=u||s.getDate()!=f||s.getFullYear()!=e?!1:i===!0?s:!0}function s(n){var i,t;return String(n)=="undefined"?!1:(n=n.toUpperCase(),i=n.indexOf("PM")>=0||n.indexOf("AM")>=0?12:23,n=$.trim(n.replace("AM","")),n=$.trim(n.replace("PM","")),t=n.split(":"),t.length!=2)?!1:t[0]==""||parseInt(t[0])<0||parseInt(t[0])>i||!this.isInt(t[0])?!1:t[1]==""||parseInt(t[1])<0||parseInt(t[1])>59||!this.isInt(t[1])?!1:!0}function h(n){var f,i;if(n==""||typeof n=="undefined"||n==null||(w2utils.isInt(n)&&(n=Number(n)),f=new Date(n),w2utils.isInt(n)&&(f=new Date(Number(n))),i=String(n).split("-"),i.length==3&&(f=new Date(i[0],Number(i[1])-1,i[2])),i=String(n).split("/"),i.length==3&&(f=new Date(i[2],Number(i[0])-1,i[1])),f=="Invalid Time"))return"";var e=new Date,t=(e.getTime()-f.getTime())/1e3,r="",u="";return t<60?(r=Math.floor(t),u="sec",t<0&&(r=0,u="sec")):t<3600?(r=Math.floor(t/60),u="min"):t<86400?(r=Math.floor(t/3600),u="hour"):t<2592e3?(r=Math.floor(t/86400),u="day"):t<31104e3?(r=Math.floor(t/259200)/10,u="month"):t>=31104e3&&(r=Math.floor(t/3110400)/10,u="year"),r+" "+u+(r>1?"s":"")}function c(n){var e=w2utils.settings.shortmonths,t,i,u,r;if(n==""||typeof n=="undefined"||n==null||(w2utils.isInt(n)&&(n=Number(n)),t=new Date(n),w2utils.isInt(n)&&(t=new Date(Number(n))),i=String(n).split("-"),i.length==3&&(t=new Date(i[0],Number(i[1])-1,i[2])),i=String(n).split("/"),i.length==3&&(t=new Date(i[2],Number(i[0])-1,i[1])),t=="Invalid Date"))return"";u=new Date;r=new Date;r.setTime(r.getTime()-864e5);var f=e[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear(),s=e[u.getMonth()]+" "+u.getDate()+", "+u.getFullYear(),h=e[r.getMonth()]+" "+r.getDate()+", "+r.getFullYear(),c=t.getHours()-(t.getHours()>12?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+" "+(t.getHours()>=12?"pm":"am"),l=t.getHours()-(t.getHours()>12?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+" "+(t.getHours()>=12?"pm":"am"),o=f;return f==s&&(o=c),f==h&&(o=w2utils.lang("Yesterday")),'<span title="'+f+" "+l+'">'+o+"<\/span>"}function l(n){if(!w2utils.isFloat(n)||n=="")return"";if(n=parseFloat(n),n==0)return 0;var t=parseInt(Math.floor(Math.log(n)/Math.log(1024)));return(Math.floor(n/Math.pow(1024,t)*10)/10).toFixed(t==0?0:1)+" "+["Bt","KB","MB","GB","TB"][t]}function a(n){var t="";return(w2utils.isFloat(n)||w2utils.isInt(n)||w2utils.isMoney(n))&&(t=String(n).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")),t}function v(n,t){var o=w2utils.settings.shortmonths,s=w2utils.settings.fullmonths,r,i;if((typeof t=="undefined"&&(t=this.settings.date_format),typeof n=="undefined"||n==""||n==null)||(r=new Date(n),w2utils.isInt(n)&&(r=new Date(Number(n))),i=String(n).split("-"),i.length==3&&(r=new Date(i[0],Number(i[1])-1,i[2])),i=String(n).split("/"),i.length==3&&(r=new Date(i[2],Number(i[0])-1,i[1])),r=="Invalid Date"))return"";var u=r.getFullYear(),f=r.getMonth(),e=r.getDate();return t.toLowerCase().replace("month",w2utils.settings.fullmonths[f]).replace("mon",w2utils.settings.shortmonths[f]).replace(/yyyy/g,u).replace(/yyy/g,u).replace(/yy/g,u>2e3?100+parseInt(String(u).substr(2)):String(u).substr(2)).replace(/(^|[^a-z$])y/g,"$1"+u).replace(/mm/g,(f+1<10?"0":"")+(f+1)).replace(/dd/g,(e<10?"0":"")+e).replace(/(^|[^a-z$])m/g,"$1"+(f+1)).replace(/(^|[^a-z$])d/g,"$1"+e)}function y(n,t){var s=w2utils.settings.shortmonths,h=w2utils.settings.fullmonths,i;if((typeof t=="undefined"&&(t=this.settings.time_format),typeof n=="undefined"||n==""||n==null)||(i=new Date(n),w2utils.isInt(n)&&(i=new Date(Number(n))),i=="Invalid Date"))return"";var e="am",r=i.getHours(),o=i.getHours(),u=i.getMinutes(),f=i.getSeconds();return u<10&&(u="0"+u),f<10&&(f="0"+f),(t.indexOf("am")!=-1||t.indexOf("pm")!=-1)&&(r>=12&&(e="pm"),r>12&&(r=r-12)),t.toLowerCase().replace("am",e).replace("pm",e).replace("hh",r).replace("h24",o).replace("mm",u).replace("mi",u).replace("ss",f).replace(/(^|[^a-z$])h/g,"$1"+r).replace(/(^|[^a-z$])m/g,"$1"+u).replace(/(^|[^a-z$])s/g,"$1"+f)}function p(n,t){var i;return i=typeof t!="string"?[this.settings.date_format,this.settings.time_format]:t.split("|"),this.formatDate(n,i[0])+" "+this.formatTime(n,i[1])}function w(n){if(n==null)return n;switch(typeof n){case"string":n=$.trim(String(n).replace(/(<([^>]+)>)/ig,""));break;case"object":for(var t in n)n[t]=this.stripTags(n[t])}return n}function b(n){if(n==null)return n;switch(typeof n){case"string":n=String(n).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case"object":for(var t in n)n[t]=this.encodeTags(n[t])}return n}function k(n){return typeof n=="undefined"||n==""||n==null?"":String(n).replace(/([;&,\.\+\*\~'`:"\!\^#$%@\[\]\(\)=<>\|\/? {}\\])/g,"\\$1")}function d(n){function l(n){for(var t,n=String(n).replace(/\r\n/g,"\n"),i="",r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i}var e="",o,t,i,h,c,s,r,u=0,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(n=l(n);u<n.length;)o=n.charCodeAt(u++),t=n.charCodeAt(u++),i=n.charCodeAt(u++),h=o>>2,c=(o&3)<<4|t>>4,s=(t&15)<<2|i>>6,r=i&63,isNaN(t)?s=r=64:isNaN(i)&&(r=64),e=e+f.charAt(h)+f.charAt(c)+f.charAt(s)+f.charAt(r);return e}function g(n){function l(n){for(var r="",t=0,i=0,u=0;t<n.length;)i=n.charCodeAt(t),i<128?(r+=String.fromCharCode(i),t++):i>191&&i<224?(u=n.charCodeAt(t+1),r+=String.fromCharCode((i&31)<<6|u&63),t+=2):(u=n.charCodeAt(t+1),c3=n.charCodeAt(t+2),r+=String.fromCharCode((i&15)<<12|(u&63)<<6|c3&63),t+=3);return r}var t="",o,s,h,c,f,r,e,i=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<n.length;)c=u.indexOf(n.charAt(i++)),f=u.indexOf(n.charAt(i++)),r=u.indexOf(n.charAt(i++)),e=u.indexOf(n.charAt(i++)),o=c<<2|f>>4,s=(f&15)<<4|r>>2,h=(r&3)<<6|e,t=t+String.fromCharCode(o),r!=64&&(t=t+String.fromCharCode(s)),e!=64&&(t=t+String.fromCharCode(h));return l(t)}function nt(n,t,i,r){function u(n,t,i){var r=!!window.webkitURL;return r||typeof i=="undefined"||(t=i),";"+n+": "+t+"; -webkit-"+n+": "+t+"; -moz-"+n+": "+t+"; -ms-"+n+": "+t+"; -o-"+n+": "+t+";"}var e=$(n).width(),o=$(n).height(),f=.5;if(!n||!t){console.log("ERROR: Cannot do transition when one of the divs is null");return}n.parentNode.style.cssText+=u("perspective","700px")+"; overflow: hidden;";n.style.cssText+="; position: absolute; z-index: 1019; "+u("backface-visibility","hidden");t.style.cssText+="; position: absolute; z-index: 1020; "+u("backface-visibility","hidden");switch(i){case"slide-left":n.style.cssText+="overflow: hidden; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)");t.style.cssText+="overflow: hidden; "+u("transform","translate3d("+e+"px, 0, 0)","translate("+e+"px, 0)");$(t).show();window.setTimeout(function(){t.style.cssText+=u("transition",f+"s")+";"+u("transform","translate3d(0, 0, 0)","translate(0, 0)");n.style.cssText+=u("transition",f+"s")+";"+u("transform","translate3d(-"+e+"px, 0, 0)","translate(-"+e+"px, 0)")},1);break;case"slide-right":n.style.cssText+="overflow: hidden; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)");t.style.cssText+="overflow: hidden; "+u("transform","translate3d(-"+e+"px, 0, 0)","translate(-"+e+"px, 0)");$(t).show();window.setTimeout(function(){t.style.cssText+=u("transition",f+"s")+"; "+u("transform","translate3d(0px, 0, 0)","translate(0px, 0)");n.style.cssText+=u("transition",f+"s")+"; "+u("transform","translate3d("+e+"px, 0, 0)","translate("+e+"px, 0)")},1);break;case"slide-down":n.style.cssText+="overflow: hidden; z-index: 1; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)");t.style.cssText+="overflow: hidden; z-index: 0; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)");$(t).show();window.setTimeout(function(){t.style.cssText+=u("transition",f+"s")+"; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)");n.style.cssText+=u("transition",f+"s")+"; "+u("transform","translate3d(0, "+o+"px, 0)","translate(0, "+o+"px)")},1);break;case"slide-up":n.style.cssText+="overflow: hidden; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)");t.style.cssText+="overflow: hidden; "+u("transform","translate3d(0, "+o+"px, 0)","translate(0, "+o+"px)");$(t).show();window.setTimeout(function(){t.style.cssText+=u("transition",f+"s")+"; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)");n.style.cssText+=u("transition",f+"s")+"; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)")},1);break;case"flip-left":n.style.cssText+="overflow: hidden; "+u("-transform","rotateY(0deg)");t.style.cssText+="overflow: hidden; "+u("transform","rotateY(-180deg)");$(t).show();window.setTimeout(function(){t.style.cssText+=u("transition",f+"s")+"; "+u("transform","rotateY(0deg)");n.style.cssText+=u("transition",f+"s")+"; "+u("transform","rotateY(180deg)")},1);break;case"flip-right":n.style.cssText+="overflow: hidden; "+u("transform","rotateY(0deg)");t.style.cssText+="overflow: hidden; "+u("transform","rotateY(180deg)");$(t).show();window.setTimeout(function(){t.style.cssText+=u("transition",f+"s")+"; "+u("transform","rotateY(0deg)");n.style.cssText+=u("transition",f+"s")+"; "+u("transform","rotateY(-180deg)")},1);break;case"flip-down":n.style.cssText+="overflow: hidden; "+u("transform","rotateX(0deg)");t.style.cssText+="overflow: hidden; "+u("transform","rotateX(180deg)");$(t).show();window.setTimeout(function(){t.style.cssText+=u("transition",f+"s")+"; "+u("transform","rotateX(0deg)");n.style.cssText+=u("transition",f+"s")+"; "+u("transform","rotateX(-180deg)")},1);break;case"flip-up":n.style.cssText+="overflow: hidden; "+u("transform","rotateX(0deg)");t.style.cssText+="overflow: hidden; "+u("transform","rotateX(-180deg)");$(t).show();window.setTimeout(function(){t.style.cssText+=u("transition",f+"s")+"; "+u("transform","rotateX(0deg)");n.style.cssText+=u("transition",f+"s")+"; "+u("transform","rotateX(180deg)")},1);break;case"pop-in":n.style.cssText+="overflow: hidden; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)");t.style.cssText+="overflow: hidden; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; "+u("transform","scale(.8)")+"; opacity: 0;";$(t).show();window.setTimeout(function(){t.style.cssText+=u("transition",f+"s")+"; "+u("transform","scale(1)")+"; opacity: 1;";n.style.cssText+=u("transition",f+"s")+";"},1);break;case"pop-out":n.style.cssText+="overflow: hidden; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; "+u("transform","scale(1)")+"; opacity: 1;";t.style.cssText+="overflow: hidden; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; opacity: 0;";$(t).show();window.setTimeout(function(){t.style.cssText+=u("transition",f+"s")+"; opacity: 1;";n.style.cssText+=u("transition",f+"s")+"; "+u("transform","scale(1.7)")+"; opacity: 0;"},1);break;default:n.style.cssText+="overflow: hidden; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)");t.style.cssText+="overflow: hidden; "+u("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; opacity: 0;";$(t).show();window.setTimeout(function(){t.style.cssText+=u("transition",f+"s")+"; opacity: 1;";n.style.cssText+=u("transition",f+"s")},1)}setTimeout(function(){i=="slide-down"&&($(n).css("z-index","1019"),$(t).css("z-index","1020"));t&&$(t).css({opacity:"1","-webkit-transition":"","-moz-transition":"","-ms-transition":"","-o-transition":"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"","-webkit-backface-visibility":"","-moz-backface-visibility":"","-ms-backface-visibility":"","-o-backface-visibility":""});n&&($(n).css({opacity:"1","-webkit-transition":"","-moz-transition":"","-ms-transition":"","-o-transition":"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"","-webkit-backface-visibility":"","-moz-backface-visibility":"","-ms-backface-visibility":"","-o-backface-visibility":""}),n.parentNode&&$(n.parentNode).css({"-webkit-perspective":"","-moz-perspective":"","-ms-perspective":"","-o-perspective":""}));typeof r=="function"&&r()},f*1e3)}function tt(n,t,i){t||t==0||(t="");w2utils.unlock(n);$(n).find(">:first-child").before('<div class="w2ui-lock"><\/div><div class="w2ui-lock-msg"><\/div>');setTimeout(function(){var r=$(n).find(".w2ui-lock"),u=$(n).find(".w2ui-lock-msg");r.data("old_opacity",r.css("opacity")).css("opacity","0").show();u.data("old_opacity",u.css("opacity")).css("opacity","0").show();setTimeout(function(){var u=$(n).find(".w2ui-lock"),r=$(n).find(".w2ui-lock-msg"),f=($(n).width()-w2utils.getSize(r,"width"))/2,e=($(n).height()*.9-w2utils.getSize(r,"height"))/2;u.css({opacity:u.data("old_opacity"),left:"0px",top:"0px",width:"100%",height:"100%"});t||r.css({"background-color":"transparent",border:"0px"});i===!0&&(t='<div class="w2ui-spinner" '+(t?"":'style="width: 30px; height: 30px"')+"><\/div>"+t);r.html(t).css({opacity:r.data("old_opacity"),left:f+"px",top:e+"px"})},10)},10);$().w2tag()}function it(n){$(n).find(".w2ui-lock").remove();$(n).find(".w2ui-lock-msg").remove()}function rt(n,t){var i={left:parseInt($(n).css("border-left-width"))||0,right:parseInt($(n).css("border-right-width"))||0,top:parseInt($(n).css("border-top-width"))||0,bottom:parseInt($(n).css("border-bottom-width"))||0},r={left:parseInt($(n).css("margin-left"))||0,right:parseInt($(n).css("margin-right"))||0,top:parseInt($(n).css("margin-top"))||0,bottom:parseInt($(n).css("margin-bottom"))||0},u={left:parseInt($(n).css("padding-left"))||0,right:parseInt($(n).css("padding-right"))||0,top:parseInt($(n).css("padding-top"))||0,bottom:parseInt($(n).css("padding-bottom"))||0};switch(t){case"top":return i.top+r.top+u.top;case"bottom":return i.bottom+r.bottom+u.bottom;case"left":return i.left+r.left+u.left;case"right":return i.right+r.right+u.right;case"width":return i.left+i.right+r.left+r.right+u.left+u.right+parseInt($(n).width());case"height":return i.top+i.bottom+r.top+r.bottom+u.top+u.bottom+parseInt($(n).height());case"+width":return i.left+i.right+r.left+r.right+u.left+u.right;case"+height":return i.top+i.bottom+r.top+r.bottom+u.top+u.bottom}return 0}function ut(n){var t=this.settings.phrases[n];return typeof t=="undefined"?n:t}function ft(n){n||(n="en-us");n.length==5&&(n="locale/"+n+".json");$.ajax({url:n,type:"GET",dataType:"JSON",async:!1,cache:!1,success:function(n){var t,i;w2utils.settings=$.extend(!0,w2utils.settings,n);t=w2obj.grid.prototype;for(i in t.buttons)t.buttons[i].caption=w2utils.lang(t.buttons[i].caption),t.buttons[i].hint=w2utils.lang(t.buttons[i].hint);t.msgDelete=w2utils.lang(t.msgDelete);t.msgNotJSON=w2utils.lang(t.msgNotJSON);t.msgRefresh=w2utils.lang(t.msgRefresh)},error:function(){console.log("ERROR: Cannot load locale "+n)}})}function et(){if(n.scrollBarSize)return n.scrollBarSize;return $("body").append('<div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">\t<div style="height: 120px">1<\/div><\/div>'),n.scrollBarSize=100-$("#_scrollbar_width > div").width(),$("#_scrollbar_width").remove(),String(navigator.userAgent).indexOf("MSIE")>=0&&(n.scrollBarSize=n.scrollBarSize/2),n.scrollBarSize}var n={};return{settings:{locale:"en-us",date_format:"m/d/yyyy",date_display:"Mon d, yyyy",time_format:"hh:mi pm",currency:"^[$€£¥]?[-]?[0-9]*[.]?[0-9]+$",currencySymbol:"$",float:"^[-]?[0-9]*[.]?[0-9]+$",shortmonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullmonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortdays:["M","T","W","T","F","S","S"],fulldays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],RESTfull:!1,phrases:{}},isInt:t,isFloat:i,isMoney:r,isHex:u,isAlphaNumeric:f,isEmail:e,isDate:o,isTime:s,age:h,date:c,size:l,formatNumber:a,formatDate:v,formatTime:y,formatDateTime:p,stripTags:w,encodeTags:b,escapeId:k,base64encode:d,base64decode:g,transition:nt,lock:tt,unlock:it,lang:ut,locale:ft,getSize:rt,scrollBarSize:et}}(),w2popup,w2alert,w2confirm;if(w2utils.event={on:function(n,t){if($.isPlainObject(n)||(n={type:n}),n=$.extend({type:null,execute:"before",target:null,onComplete:null},n),typeof n.type=="undefined"){console.log("ERROR: You must specify event type when calling .on() method of "+this.name);return}if(typeof t=="undefined"){console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name);return}this.handlers.push({event:n,handler:t})},off:function(n,t){var r,u,i;if($.isPlainObject(n)||(n={type:n}),n=$.extend({},{type:null,execute:"before",target:null,onComplete:null},n),typeof n.type=="undefined"){console.log("ERROR: You must specify event type when calling .off() method of "+this.name);return}typeof t=="undefined"&&(t=null);r=[];for(u in this.handlers)i=this.handlers[u],(i.event.type==n.type||n.type=="*")&&(i.event.target==n.target||n.target==null)&&(i.handler==t||t==null)||r.push(i);this.handlers=r},trigger:function(n){var n=$.extend({type:null,phase:"before",target:null,isStopped:!1,isCancelled:!1},n,{preventDefault:function(){this.isCancelled=!0},stopPropagation:function(){this.isStopped=!0}}),e,t,i,r,f;for(typeof n.target=="undefined"&&(n.target=null),e=this.handlers.length-1;e>=0;e--)if(t=this.handlers[e],(t.event.type==n.type||t.event.type=="*")&&(t.event.target==n.target||t.event.target==null)&&(t.event.execute==n.phase||t.event.execute=="*"||t.event.phase=="*")&&(n=$.extend({},t.event,n),i=[],r=RegExp(/\((.*?)\)/).exec(t.handler),r&&(i=r[1].split(/\s*,\s*/)),i.length==2?t.handler.call(this,n.target,n):t.handler.call(this,n),n.isStopped===!0||n.stop===!0))return n;if(f="on"+n.type.substr(0,1).toUpperCase()+n.type.substr(1),n.phase=="before"&&typeof this[f]=="function"){var u=this[f],i=[],r=RegExp(/\((.*?)\)/).exec(u);if(r&&(i=r[1].split(/\s*,\s*/)),i.length==2?u.call(this,n.target,n):u.call(this,n),n.isStopped===!0||n.stop===!0)return n}if(typeof n.object!="undefined"&&n.object!=null&&n.phase=="before"&&typeof n.object[f]=="function"){var u=n.object[f],i=[],r=RegExp(/\((.*?)\)/).exec(u);if(r&&(i=r[1].split(/\s*,\s*/)),i.length==2?u.call(this,n.target,n):u.call(this,n),n.isStopped===!0||n.stop===!0)return n}return n.phase=="after"&&n.onComplete!=null&&n.onComplete.call(this,n),n}},w2utils.keyboard=function(n){function i(){$(document).on("keydown",r);$(document).on("mousedown",u)}function r(n){var i=n.target.tagName;$.inArray(i,["INPUT","SELECT","TEXTAREA"])==-1&&$(n.target).prop("contenteditable")!="true"&&t&&w2ui[t]&&typeof w2ui[t].keydown=="function"&&w2ui[t].keydown.call(w2ui[t],n)}function u(n){var r=n.target.tagName,i=$(n.target).parents(".w2ui-reset");i.length>0&&(t=i.attr("name"))}function f(n){if(typeof n=="undefined")return t;t=n}function e(){t=null}function o(){}var t=null;return n.active=f,n.clear=e,n.register=o,i(),n}({}),function(){$.fn.w2render=function(n){$(this).length>0&&(typeof n=="string"&&w2ui[n]&&w2ui[n].render($(this)[0]),typeof n=="object"&&n.render($(this)[0]))};$.fn.w2destroy=function(n){!n&&this.length>0&&(n=this.attr("name"));typeof n=="string"&&w2ui[n]&&w2ui[n].destroy();typeof n=="object"&&n.destroy()};$.fn.w2marker=function(n){return n==""||typeof n=="undefined"?$(this).each(function(n,t){t.innerHTML=t.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>(.*)\<\/span\>/ig,"$1")}):$(this).each(function(t,i){var u,r,f;typeof n=="string"&&(n=[n]);i.innerHTML=i.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>(.*)\<\/span\>/ig,"$1");for(u in n)r=n[u],typeof r!="string"&&(r=String(r)),r=r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;"),f=new RegExp(r+"(?!([^<]+)?>)","gi"),i.innerHTML=i.innerHTML.replace(f,function(n){return'<span class="w2ui-marker">'+n+"<\/span>"})})};$.fn.w2tag=function(n,t){if($.isPlainObject(t)||(t={}),$.isPlainObject(t.css)||(t.css={}),typeof t["class"]=="undefined"&&(t["class"]=""),$(this).length==0){$(".w2ui-tag").each(function(n,t){var i=$(t).data("options");typeof i=="undefined"&&(i={});$($(t).data("taged-el")).removeClass(i["class"]);clearInterval($(t).data("timer"));$(t).remove()});return}return $(this).each(function(i,r){var s=r.id,u=w2utils.escapeId(r.id),o,e;if(n==""||n==null||typeof n=="undefined")$("#w2ui-tag-"+u).css("opacity",0),setTimeout(function(){clearInterval($("#w2ui-tag-"+u).data("timer"));$("#w2ui-tag-"+u).remove()},300);else{clearInterval($("#w2ui-tag-"+u).data("timer"));$("#w2ui-tag-"+u).remove();$("body").append('<div id="w2ui-tag-'+s+'" class="w2ui-tag '+($(r).parents(".w2ui-popup").length>0?"w2ui-tag-popup":"")+'" \tstyle=""><\/div>');o=setInterval(function(){if($(r).length==0||$(r).offset().left==0&&$(r).offset().top==0){clearInterval($("#w2ui-tag-"+u).data("timer"));f();return}$("#w2ui-tag-"+u).data("position")!=$(r).offset().left+r.offsetWidth+"x"+$(r).offset().top&&$("#w2ui-tag-"+u).css({"-webkit-transition":".2s","-moz-transition":".2s","-ms-transition":".2s","-o-transition":".2s",left:$(r).offset().left+r.offsetWidth+"px",top:$(r).offset().top+"px"}).data("position",$(r).offset().left+r.offsetWidth+"x"+$(r).offset().top)},100);setTimeout(function(){$(r).offset()&&($("#w2ui-tag-"+u).css({opacity:"1",left:$(r).offset().left+r.offsetWidth+"px",top:$(r).offset().top+"px"}).html('<div style="margin-top: -2px 0px 0px -2px; white-space: nowrap;"> <div class="w2ui-tag-body">'+n+"<\/div> <\/div>").data("text",n).data("taged-el",r).data("options",t).data("position",$(r).offset().left+r.offsetWidth+"x"+$(r).offset().top).data("timer",o),$(r).off("keypress",f).on("keypress",f).off("change",f).on("change",f).css(t.css).addClass(t["class"]),typeof t.onShow=="function"&&t.onShow())},1);e="";$(r).length>0&&(e=$(r)[0].style.cssText);function f(){$("#w2ui-tag-"+u).length<=0||(clearInterval($("#w2ui-tag-"+u).data("timer")),$("#w2ui-tag-"+u).remove(),$(r).off("keypress",f).removeClass(t["class"]),$(r).length>0&&($(r)[0].style.cssText=e),typeof t.onHide=="function"&&t.onHide())}}})};$.fn.w2overlay=function(n,t){function f(n){var i;(typeof t.onHide=="function"&&(i=t.onHide()),n||i!==!1)&&($("#w2ui-overlay").remove(),$(document).off("click",f))}function e(){$(document).on("click",f);if($("#w2ui-overlay > div").length>0){var r=$("#w2ui-overlay > div").height(),i=$("#w2ui-overlay> div").width(),n=window.innerHeight-$("#w2ui-overlay > div").offset().top-7;r>n&&$("#w2ui-overlay> div").height(n).width(i+w2utils.scrollBarSize()).css({"overflow-y":"auto"});i=$("#w2ui-overlay> div").width();n=window.innerWidth-$("#w2ui-overlay > div").offset().left-7;i>n&&$("#w2ui-overlay> div").width(n).css({"overflow-x":"auto"});typeof t.onShow=="function"&&t.onShow()}}var i,u,r;if($.isPlainObject(t)||(t={}),$.isPlainObject(t.css)||(t.css={}),this.length==0||n==""||typeof n=="undefined")return f(),$(this);$("#w2ui-overlay").length>0&&$(document).click();$("body").append('<div id="w2ui-overlay" class="w2ui-reset w2ui-overlay '+($(this).parents(".w2ui-popup").length>0?"w2ui-overlay-popup":"")+'">\t<div><\/div><\/div>');i=this;r=$("#w2ui-overlay div");r.css(t.css).html(n);typeof t["class"]!="undefined"&&r.addClass(t["class"]);typeof t.top=="undefined"&&(t.top=0);typeof t.left=="undefined"&&(t.left=0);typeof t.width=="undefined"&&(t.width=100);typeof t.height=="undefined"&&(t.height=0);u=r.css("background-color");r=$("#w2ui-overlay");typeof u!="undefined"&&u!="rgba(0, 0, 0, 0)"&&u!="transparent"&&r.css("background-color",u);r.css({display:"none",left:$(i).offset().left+t.left+"px",top:$(i).offset().top+w2utils.getSize($(i),"height")+3+t.top+"px","min-width":t.width?t.width:"auto","min-height":t.height?t.height:"auto"}).fadeIn("fast").data("position",$(i).offset().left+"x"+($(i).offset().top+i.offsetHeight)).on("click",function(n){n.stopPropagation?n.stopPropagation():n.cancelBubble=!0});return t.hide=f.bind(this,!0),setTimeout(e,0),$(this)};$.fn.w2menu=function(n,t){function i(){for(var t,i,u,f='<table cellspacing="0" cellpadding="0" class="w2ui-drop-menu">',r=0;r<n.length;r++)t=n[r],typeof t=="string"?(i=t.split("|"),t={id:i[0],text:i[0],img:null,icon:null},i[1]&&(t.text=i[1]),i[2]&&(t.img=i[2]),i[3]&&(t.icon=i[3])):(typeof t.text!="undefined"&&typeof t.id=="undefined"&&(t.id=t.text),typeof t.text=="undefined"&&typeof t.id!="undefined"&&(t.text=t.id),typeof t.caption!="undefined"&&(t.text=t.caption),typeof t.img=="undefined"&&(t.img=null),typeof t.icon=="undefined"&&(t.icon=null)),u="<td>&nbsp;<\/td>",t.img&&(u='<td><div class="w2ui-tb-image w2ui-icon '+t.img+'"><\/div><\/td>'),t.icon&&(u='<td align="center"><div class="w2ui-tb-image"><span class="'+t.icon+'"><\/span><\/div><\/td>'),f+="<tr onmouseover=\"$(this).addClass('w2ui-selected');\" onmouseout=\"$(this).removeClass('w2ui-selected');\" \t\tonclick=\"$(document).click(); $.fn.w2menuHandler(event, '"+r+"');\">"+u+"\t<td>"+t.text+"<\/td><\/tr>";return f+"<\/table>"}return(typeof t.select=="undefined"&&typeof t.onSelect=="function"&&(t.select=t.onSelect),typeof t.select!="function")?(console.log("ERROR: options.select is required to be a function, not "+typeof t.select+" in $().w2menu(menu, options)"),$(this)):$.isArray(n)?($.fn.w2menuHandler=function(i,r){t.select(n[r],i,r)},$(this).w2overlay(i(),t)):(console.log("ERROR: first parameter should be an array of objects or strings in $().w2menu(menu, options)"),$(this))}}(),w2popup={},function(){$.fn.w2popup=function(n,t){typeof n=="undefined"&&(t={},n="open");$.isPlainObject(n)&&(t=n,n="open");n=n.toLowerCase();n=="load"&&typeof t=="string"&&(t={url:t});n=="open"&&typeof t.url!="undefined"&&(n="load");typeof t=="undefined"&&(t={});var i={};return $(this).length>0&&($(this).find("div[rel=title], div[rel=body], div[rel=buttons]").length>0?($(this).find("div[rel=title]").length>0&&(i.title=$(this).find("div[rel=title]").html()),$(this).find("div[rel=body]").length>0&&(i.body=$(this).find("div[rel=body]").html(),i.style=$(this).find("div[rel=body]")[0].style.cssText),$(this).find("div[rel=buttons]").length>0&&(i.buttons=$(this).find("div[rel=buttons]").html())):(i.title="&nbsp;",i.body=$(this).html()),parseInt($(this).css("width"))!=0&&(i.width=parseInt($(this).css("width"))),parseInt($(this).css("height"))!=0&&(i.height=parseInt($(this).css("height")))),w2popup[n]($.extend({},i,t))};w2popup={defaults:{title:"",body:"",buttons:"",style:"",color:"#000",opacity:.4,speed:.3,modal:!1,maximized:!1,keyboard:!0,width:500,height:300,showClose:!0,showMax:!1,transition:null},handlers:[],onOpen:null,onClose:null,onMax:null,onMin:null,onKeydown:null,open:function(n){function p(n){if(n||(n=window.event),window.addEventListener||window.document.attachEvent("onselectstart",function(){return!1}),t.resizing=!0,t.tmp_x=n.screenX,t.tmp_y=n.screenY,n.stopPropagation?n.stopPropagation():n.cancelBubble=!0,n.preventDefault)n.preventDefault();else return!1}function c(n){t.resizing==!0&&(n||(n=window.event),t.tmp_div_x=n.screenX-t.tmp_x,t.tmp_div_y=n.screenY-t.tmp_y,$("#w2ui-popup").css({"-webkit-transition":"none","-webkit-transform":"translate3d("+t.tmp_div_x+"px, "+t.tmp_div_y+"px, 0px)","-moz-transition":"none","-moz-transform":"translate("+t.tmp_div_x+"px, "+t.tmp_div_y+"px)","-ms-transition":"none","-ms-transform":"translate("+t.tmp_div_x+"px, "+t.tmp_div_y+"px)","-o-transition":"none","-o-transform":"translate("+t.tmp_div_x+"px, "+t.tmp_div_y+"px)"}),$("#w2ui-panel").css({"-webkit-transition":"none","-webkit-transform":"translate3d("+t.tmp_div_x+"px, "+t.tmp_div_y+"px, 0px)","-moz-transition":"none","-moz-transform":"translate("+t.tmp_div_x+"px, "+t.tmp_div_y+"px)","-ms-transition":"none","-ms-transform":"translate("+t.tmp_div_x+"px, "+t.tmp_div_y+"px","-o-transition":"none","-o-transform":"translate("+t.tmp_div_x+"px, "+t.tmp_div_y+"px)"}))}function l(n){t.resizing==!0&&(n||(n=window.event),t.tmp_div_x=n.screenX-t.tmp_x,t.tmp_div_y=n.screenY-t.tmp_y,$("#w2ui-popup").css({"-webkit-transition":"none","-webkit-transform":"translate3d(0px, 0px, 0px)","-moz-transition":"none","-moz-transform":"translate(0px, 0px)","-ms-transition":"none","-ms-transform":"translate(0px, 0px)","-o-transition":"none","-o-transform":"translate(0px, 0px)",left:parseInt($("#w2ui-popup").css("left"))+parseInt(t.tmp_div_x)+"px",top:parseInt($("#w2ui-popup").css("top"))+parseInt(t.tmp_div_y)+"px"}),$("#w2ui-panel").css({"-webkit-transition":"none","-webkit-transform":"translate3d(0px, 0px, 0px)","-moz-transition":"none","-moz-transform":"translate(0px, 0px)","-ms-transition":"none","-ms-transform":"translate(0px, 0px)","-o-transition":"none","-o-transform":"translate(0px, 0px)",left:parseInt($("#w2ui-panel").css("left"))+parseInt(t.tmp_div_x)+"px",top:parseInt($("#w2ui-panel").css("top"))+parseInt(t.tmp_div_y)+"px"}),t.resizing=!1)}var a=this,e=$("#w2ui-popup").data("options"),n=$.extend({},this.defaults,{body:""},e,n),r,u,v,y,i,f,s,h,o,t;if($("#w2ui-popup").length==0&&(w2popup.handlers=[],w2popup.onMax=null,w2popup.onMin=null,w2popup.onOpen=null,w2popup.onClose=null,w2popup.onKeydown=null),n.onOpen&&(w2popup.onOpen=n.onOpen),n.onClose&&(w2popup.onClose=n.onClose),n.onMax&&(w2popup.onMax=n.onMax),n.onMin&&(w2popup.onMin=n.onMin),n.onKeydown&&(w2popup.onKeydown=n.onKeydown),window.innerHeight==undefined?(r=document.documentElement.offsetWidth,u=document.documentElement.offsetHeight,w2utils.engine=="IE7"&&(r+=21,u+=4)):(r=window.innerWidth,u=window.innerHeight),parseInt(r)-10<parseInt(n.width)&&(n.width=parseInt(r)-10),parseInt(u)-10<parseInt(n.height)&&(n.height=parseInt(u)-10),v=(parseInt(u)-parseInt(n.height))/2*.6,y=(parseInt(r)-parseInt(n.width))/2,$("#w2ui-popup").length==0){if(f=this.trigger({phase:"before",type:"open",target:"popup",options:n,present:!1}),f.isCancelled===!0)return;w2popup.lockScreen(n);i='<div id="w2ui-popup" class="w2ui-popup" style="width: '+parseInt(n.width)+"px; height: "+parseInt(n.height)+"px; opacity: 0; -webkit-transform: scale(0.8); -moz-transform: scale(0.8); -ms-transform: scale(0.8); -o-transform: scale(0.8); left: "+y+"px; top: "+v+'px;">';n.title!=""&&(i+='<div class="w2ui-msg-title">'+(n.showClose?'<div class="w2ui-msg-button w2ui-msg-close" onclick="w2popup.close(); if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">Close<\/div>':"")+(n.showMax?'<div class="w2ui-msg-button w2ui-msg-max" onclick="w2popup.toggle()">Max<\/div>':"")+n.title+"<\/div>");i+='<div class="w2ui-box1" style="'+(n.title==""?"top: 0px !important;":"")+(n.buttons==""?"bottom: 0px !important;":"")+'">';i+='<div class="w2ui-msg-body'+(!n.title!=""?" w2ui-msg-no-title":"")+(!n.buttons!=""?" w2ui-msg-no-buttons":"")+'" style="'+n.style+'">'+n.body+"<\/div>";i+="<\/div>";i+='<div class="w2ui-box2" style="'+(n.title==""?"top: 0px !important;":"")+(n.buttons==""?"bottom: 0px !important;":"")+'">';i+='<div class="w2ui-msg-body'+(!n.title!=""?" w2ui-msg-no-title":"")+(!n.buttons!=""?" w2ui-msg-no-buttons":"")+'" style="'+n.style+'"><\/div>';i+="<\/div>";n.buttons!=""&&(i+='<div class="w2ui-msg-buttons">'+n.buttons+"<\/div>");i+="<\/div>";$("body").append(i);setTimeout(function(){$("#w2ui-popup .w2ui-box2").hide();$("#w2ui-popup").css({"-webkit-transition":n.speed+"s opacity, "+n.speed+"s -webkit-transform","-webkit-transform":"scale(1)","-moz-transition":n.speed+"s opacity, "+n.speed+"s -moz-transform","-moz-transform":"scale(1)","-ms-transition":n.speed+"s opacity, "+n.speed+"s -ms-transform","-ms-transform":"scale(1)","-o-transition":n.speed+"s opacity, "+n.speed+"s -o-transform","-o-transform":"scale(1)",opacity:"1"})},1);setTimeout(function(){$("#w2ui-popup").css({"-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":""});a.trigger($.extend(f,{phase:"after"}))},n.speed*1e3)}else{if(f=this.trigger({phase:"before",type:"open",target:"popup",options:n,present:!0}),f.isCancelled===!0)return;(typeof e=="undefined"||e.width!=n.width||e.height!=n.height)&&($("#w2ui-panel").remove(),w2popup.resize(n.width,n.height));s=$("#w2ui-popup .w2ui-box2 > .w2ui-msg-body").html(n.body);s.length>0&&(s[0].style.cssText=n.style);$("#w2ui-popup .w2ui-msg-buttons").html(n.buttons);$("#w2ui-popup .w2ui-msg-title").html((n.showClose?'<div class="w2ui-msg-button w2ui-msg-close" onclick="w2popup.close()">Close<\/div>':"")+(n.showMax?'<div class="w2ui-msg-button w2ui-msg-max" onclick="w2popup.max()">Max<\/div>':"")+n.title);h=$("#w2ui-popup .w2ui-box1")[0];o=$("#w2ui-popup .w2ui-box2")[0];w2utils.transition(h,o,n.transition);o.className="w2ui-box1";h.className="w2ui-box2";$(o).addClass("w2ui-current-box");$("#w2ui-popup").data("prev-size",null);setTimeout(function(){a.trigger($.extend(f,{phase:"after"}))},1)}if(n._last_w2ui_name=w2utils.keyboard.active(),w2utils.keyboard.active(null),$("#w2ui-popup").data("options",n),n.keyboard)$(document).on("keydown",this.keydown);t={resizing:!1};$("#w2ui-popup .w2ui-msg-title").on("mousedown",function(n){p(n)}).on("mousemove",function(n){c(n)}).on("mouseup",function(n){l(n)});$("#w2ui-popup .w2ui-msg-body").on("mousemove",function(n){c(n)}).on("mouseup",function(n){l(n)});$("#w2ui-lock").on("mousemove",function(n){c(n)}).on("mouseup",function(n){l(n)});return this},keydown:function(n){var i=$("#w2ui-popup").data("options"),t;if(i.keyboard&&(t=w2popup.trigger({phase:"before",type:"keydown",target:"popup",options:i,originalEvent:n}),t.isCancelled!==!0)){switch(n.keyCode){case 27:n.preventDefault();$("#w2ui-popup .w2ui-popup-message").length>0?w2popup.message():w2popup.close()}w2popup.trigger($.extend(t,{phase:"after"}))}},close:function(n){var i=this,n=$.extend({},$("#w2ui-popup").data("options"),n),t=this.trigger({phase:"before",type:"close",target:"popup",options:n});t.isCancelled!==!0&&($("#w2ui-popup, #w2ui-panel").css({"-webkit-transition":n.speed+"s opacity, "+n.speed+"s -webkit-transform","-webkit-transform":"scale(0.9)","-moz-transition":n.speed+"s opacity, "+n.speed+"s -moz-transform","-moz-transform":"scale(0.9)","-ms-transition":n.speed+"s opacity, "+n.speed+"s -ms-transform","-ms-transform":"scale(0.9)","-o-transition":n.speed+"s opacity, "+n.speed+"s -o-transform","-o-transform":"scale(0.9)",opacity:"0"}),w2popup.unlockScreen(),setTimeout(function(){$("#w2ui-popup").remove();$("#w2ui-panel").remove();i.trigger($.extend(t,{phase:"after"}))},n.speed*1e3),w2utils.keyboard.active(n._last_w2ui_name),n.keyboard&&$(document).off("keydown",this.keydown))},toggle:function(){var n=$("#w2ui-popup").data("options");n.maximized===!0?w2popup.min():w2popup.max()},max:function(){var i=this,n=$("#w2ui-popup").data("options"),t;n.maximized!==!0&&(t=this.trigger({phase:"before",type:"max",target:"popup",options:n}),t.isCancelled!==!0)&&(n.maximized=!0,n.prevSize=$("#w2ui-popup").css("width")+":"+$("#w2ui-popup").css("height"),$("#w2ui-popup").data("options",n),w2popup.resize(1e4,1e4,function(){i.trigger($.extend(t,{phase:"after"}))}))},min:function(){var r=this,n=$("#w2ui-popup").data("options"),t,i;n.maximized===!0&&(t=n.prevSize.split(":"),i=this.trigger({phase:"before",type:"min",target:"popup",options:n}),i.isCancelled!==!0)&&(n.maximized=!1,n.prevSize=null,$("#w2ui-popup").data("options",n),w2popup.resize(t[0],t[1],function(){r.trigger($.extend(i,{phase:"after"}))}))},get:function(){return $("#w2ui-popup").data("options")},set:function(n){w2popup.open(n)},clear:function(){$("#w2ui-popup .w2ui-msg-title").html("");$("#w2ui-popup .w2ui-msg-body").html("");$("#w2ui-popup .w2ui-msg-buttons").html("")},reset:function(){w2popup.open(w2popup.defaults)},load:function(n){function f(t,i){if(delete n.url,$("body").append('<div id="w2ui-tmp" style="display: none">'+t+"<\/div>"),typeof i!="undefined"&&$("#w2ui-tmp #"+i).length>0?$("#w2ui-tmp #"+i).w2popup(n):$("#w2ui-tmp > div").w2popup(n),$("#w2ui-tmp > style").length>0){var r=$("<div>").append($("#w2ui-tmp > style").clone()).html();$("#w2ui-popup #div-style").length==0&&$("#w2ui-ppopup").append('<div id="div-style" style="position: absolute; left: -100; width: 1px"><\/div>');$("#w2ui-popup #div-style").html(r)}$("#w2ui-tmp").remove()}var t;if(String(n.url)=="undefined"){console.log("ERROR: The url parameter is empty.");return}var r=String(n.url).split("#"),i=r[0],u=r[1];String(n)=="undefined"&&(n={});t=$("#w2ui-popup").data(i);typeof t!="undefined"&&t!=null?f(t,u):$.get(i,function(n,t,r){f(r.responseText,u);$("#w2ui-popup").data(i,r.responseText)})},message:function(n){var i,r,t,n;$().w2tag();n||(n={width:200,height:100});parseInt(n.width)<10&&(n.width=10);parseInt(n.height)<10&&(n.height=10);typeof n.hideOnClick=="undefined"&&(n.hideOnClick=!1);i=$("#w2ui-popup .w2ui-msg-title");$("#w2ui-popup .w2ui-popup-message").length==0?(r=parseInt($("#w2ui-popup").width()),$("#w2ui-popup .w2ui-box1").before('<div class="w2ui-popup-message" style="display: none; '+(i.length==0?"top: 0px;":"top: "+w2utils.getSize(i,"height")+"px;")+(typeof n.width!="undefined"?"width: "+n.width+"px; left: "+(r-n.width)/2+"px;":"left: 10px; right: 10px;")+(typeof n.height!="undefined"?"height: "+n.height+"px;":"bottom: 6px;")+'-webkit-transition: .3s; -moz-transition: .3s; -ms-transition: .3s; -o-transition: .3s;"'+(n.hideOnClick===!0?'onclick="w2popup.message();"':"")+"><\/div>"),$("#w2ui-popup .w2ui-popup-message").data("options",n)):(typeof n.width=="undefined"&&(n.width=w2utils.getSize($("#w2ui-popup .w2ui-popup-message"),"width")),typeof n.height=="undefined"&&(n.height=w2utils.getSize($("#w2ui-popup .w2ui-popup-message"),"height")));t=$("#w2ui-popup .w2ui-popup-message").css("display");$("#w2ui-popup .w2ui-popup-message").css({"-webkit-transform":t=="none"?"translateY(-"+n.height+"px)":"translateY(0px)","-moz-transform":t=="none"?"translateY(-"+n.height+"px)":"translateY(0px)","-ms-transform":t=="none"?"translateY(-"+n.height+"px)":"translateY(0px)","-o-transform":t=="none"?"translateY(-"+n.height+"px)":"translateY(0px)"});t=="none"?($("#w2ui-popup .w2ui-popup-message").show().html(n.html),setTimeout(function(){$("#w2ui-popup .w2ui-popup-message").css({"-webkit-transition":"0s","-moz-transition":"0s","-ms-transition":"0s","-o-transition":"0s","z-Index":1500});w2popup.lock();typeof n.onOpen=="function"&&n.onOpen()},300)):($("#w2ui-popup .w2ui-popup-message").css("z-Index",250),n=$("#w2ui-popup .w2ui-popup-message").data("options"),$("#w2ui-popup .w2ui-popup-message").remove(),w2popup.unlock(),typeof n.onClose=="function"&&n.onClose());setTimeout(function(){$("#w2ui-popup .w2ui-popup-message").css({"-webkit-transform":t=="none"?"translateY(0px)":"translateY(-"+n.height+"px)","-moz-transform":t=="none"?"translateY(0px)":"translateY(-"+n.height+"px)","-ms-transform":t=="none"?"translateY(0px)":"translateY(-"+n.height+"px)","-o-transform":t=="none"?"translateY(0px)":"translateY(-"+n.height+"px)"})},1)},lock:function(n,t){w2utils.lock($("#w2ui-popup"),n,t)},unlock:function(){w2utils.unlock($("#w2ui-popup"))},lockScreen:function(n){if($("#w2ui-lock").length>0)return!1;if(typeof n=="undefined"&&(n=$("#w2ui-popup").data("options")),typeof n=="undefined"&&(n={}),n=$.extend({},w2popup.defaults,n),$("body").append('<div id="w2ui-lock" \tonmousewheel="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; if (event.preventDefault) event.preventDefault(); else return false;"\tstyle="position: '+(w2utils.engine=="IE5"?"absolute":"fixed")+"; z-Index: 1199; left: 0px; top: 0px; \t\t   padding: 0px; margin: 0px; background-color: "+n.color+'; width: 100%; height: 100%; opacity: 0;"><\/div>'),setTimeout(function(){$("#w2ui-lock").css({"-webkit-transition":n.speed+"s opacity","-moz-transition":n.speed+"s opacity","-ms-transition":n.speed+"s opacity","-o-transition":n.speed+"s opacity",opacity:n.opacity})},1),n.modal==!0){$("#w2ui-lock").on("mousedown",function(){$("#w2ui-lock").css({"-webkit-transition":".1s","-moz-transition":".1s","-ms-transition":".1s","-o-transition":".1s",opacity:"0.6"});window.getSelection&&window.getSelection().removeAllRanges()});$("#w2ui-lock").on("mouseup",function(){setTimeout(function(){$("#w2ui-lock").css({"-webkit-transition":".1s","-moz-transition":".1s","-ms-transition":".1s","-o-transition":".1s",opacity:n.opacity})},100);window.getSelection&&window.getSelection().removeAllRanges()})}else $("#w2ui-lock").on("mouseup",function(){w2popup.close()});return!0},unlockScreen:function(){if($("#w2ui-lock").length==0)return!1;var n=$.extend({},$("#w2ui-popup").data("options"),n);return $("#w2ui-lock").css({"-webkit-transition":n.speed+"s opacity","-moz-transition":n.speed+"s opacity","-ms-transition":n.speed+"s opacity","-o-transition":n.speed+"s opacity",opacity:0}),setTimeout(function(){$("#w2ui-lock").remove()},n.speed*1e3),!0},resize:function(n,t,i){var r=$("#w2ui-popup").data("options"),u,f;parseInt($(window).width())-10<parseInt(n)&&(n=parseInt($(window).width())-10);parseInt($(window).height())-10<parseInt(t)&&(t=parseInt($(window).height())-10);u=(parseInt($(window).height())-parseInt(t))/2*.8;f=(parseInt($(window).width())-parseInt(n))/2;$("#w2ui-popup").css({"-webkit-transition":r.speed+"s width, "+r.speed+"s height, "+r.speed+"s left, "+r.speed+"s top","-moz-transition":r.speed+"s width, "+r.speed+"s height, "+r.speed+"s left, "+r.speed+"s top","-ms-transition":r.speed+"s width, "+r.speed+"s height, "+r.speed+"s left, "+r.speed+"s top","-o-transition":r.speed+"s width, "+r.speed+"s height, "+r.speed+"s left, "+r.speed+"s top",top:u,left:f,width:n,height:t});typeof i=="function"&&setTimeout(function(){i()},r.speed*1e3)}};$.extend(w2popup,w2utils.event)}(),w2alert=function(n,t,i){typeof t=="undefined"&&(t=w2utils.lang("Notification"));$("#w2ui-popup").length>0?w2popup.message({width:400,height:150,html:'<div style="position: absolute; top: 0px; left: 0px; right: 0px; bottom: 40px; overflow: auto">\t\t<div class="w2ui-centered"><div style="font-size: 13px;">'+n+'<\/div><\/div><\/div><div style="position: absolute; bottom: 7px; left: 0px; right: 0px; text-align: center; padding: 5px">\t\t<input type="button" value="Ok" onclick="w2popup.message();" class="w2ui-popup-button"><\/div>',onClose:function(){typeof i=="function"&&i()}}):w2popup.open({width:450,height:200,showMax:!1,title:t,body:'<div class="w2ui-centered"><div style="font-size: 13px;">'+n+"<\/div><\/div>",buttons:'<input type="button" value="'+w2utils.lang("Ok")+'" class="w2ui-popup-button" onclick="w2popup.close();">',onClose:function(){typeof i=="function"&&i()}})},w2confirm=function(n,t,i){(typeof i=="undefined"||typeof t=="function")&&(i=t,t=w2utils.lang("Confirmation"));typeof t=="undefined"&&(t=w2utils.lang("Confirmation"));$("#w2ui-popup").length>0?w2popup.message({width:400,height:150,html:'<div style="position: absolute; top: 0px; left: 0px; right: 0px; bottom: 40px; overflow: auto">\t\t<div class="w2ui-centered"><div style="font-size: 13px;">'+n+'<\/div><\/div><\/div><div style="position: absolute; bottom: 7px; left: 0px; right: 0px; text-align: center; padding: 5px">\t\t<input id="No" type="button" value="'+w2utils.lang("No")+'" class="w2ui-popup-button">\t\t<input id="Yes" type="button" value="'+w2utils.lang("Yes")+'" class="w2ui-popup-button"><\/div>',onOpen:function(){$("#w2ui-popup .w2ui-popup-message .w2ui-popup-button").on("click",function(n){w2popup.message();typeof i=="function"&&i(n.target.id)})},onKeydown:function(n){switch(n.originalEvent.keyCode){case 13:typeof i=="function"&&i("Yes");w2popup.message();break;case 27:typeof i=="function"&&i("No");w2popup.message()}}}):w2popup.open({width:450,height:200,title:t,modal:!0,showClose:!1,body:'<div class="w2ui-centered"><div style="font-size: 13px;">'+n+"<\/div><\/div>",buttons:'<input id="No" type="button" value="'+w2utils.lang("No")+'" class="w2ui-popup-button"><input id="Yes" type="button" value="'+w2utils.lang("Yes")+'" class="w2ui-popup-button">',onOpen:function(n){n.onComplete=function(){$("#w2ui-popup .w2ui-popup-button").on("click",function(n){w2popup.close();typeof i=="function"&&i(n.target.id)})}},onKeydown:function(n){switch(n.originalEvent.keyCode){case 13:typeof i=="function"&&i("Yes");w2popup.close();break;case 27:typeof i=="function"&&i("No");w2popup.close()}}})},function(n){var t=new function(){this.customTypes=[]};n.fn.w2field=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object")return t.init.apply(this,arguments);if(typeof n=="string")return t.init.apply(this,[{type:n}]);console.log("ERROR: Method "+n+" does not exist on jQuery.w2field")};n.extend(t,{init:function(i){var r=t;return n(this).each(function(){var h,e,a,r,o,f,s,c;if(typeof t.customTypes[i.type.toLowerCase()]=="function"){t.customTypes[i.type.toLowerCase()].call(this,i);return}h=i.type.toLowerCase();switch(h){case"clear":n(this).off("focus").off("blur").off("keypress").off("keydown").off("change").removeData();n(this).prev().hasClass("w2ui-list")&&(n(this).prev().remove(),n(this).removeAttr("tabindex").css("border-color","").show());n(this).prev().hasClass("w2ui-upload")&&(n(this).prev().remove(),n(this).removeAttr("tabindex").css("border-color","").show());n(this).prev().hasClass("w2ui-field-helper")&&(n(this).css("padding-left",n(this).css("padding-top")),n(this).prev().remove());n(this).next().hasClass("w2ui-field-helper")&&(n(this).css("padding-right",n(this).css("padding-top")),n(this).next().remove());n(this).next().hasClass("w2ui-field-helper")&&n(this).next().remove();break;case"text":case"int":case"float":case"money":case"alphanumeric":case"hex":e=this;o={min:null,max:null,arrows:!1,keyboard:!0,suffix:"",prefix:""};i=n.extend({},o,i);["text","alphanumeric","hex"].indexOf(h)!=-1&&(i.arrows=!1,i.keyboard=!1);n(this).data("options",i).on("keypress",function(t){if(!t.metaKey&&!t.ctrlKey&&!t.altKey&&(t.charCode==t.keyCode||!(t.keyCode>0))){t.keyCode==13&&n(this).change();var i=String.fromCharCode(t.charCode);if(!l(i,!0))return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,!1}}).on("keydown",function(t,r){var o,u,s,f;if(i.keyboard){o=!1;u=n(e).val();u=l(u)?parseFloat(u):i.min||0;s=t.keyCode||r.keyCode;f=1;(t.ctrlKey||t.metaKey)&&(f=10);switch(s){case 38:n(e).val(u+f<=i.max||i.max==null?u+f:i.max).change();h=="money"&&n(e).val(Number(n(e).val()).toFixed(2));o=!0;break;case 40:n(e).val(u-f>=i.min||i.min==null?u-f:i.min).change();h=="money"&&n(e).val(Number(n(e).val()).toFixed(2));o=!0}o&&(t.preventDefault(),setTimeout(function(){e.setSelectionRange(e.value.length,e.value.length)},0))}}).on("change",function(t){var r=n(e).val(),u=!1;if(i.min!=null&&r!=""&&r<i.min&&(n(e).val(i.min).change(),u=!0),i.max!=null&&r!=""&&r>i.max&&(n(e).val(i.max).change(),u=!0),u)return t.stopPropagation(),t.preventDefault(),!1;this.value==""||l(this.value)||n(this).val(i.min!=null?i.min:"")});if(n(this).val()==""&&i.min!=null&&n(this).val(i.min),i.prefix!=""){n(this).before('<div class="w2ui-field-helper">'+i.prefix+"<\/div>");f=n(this).prev();f.css({color:n(this).css("color"),"font-family":n(this).css("font-family"),"font-size":n(this).css("font-size"),"padding-top":n(this).css("padding-top"),"padding-bottom":n(this).css("padding-bottom"),"padding-left":n(this).css("padding-left"),"padding-right":0,"margin-top":parseInt(n(this).css("margin-top"))+1+"px","margin-bottom":parseInt(n(this).css("margin-bottom"))+1+"px","margin-left":0,"margin-right":0}).on("click",function(){n(this).next().focus()});n(this).css("padding-left",f.width()+parseInt(n(this).css("padding-left"))+5+"px")}if(s=parseInt(n(this).css("padding-right")),i.arrows!=""){n(this).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&nbsp;\t<div class="w2ui-field-up" type="up">\t\t<div class="arrow-up" type="up"><\/div>\t<\/div>\t<div class="w2ui-field-down" type="down">\t\t<div class="arrow-down" type="down"><\/div>\t<\/div>\t<div style="position: absolute; height: 1px; border-top: 1px solid red"><\/div><\/div>');a=w2utils.getSize(this,"height");f=n(this).next();f.css({color:n(this).css("color"),"font-family":n(this).css("font-family"),"font-size":n(this).css("font-size"),height:n(this).height()+parseInt(n(this).css("padding-top"))+parseInt(n(this).css("padding-bottom"))+"px",padding:"0px","margin-top":parseInt(n(this).css("margin-top"))+1+"px","margin-bottom":"0px","border-left":"1px solid silver"}).css("margin-left","-"+(f.width()+parseInt(n(this).css("margin-right"))+12)+"px").on("mousedown",function(t){function r(){clearTimeout(n("body").data("_field_update_timer"));n("body").off("mouseup",r)}function i(t){n(e).focus().trigger(n.Event("keydown"),{keyCode:n(u.target).attr("type")=="up"?38:40});t!==!1&&n("body").data("_field_update_timer",setTimeout(i,60))}var f=this,u=t;n("body").on("mouseup",r);n("body").data("_field_update_timer",setTimeout(i,700));i(!1)});s+=f.width()+12;n(this).css("padding-right",s+"px")}if(i.suffix!=""){n(this).after('<div class="w2ui-field-helper">'+i.suffix+"<\/div>");f=n(this).next();f.css({color:n(this).css("color"),"font-family":n(this).css("font-family"),"font-size":n(this).css("font-size"),"padding-top":n(this).css("padding-top"),"padding-bottom":n(this).css("padding-bottom"),"padding-left":"3px","padding-right":n(this).css("padding-right"),"margin-top":parseInt(n(this).css("margin-top"))+1+"px","margin-bottom":parseInt(n(this).css("margin-bottom"))+1+"px"}).on("click",function(){n(this).prev().focus()});f.css("margin-left","-"+(f.width()+parseInt(n(this).css("padding-right"))+5)+"px");s+=f.width()+3;n(this).css("padding-right",s+"px")}function l(n,t){switch(h){case"int":return t&&["-"].indexOf(n)!=-1?!0:w2utils.isInt(n);case"float":return t&&["-","."].indexOf(n)!=-1?!0:w2utils.isFloat(n);case"money":return t&&["-",".","$","€","£","¥"].indexOf(n)!=-1?!0:w2utils.isMoney(n);case"hex":return w2utils.isHex(n);case"alphanumeric":return w2utils.isAlphaNumeric(n)}return!0}break;case"date":r=this;o={format:w2utils.settings.date_format,start:"",end:"",blocked:{},colored:{}};i=n.extend({},o,i);n(this).css({transition:"none","-webkit-transition":"none","-moz-transition":"none","-ms-transition":"none","-o-transition":"none"}).data("options",i).on("focus",function(){var e=parseFloat(n(r).offset().top)+parseFloat(r.offsetHeight),t=parseFloat(n(r).offset().left),u,f;clearInterval(n(r).data("mtimer"));n("#global_calendar_div").remove();n("body").append('<div id="global_calendar_div" style="top: '+(e+parseInt(r.offsetHeight))+"px; left: "+t+'px;"  class="w2ui-reset w2ui-calendar"  onmousedown="\t\tif (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; \t\tif (event.preventDefault) event.preventDefault(); else return false;"><\/div>');n("#global_calendar_div").html(n().w2field("calendar_get",r.value,i)).css({left:t+"px",top:e+"px"}).data("el",r).show();u=n(window).width()+n(document).scrollLeft()-1;t+n("#global_calendar_div").width()>u&&n("#global_calendar_div").css("left",u-n("#global_calendar_div").width()+"px");f=setInterval(function(){var i=n(window).width()+n(document).scrollLeft()-1,t=n(r).offset().left;if(t+n("#global_calendar_div").width()>i&&(t=i-n("#global_calendar_div").width()),n("#global_calendar_div").data("position")!=n(r).offset().left+"x"+(n(r).offset().top+r.offsetHeight)&&n("#global_calendar_div").css({"-webkit-transition":".2s",left:t+"px",top:n(r).offset().top+r.offsetHeight+"px"}).data("position",n(r).offset().left+"x"+(n(r).offset().top+r.offsetHeight)),n(r).length==0||n(r).offset().left==0&&n(r).offset().top==0){clearInterval(f);n("#global_calendar_div").remove();return}},100);n(r).data("mtimer",f)}).on("blur",function(){n(r).val(n.trim(n(r).val()));n.trim(n(r).val())==""||w2utils.isDate(n(r).val(),i.format)||n(this).w2tag(w2utils.lang("Not a valid date")+": "+i.format);clearInterval(n(r).data("mtimer"));n("#global_calendar_div").remove()}).on("keypress",function(){var t=this;setTimeout(function(){n("#global_calendar_div").html(n().w2field("calendar_get",t.value,i))},10)});setTimeout(function(){w2utils.isInt(r.value)&&(r.value=w2utils.formatDate(r.value,i.format))},1);break;case"time":break;case"datetime":break;case"color":r=this;o={prefix:"#",suffix:'<div style="margin-top: 1px; height: 12px; width: 12px;"><\/div>'};i=n.extend({},o,i);n(this).attr("maxlength",6).on("focus",function(){var f=parseFloat(n(r).offset().top)+parseFloat(r.offsetHeight),t=parseFloat(n(r).offset().left),i,u;clearInterval(n(r).data("mtimer"));n("#global_color_div").remove();n("body").append('<div id="global_color_div" style="top: '+(f+parseInt(r.offsetHeight))+"px; left: "+t+'px;"  class="w2ui-reset w2ui-calendar"  onmousedown="\t\tif (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; \t\tif (event.preventDefault) event.preventDefault(); else return false;"><\/div>');n("#global_color_div").html(n().w2field("getColorHTML",r.value)).css({left:t+"px",top:f+"px"}).data("el",r).show();i=n(window).width()+n(document).scrollLeft()-1;t+n("#global_color_div").width()>i&&n("#global_color_div").css("left",i-n("#global_color_div").width()+"px");u=setInterval(function(){var i=n(window).width()+n(document).scrollLeft()-1,t=n(r).offset().left;if(t+n("#global_color_div").width()>i&&(t=i-n("#global_color_div").width()),n("#global_color_div").data("position")!=n(r).offset().left+"x"+(n(r).offset().top+r.offsetHeight)&&n("#global_color_div").css({"-webkit-transition":".2s",left:t+"px",top:n(r).offset().top+r.offsetHeight+"px"}).data("position",n(r).offset().left+"x"+(n(r).offset().top+r.offsetHeight)),n(r).length==0||n(r).offset().left==0&&n(r).offset().top==0){clearInterval(u);n("#global_color_div").remove();return}},100);n(r).data("mtimer",u)}).on("click",function(){n(this).trigger("focus")}).on("blur",function(){n(r).val(n.trim(n(r).val()));clearInterval(n(r).data("mtimer"));n("#global_color_div").remove()}).on("keydown",function(t){if(t.keyCode==86&&(t.ctrlKey||t.metaKey)){var i=this;n(this).prop("maxlength",7);setTimeout(function(){var t=n(i).val();t.substr(0,1)=="#"&&(t=t.substr(1));w2utils.isHex(t)||(t="");n(i).val(t).prop("maxlength",6).change()},20)}}).on("keyup",function(t){t.keyCode==86&&(t.ctrlKey||t.metaKey)&&n(this).prop("maxlength",6)}).on("keypress",function(t){t.keyCode==13&&n(this).change();var i=String.fromCharCode(t.charCode);if(!w2utils.isHex(i,!0))return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,!1}).on("change",function(){var t="#"+n(this).val();n(this).val().length!=6&&n(this).val().length!=3&&(t="");n(this).next().find("div").css("background-color",t)});if(i.prefix!=""){n(this).before('<div class="w2ui-field-helper">'+i.prefix+"<\/div>");f=n(this).prev();f.css({color:n(this).css("color"),"font-family":n(this).css("font-family"),"font-size":n(this).css("font-size"),"padding-top":n(this).css("padding-top"),"padding-bottom":n(this).css("padding-bottom"),"padding-left":n(this).css("padding-left"),"padding-right":0,"margin-top":parseInt(n(this).css("margin-top"))+1+"px","margin-bottom":parseInt(n(this).css("margin-bottom"))+1+"px","margin-left":0,"margin-right":0}).on("click",function(){n(this).next().focus()});n(this).css("padding-left",f.width()+parseInt(n(this).css("padding-left"))+2+"px")}if(i.suffix!=""){n(this).after('<div class="w2ui-field-helper">'+i.suffix+"<\/div>");f=n(this).next();f.css({color:n(this).css("color"),"font-family":n(this).css("font-family"),"font-size":n(this).css("font-size"),"padding-top":n(this).css("padding-top"),"padding-bottom":n(this).css("padding-bottom"),"padding-left":"3px","padding-right":n(this).css("padding-right"),"margin-top":parseInt(n(this).css("margin-top"))+1+"px","margin-bottom":parseInt(n(this).css("margin-bottom"))+1+"px"}).on("click",function(){n(this).prev().focus()});f.css("margin-left","-"+(f.width()+parseInt(n(this).css("padding-right"))+4)+"px");s=f.width()+parseInt(n(this).css("padding-right"))+4;n(this).css("padding-right",s+"px");f.find("div").css("background-color","#"+n(r).val())}break;case"select":case"list":if(this.tagName!="SELECT"){console.log("ERROR: You can only apply $().w2field('list') to a SELECT element");return}var o={url:"",items:[],value:null,showNone:!0},r=this,u=n.extend({},o,i);n(r).data("settings",u);r.refresh=function(){var i=n(r).data("settings"),e="",u=t.cleanItems(i.items),f;i.showNone&&(e='<option value="">- '+w2utils.lang("none")+" -<\/option>");for(f in u)i.showNone||i.value!=null||(i.value=u[f].id),e+='<option value="'+u[f].id+'">'+u[f].text+"<\/option>";n(r).html(e);n(r).val(i.value);n(r).val()!=i.value&&n(r).change()};u.url!=""?n.ajax({type:"GET",dataType:"text",url:u.url,complete:function(i,u){if(u=="success"){var e=n.parseJSON(i.responseText),f=n(r).data("settings");f.items=t.cleanItems(e.items);n(r).data("settings",f);r.refresh()}}}):r.refresh();break;case"enum":if(this.tagName!="INPUT"){console.log("ERROR: You can only apply $().w2field('enum') to an INPUT element");return}var o={url:"",items:[],selected:[],max:0,maxHeight:172,showAll:!1,match:"begins with",render:null,maxCache:500,onShow:null,onHide:null,onAdd:null,onRemove:null,onItemOver:null,onItemOut:null,onItemClick:null},r=this,u=n.extend({},o,i);u.items=t.cleanItems(u.items);u.selected=t.cleanItems(u.selected);n(this).data("selected",u.selected);n(this).css({padding:"0px","border-color":"transparent","background-color":"transparent",outline:"none"});this.add=function(t){var i,r,u;n(this).attr("readonly")||(i=n(this).data("selected"),r=n(this).data("settings"),typeof r.onAdd!="function"||(u=r.onAdd(t,r),u!==!1))&&(n.isArray(i)||(i=[]),r.max!=0&&r.max<=i.length&&i.splice(i.length-1,1),i.push(t),n(this).data("last_del",null),n(this).trigger("change"))};this.remove=function(i){var r=n(this).data("settings"),u;(typeof r.onRemove!="function"||(u=r.onRemove(i,r),u!==!1))&&(n(this).attr("readonly")||(n(this).data("selected").splice(i,1),n(this).parent().find("[title=Remove][index="+i+"]").remove(),this.refresh(),t.list_render.call(this),n(this).trigger("change")))};this.show=function(){var i,u,f;if(!n(this).attr("readonly")){if(i=n(this).data("settings"),n("#w2ui-global-items").length==0)w2ui_hide_items_flyout(),n("body").append('<div id="w2ui-global-items" class="w2ui-reset w2ui-items"><\/div>');else return;u=n("#w2ui-global-items");u.css({display:"block",left:n(r).offset().left+"px",top:n(r).offset().top+r.offsetHeight+3+"px"}).width(w2utils.getSize(r,"width")).data("position",n(r).offset().left+"x"+(n(r).offset().top+r.offsetHeight)).data("hide",this.hide.bind(this));u.on("mouseenter",function(){window.w2uiIsflyout=!1});u.on("mouseleave",function(){window.w2uiIsflyout=!0});t.list_render.call(r);f=function(){var i=n("#w2ui-global-items");if(n(r).length==0||n(r).offset().left==0&&n(r).offset().top==0){clearInterval(n(r).data("mtimer"));hide();return}i.data("position")!=n(r).offset().left+"x"+(n(r).offset().top+r.offsetHeight)&&(i.css({"-webkit-transition":".2s",left:n(r).offset().left+"px",top:n(r).offset().top+r.offsetHeight+3+"px"}).data("position",n(r).offset().left+"x"+(n(r).offset().top+r.offsetHeight)),setTimeout(function(){t.list_render.call(r,n(r).data("last_search"))},200));i.length>0&&n(r).data("mtimer",setTimeout(f,100))};n(r).data("mtimer",setTimeout(f,100));typeof i.onShow=="function"&&i.onShow.call(this,i)}};this.hide=function(){var t=n(this).data("settings");clearTimeout(n(r).data("mtimer"));n("#w2ui-global-items").remove();typeof t.onHide=="function"&&t.onHide.call(this,t)};this.refresh=function(){var i=this,r,t;n(n(this).data("div")).remove();var o="margin-top: "+n(this).css("margin-top")+"; margin-bottom: "+n(this).css("margin-bottom")+"; margin-left: "+n(this).css("margin-left")+"; margin-right: "+n(this).css("margin-right")+"; width: "+(w2utils.getSize(this,"width")-parseInt(n(this).css("margin-left"))-parseInt(n(this).css("margin-right")))+"px; ",f='<div class="w2ui-list" style="'+o+';"><div style="padding: 0px; margin: 0px; display: inline-block"><ul>',e=n(this).data("selected");for(r in e)f+='<li style="'+(n(this).data("last_del")==r?"opacity: 0.5":"")+'">\t<div title="'+w2utils.lang("Remove")+'" index="'+r+'">&nbsp;&nbsp;<\/div>'+e[r].text+"<\/li>";f+='<li style="padding-left: 0px; padding-right: 0px" class="nomouse">\t<input type="text" '+(n(this).attr("readonly")?"readonly":"")+' style="background-color: transparent"><\/li><\/ul><\/div><\/div>';n(this).before(f);t=n(this).prev()[0];n(this).data("div",t);n(t).find("li").data("mouse","out").on("click",function(t){if(!n(t.target).hasClass("nomouse")){if(t.target.title==w2utils.lang("Remove")){i.remove(n(t.target).attr("index"));return}t.stopPropagation();typeof u.onItemClick=="function"&&u.onItemClick.call(this,u)}}).on("mouseover",function(t){var i=t.target;(i.tagName!="LI"&&(i=i.parentNode),n(i).hasClass("nomouse"))||(n(i).data("mouse")=="out"&&typeof u.onItemOver=="function"&&u.onItemOver.call(this,u),n(i).data("mouse","over"))}).on("mouseout",function(t){var i=t.target;(i.tagName!="LI"&&(i=i.parentNode),n(i).hasClass("nomouse"))||(n(i).data("mouse","leaving"),setTimeout(function(){n(i).data("mouse")=="leaving"&&(n(i).data("mouse","out"),typeof u.onItemOut=="function"&&u.onItemOut.call(this,u))},0))});n(t).on("click",function(){n(this).find("input").focus()}).find("input").on("focus",function(r){n(t).css({outline:"auto 5px -webkit-focus-ring-color","outline-offset":"-2px"});i.show();r.stopPropagation?r.stopPropagation():r.cancelBubble=!0}).on("blur",function(r){window.w2uiIsflyout&&(n(t).css("outline","none"),i.hide(),r.stopPropagation?r.stopPropagation():r.cancelBubble=!0)});i.resize()};this.resize=function(){var r=n(this).data("settings"),i,t;r&&(i=n(this).prev(),t=n(i).find(">div").height(),t<23&&(t=23),t>r.maxHeight&&(t=r.maxHeight),n(i).height(t+(t%23==0?0:23-t%23)),i.length>0&&(i[0].scrollTop=1e3),n(this).height(t))};n(this).data("settings",u).attr("tabindex",-1);r.refresh();break;case"upload":if(this.tagName!="INPUT"){console.log("ERROR: You can only apply $().w2field('upload') to an INPUT element");return}var o={url:"",base64:!0,hint:w2utils.lang("Attach files by dragging and dropping or Click to Select"),max:0,maxSize:0,maxFileSize:0,onAdd:null,onRemove:null,onItemClick:null,onItemDblClick:null,onItemOver:null,onItemOut:null,onProgress:null,onComplete:null},r=this,u=n.extend({},o,i);u.base64===!0&&(u.maxSize==0&&(u.maxSize=20971520),u.maxFileSize==0&&(u.maxFileSize=20971520));c=u.selected;delete u.selected;n.isArray(c)||(c=[]);n(this).data("selected",c).data("settings",u).attr("tabindex",-1);t.upload_init.call(this);this.refresh=function(){var e=this,i=n(this).data("div"),r=n(this).data("settings"),h=n(this).data("selected"),c,t,s,l,o,u,f;n(i).find("li").remove();n(i).find("> span:first-child").css("line-height",n(i).height()-w2utils.getSize(i,"+height")-8+"px");for(c in h){t=h[c];s=n(i).find(".file-list li").length;n(i).find("> span:first-child").remove();n(i).find(".file-list").append('<li id="file-'+s+'">\t<div class="file-delete" onmouseover="event.stopPropagation();">&nbsp;&nbsp;<\/div>\t<span class="file-name">'+t.name+'<\/span>\t<span class="file-size"> - '+w2utils.size(t.size)+"<\/span><\/li>");l=n(i).find(".file-list #file-"+s);o="";/image/i.test(t.type)&&(o='<div style="padding: 2px;">\t<img src="##FILE##" style="max-width: 300px;" \t\tonload="var w = $(this).width(); var h = $(this).height(); \t\t\tif (w < 300 & h < 300) return; \t\t\tif (w >= h && w > 300) $(this).width(300);\t\t\tif (w < h && h > 300) $(this).height(300);"\t\tonerror="this.style.display = \'none\'"\t><\/div>');u='style="padding: 3px; text-align: right; color: #777;"';f='style="padding: 3px"';o+='<div style="padding: 5px;">\t<table cellpadding="2">\t<tr><td '+u+">Name:<\/td><td "+f+">"+t.name+"<\/td><\/tr>\t<tr><td "+u+">Size:<\/td><td "+f+">"+w2utils.size(t.size)+"<\/td><\/tr>\t<tr><td "+u+">Type:<\/td><td "+f+'>\t\t<span style="width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">'+t.type+"<\/span>\t<\/td><\/tr>\t<tr><td "+u+">Modified:<\/td><td "+f+">"+w2utils.date(t.modified)+"<\/td><\/tr>\t<\/table><\/div>";l.data("file",t).on("click",function(t){if(typeof r.onItemClick=="function"){var i=r.onItemClick.call(e,n(this).data("file"));if(i===!1)return}n(t.target).hasClass("file-delete")||t.stopPropagation()}).on("dblclick",function(t){if(typeof r.onItemDblClick=="function"){var i=r.onItemDblClick.call(e,n(this).data("file"));if(i===!1)return}t.stopPropagation();document.selection?document.selection.empty():document.defaultView.getSelection().removeAllRanges()}).on("mouseover",function(){var i,t;(typeof r.onItemOver!="function"||(i=r.onItemOver.call(e,n(this).data("file")),i!==!1))&&(t=n(this).data("file"),n(this).w2overlay(o.replace("##FILE##",t.content?"data:"+t.type+";base64,"+t.content:""),{top:-4}))}).on("mouseout",function(){if(typeof r.onItemOut=="function"){var t=r.onItemOut.call(e,n(this).data("file"));if(t===!1)return}n(this).w2overlay()})}};this.refresh();break;case"slider":break;default:console.log('ERROR: w2field does not recognize "'+i.type+'" field type.')}})},addType:function(n,i){t.customTypes[String(n).toLowerCase()]=i},cleanItems:function(t){var f=[];for(var e in t){var r="",u="",i=t[e];if(i!=null){if(n.isPlainObject(t))r=e,u=i;else if(typeof i=="object"&&(typeof i.id!="undefined"&&(r=i.id),typeof i.value!="undefined"&&(r=i.value),typeof i.txt!="undefined"&&(u=i.txt),typeof i.text!="undefined"&&(u=i.text)),typeof i=="string"){if(String(i)=="")continue;r=i;u=i;i={}}w2utils.isInt(r)&&(r=parseInt(r));w2utils.isFloat(r)&&(r=parseFloat(r));f.push(n.extend({},i,{id:r,text:u}))}}return f},upload_init:function(){var i=this,o=n(this).data("settings"),u=n(i).prev(),f,e,r;u.length>0&&u[0].tagName=="DIV"&&u.hasClass("w2ui-upload")&&u.remove();f="margin-top: "+n(i).css("margin-top")+"; margin-bottom: "+n(i).css("margin-bottom")+"; margin-left: "+n(i).css("margin-left")+"; margin-right: "+n(i).css("margin-right")+"; width: "+(w2utils.getSize(i,"width")-parseInt(n(i).css("margin-left"))-parseInt(n(i).css("margin-right")))+"px; height: "+(w2utils.getSize(i,"height")-parseInt(n(i).css("margin-top"))-parseInt(n(i).css("margin-bottom")))+"px; ";e='<div style="'+f+'" class="w2ui-upload">\t<span>'+o.hint+'<\/span>\t<ul class="file-list"><\/ul>\t<input class="file-input" type="file" name="attachment" multiple style="display: none"><\/div>';n(i).css({display1:"none","border-color":"transparent"}).before(e);n(i).data("div",n(i).prev()[0]);r=n(i).data("div");n(r).find(".file-input").off("change").on("change",function(){if(typeof this.files!="undefined")for(var n=0,r=this.files.length;n<r;n++)t.upload_add.call(i,this.files[n])});n(r).off("click").on("click",function(u){var s;if(n(r).w2tag(),u.target.tagName!="LI"&&!n(u.target).hasClass("file-size")){if(n(u.target).hasClass("file-delete")){t.upload_remove.call(i,u.target.parentNode);return}if(u.target.tagName!="INPUT"){var f=n(i).data("settings"),o=n(i).data("selected"),e=0;for(s in o)e++;(e<f.max||f.max==0)&&n(r).find(".file-input").click()}}}).off("dragenter").on("dragenter",function(){n(r).addClass("dragover")}).off("dragleave").on("dragleave",function(){n(r).removeClass("dragover")}).off("drop").on("drop",function(u){var e,f,o;for(n(r).removeClass("dragover"),e=u.originalEvent.dataTransfer.files,f=0,o=e.length;f<o;f++)t.upload_add.call(i,e[f]);u.preventDefault();u.stopPropagation()}).off("dragover").on("dragover",function(n){n.preventDefault();n.stopPropagation()})},upload_add:function(t){var u=this,e=n(u).data("div"),i=n(u).data("settings"),o=n(u).data("selected"),f={name:t.name,type:t.type,modified:t.lastModifiedDate,size:t.size,content:null},h=0,c=0,l,r,a,s;for(l in o)h+=o[l].size,c++;if(i.maxFileSize!=0&&f.size>i.maxFileSize){r="Maximum file size is "+w2utils.size(i.maxFileSize);n(e).w2tag(r);console.log("ERROR: "+r);return}if(i.maxSize!=0&&h+f.size>i.maxSize){r="Maximum total size is "+w2utils.size(i.maxFileSize);n(e).w2tag(r);console.log("ERROR: "+r);return}if(i.max!=0&&c>=i.max){r="Maximum number of files is "+i.max;n(e).w2tag(r);console.log("ERROR: "+r);return}(typeof i.onAdd!="function"||(a=i.onAdd.call(u,f),a!==!1))&&(o.push(f),typeof FileReader!="undefined"&&i.base64===!0?(s=new FileReader,s.onload=function(){return function(t){var i=t.target.result,r=i.indexOf(",");f.content=i.substr(r+1);u.refresh();n(u).trigger("change")}}(),s.readAsDataURL(t)):(u.refresh(),n(u).trigger("change")))},upload_remove:function(t){var i=this,s=n(i).data("div"),f=n(i).data("settings"),u=n(i).data("selected"),e=n(t).data("file"),o,r;if(typeof f.onRemove=="function"&&(o=f.onRemove.call(i,e),o===!1))return!1;for(r=u.length-1;r>=0;r--)u[r].name==e.name&&u[r].size==e.size&&u.splice(r,1);n(t).fadeOut("fast");setTimeout(function(){n(t).remove();u.length==0&&n(s).prepend("<span>"+f.hint+"<\/span>");i.refresh();n(i).trigger("change")},300)},list_render:function(i){var r=this,f=n("#w2ui-global-items"),u=n(this).data("settings"),o=u.items,h=n(this).data("selected"),b,c,y,e,a,v,g,w;if(f.length!=0){typeof i=="undefined"&&(b="",b+='<div class="w2ui-items-list"><\/div>',f.html(b),i="");n(this).data("last_search",i);(typeof n(r).data("last_index")=="undefined"||n(r).data("last_index")==null)&&n(r).data("last_index",0);typeof u.last_total=="undefined"&&(u.last_total=-1);typeof u.last_search_len=="undefined"&&(u.last_search_len=0);typeof u.last_search_match=="undefined"&&(u.last_search_match=-1);u.url!=""&&(o.length==0&&u.last_total!=0||i.length>u.last_search_len&&u.last_total>u.maxCache||i.length<u.last_search_match&&i.length!=u.last_search_len)&&(c=!1,u.last_total<u.maxCache&&(c=!0),n.ajax({type:"GET",dataType:"text",url:u.url,data:{search:i,max:u.maxCache},complete:function(f,e){if(u.last_total=0,e=="success"){var o=n.parseJSON(f.responseText);c==!1&&o.total<u.maxCache&&(u.last_search_match=i.length);u.last_search_len=i.length;u.last_total=o.total;u.items=o.items;t.list_render.call(r,i)}}}));var s=0,l="<ul>",d=[];for(e in h)d.push(w2utils.isInt(h[e].id)?parseInt(h[e].id):String(h[e].id));y="";for(e in o)if(a=o[e].id,v=o[e].text,n.inArray(w2utils.isInt(a)?parseInt(a):String(a),d)==-1||u.showAll===!0){var p=String(i).toLowerCase(),k=v.toLowerCase(),c=p.length<=k.length&&k.substr(0,p.length)==p;u.match.toLowerCase()=="contains"&&k.indexOf(p)!=-1&&(c=!0);c&&(typeof u.render=="function"&&(v=u.render(o[e],h)),v!==!1&&(typeof o[e].group!="undefined"&&o[e].group!=y&&(y=o[e].group,l+='<li class="w2ui-item-group" onmousedown="event.preventDefault()">'+y+"<\/li>"),l+='\n<li index="'+e+'" value="'+a+"\"   onmouseover=\"$(this).parent().find('li').removeClass('selected'); $(this).addClass('selected'); \"\tclass=\""+(s%2?"w2ui-item-even":"w2ui-item-odd")+(s==n(r).data("last_index")?" selected":"")+'">'+v+"<\/li>",s==n(r).data("last_index")&&n(r).data("last_item",o[e]),s++))}l+="<\/ul>";s==0&&(l='<div class="w2ui-empty-list">'+w2utils.lang("No items found")+"<\/div>",g=!0);f.find(".w2ui-items-list").html(l);n(this).data("last_max",s-1);f.find("li.selected").length>0&&f.find("li.selected")[0].scrollIntoView(!1);f.css({"-webkit-transition":"0s",height:"auto"});w=parseInt(n(document).height())>parseInt(n(window).height())?parseInt(n(window).height())-parseInt(f.offset().top)-8:parseInt(n(document).height())-parseInt(f.offset().top)-8;n(f).find(".w2ui-items-list").css({height:"auto",overflow:"visible"});parseInt(f.height())>w?(f.css({height:w-5+"px",overflow:"show"}),n(f).find(".w2ui-items-list").css({height:w-15+"px",overflow:"auto"})):(f.css({height:"auto",overflow:"show"}),n(f).find(".w2ui-items-list").css({height:"auto",overflow:"auto"}));n(f).off("mousedown").on("mousedown",function(i){var f=i.target,e,o;if(f.tagName!="LI"&&(f=n(f).parents("li")),e=n(f).attr("index"),e){if(o=u.items[e],typeof e=="undefined")if(i.preventDefault)i.preventDefault();else return!1;r.add(o);n(r).data("last_index",0);r.refresh();t.list_render.call(r,"")}});n(r).prev().find("li > input").val(i).css("max-width",n(f).width()-25+"px").width((i.length+2)*6+"px").focus().on("click",function(n){n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}).off("keyup").on("keyup",function(i){var u=this;setTimeout(function(){var f=n(r).data("last_index"),e;switch(i.keyCode){case 38:f--;f<0&&(f=0);n(r).data("last_index",f);i.preventDefault&&i.preventDefault();break;case 40:f++;f>n(r).data("last_max")&&(f=n(r).data("last_max"));n(r).data("last_index",f);i.preventDefault&&i.preventDefault();break;case 13:if(typeof n(r).data("last_item")=="undefined"||n(r).data("last_item")==null||g===!0)break;e=n(r).data("selected");r.add(n(r).data("last_item"));f>n(r).data("last_max")-1&&(f=n(r).data("last_max")-1);n(r).data("last_index",f);n(r).data("last_item",null);n(u).val("");r.refresh();i.preventDefault&&i.preventDefault();break;case 8:String(u.value)==""&&(typeof n(r).data("last_del")=="undefined"||n(r).data("last_del")==null?(e=n(r).data("selected"),n.isArray(e)||(e=[]),n(r).data("last_del",e.length-1),r.refresh()):(e=n(r).data("selected"),r.remove(e.length-1)));break;default:n(r).data("last_index",0);n(r).data("last_del",null)}r.resize();i.keyCode==8&&String(u.value)==""||(n(r).prev().find("li").css("opacity","1"),n(r).data("last_del",null));n.inArray(i.keyCode,[16,91,37,39])==-1&&t.list_render.call(r,u.value)},10)})}},calendar_get:function(t,i){var e=new Date,o=Number(e.getMonth())+1+"/"+e.getDate()+"/"+(String(e.getYear()).length>3?e.getYear():e.getYear()+1900);(String(t)==""||String(t)=="undefined")&&(t=w2utils.formatDate(o,i.format));w2utils.isDate(t,i.format)||(t=w2utils.formatDate(o,i.format));var r=t.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/"),f=i.format.replace(/-/g,"/").replace(/\./g,"/").toLowerCase(),u=new Date;return f=="mm/dd/yyyy"&&(u=new Date(r[0]+"/"+r[1]+"/"+r[2])),f=="m/d/yyyy"&&(u=new Date(r[0]+"/"+r[1]+"/"+r[2])),f=="dd/mm/yyyy"&&(u=new Date(r[1]+"/"+r[0]+"/"+r[2])),f=="d/m/yyyy"&&(u=new Date(r[1]+"/"+r[0]+"/"+r[2])),f=="yyyy/dd/mm"&&(u=new Date(r[2]+"/"+r[1]+"/"+r[0])),f=="yyyy/d/m"&&(u=new Date(r[2]+"/"+r[1]+"/"+r[0])),f=="yyyy/mm/dd"&&(u=new Date(r[1]+"/"+r[2]+"/"+r[0])),f=="yyyy/m/d"&&(u=new Date(r[1]+"/"+r[2]+"/"+r[0])),f=="mm/dd/yy"&&(u=new Date(r[0]+"/"+r[1]+"/"+(parseInt(r[2])+1900))),f=="m/d/yy"&&(u=new Date(r[0]+"/"+r[1]+"/"+(parseInt(r[2])+1900))),f=="dd/mm/yy"&&(u=new Date(r[1]+"/"+r[0]+"/"+(parseInt(r[2])+1900))),f=="d/m/yy"&&(u=new Date(r[1]+"/"+r[0]+"/"+(parseInt(r[2])+1900))),f=="yy/dd/mm"&&(u=new Date(r[2]+"/"+r[1]+"/"+(parseInt(r[0])+1900))),f=="yy/d/m"&&(u=new Date(r[2]+"/"+r[1]+"/"+(parseInt(r[0])+1900))),f=="yy/mm/dd"&&(u=new Date(r[1]+"/"+r[2]+"/"+(parseInt(r[0])+1900))),f=="yy/m/d"&&(u=new Date(r[1]+"/"+r[2]+"/"+(parseInt(r[0])+1900))),'<table cellpadding="0" cellspacing="0"><tr><td>'+n().w2field("calendar_month",u.getMonth()+1,u.getFullYear(),i)+"<\/td><\/tr><\/table>"},calendar_next:function(t){var f=String(t).split("/"),i=f[0],r=f[1],u;parseInt(i)<12?i=parseInt(i)+1:(i=1,r=parseInt(r)+1);u=n(n("#global_calendar_div.w2ui-calendar").data("el")).data("options");n("#global_calendar_div.w2ui-calendar").html(n().w2field("calendar_get",w2utils.formatDate(i+"/1/"+r,u.format),u))},calendar_previous:function(t){var f=String(t).split("/"),i=f[0],r=f[1],u;parseInt(i)>1?i=parseInt(i)-1:(i=12,r=parseInt(r)-1);u=n(n("#global_calendar_div.w2ui-calendar").data("el")).data("options");n("#global_calendar_div.w2ui-calendar").html(n().w2field("calendar_get",w2utils.formatDate(i+"/1/"+r,u.format),u))},calendar_month:function(t,i,r){var u=new Date,tt=w2utils.settings.fullmonths,et=w2utils.settings.fulldays,p=["31","28","31","30","31","30","31","31","30","31","30","31"],it=Number(u.getMonth())+1+"/"+u.getDate()+"/"+(String(u.getYear()).length>3?u.getYear():u.getYear()+1900),c,k,e,s,f,v,o,h,l;i=Number(i);t=Number(t);(i===null||i==="")&&(i=String(u.getYear()).length>3?u.getYear():u.getYear()+1900);(t===null||t==="")&&(t=Number(u.getMonth())+1);t>12&&(t=t-12,i++);(t<1||t==0)&&(t=t+12,i--);p[1]=i/4==Math.floor(i/4)?"29":"28";i==null&&(i=u.getYear());t==null&&(t=u.getMonth()-1);u=new Date;u.setDate(1);u.setMonth(t-1);u.setYear(i);var a=u.getDay(),w=w2utils.settings.shortdays,b="";for(c=0,k=w.length;c<k;c++)b+="<td>"+w[c]+"<\/td>";for(e='<div class="w2ui-calendar-title" onclick="event.stopPropagation()">\t<div class="w2ui-calendar-previous" onclick="$().w2field(\'calendar_previous\', \''+t+"/"+i+"')\"> <- <\/div>\t<div class=\"w2ui-calendar-next\" onclick=\"$().w2field('calendar_next', '"+t+"/"+i+"')\"> -> <\/div> "+tt[t-1]+", "+i+'<\/div><table class="w2ui-calendar-days" onclick="event.stopPropagation()" cellspacing="0">\t<tr class="w2ui-day-title">'+b+"<\/tr>\t<tr>",s=1,f=1;f<43;f++){if(a==0&&f==1){for(v=0;v<6;v++)e+='<td class="w2ui-day-empty">&nbsp;<\/td>';f+=6}else if(f<a||s>p[t-1]){e+='<td class="w2ui-day-empty">&nbsp;<\/td>';f%7==0&&(e+="<\/tr><tr>");continue}o=t+"/"+s+"/"+i;h="";f%7==6&&(h="w2ui-saturday");f%7==0&&(h="w2ui-sunday");o==it&&(h+=" w2ui-today");var rt=s,d="",g="",y="";if(r.colored&&r.colored[o]!=undefined&&(tmp=r.colored[o].split(":"),g="background-color: "+tmp[0]+";",d="color: "+tmp[1]+";"),l=!1,r.start||r.end){var ut=new Date(r.start),ft=new Date(r.end),nt=new Date(o);(nt<ut||nt>ft)&&(y=" w2ui-blocked-date",l=!0)}r.blocked&&n.inArray(o,r.blocked)!=-1&&(y=" w2ui-blocked-date",l=!0);e+='<td class="'+h+y+'" style="'+d+g+'" id="'+this.name+"_date_"+o+'" date="'+o+'"';l===!1&&(e+="onclick=\"var el = $('#global_calendar_div.w2ui-calendar').data('el'); \t$(el).val('"+w2utils.formatDate(o,r.format)+"').trigger('change').trigger('blur'); \t if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\t if (event.preventDefault) event.preventDefault(); else return false;\"");e+=">"+rt+"<\/td>";(f%7==0||a==0&&f==1)&&(e+="<\/tr><tr>");s++}return e+"<\/tr><\/table>"},getColorHTML:function(n){for(var i,r='<div class="w2ui-color"><table cellspacing="5">',u=[["000000","444444","666666","999999","CCCCCC","EEEEEE","F3F3F3","FFFFFF"],["FF011B","FF9838","FFFD59","01FD55","00FFFE","0424F3","9B24F4","FF21F5"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D1E9","EAD1DC"],["EA9899","F9CB9C","FEE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD"],["E06666","F6B26B","FED966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BA0"],["CC0814","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A54D79"],["99050C","B45F17","BF901F","37761D","124F5C","0A5394","351C75","741B47"],["660205","783F0B","7F6011","274E12","0C343D","063762","20124D","4C1030"]],t=0;t<8;t++){for(r+="<tr>",i=0;i<8;i++)r+="<td>\t<div onclick=\"var el = $('#global_color_div').data('el');\t\t\t$(el).val($(this).attr('name')).change(); \t\t\t$('#global_color_div').hide()\" \t\tstyle=\"background-color: #"+u[t][i]+';" name="'+u[t][i]+'">\t\t'+(n==u[t][i]?"&#149;":"&nbsp;")+"\t<\/div><\/td>";r+="<\/tr>";t<2&&(r+='<tr><td style="height: 8px" colspan="8"><\/td><\/tr>')}return r+"<\/table><\/div>"}});w2obj.field=t}(jQuery),window.w2uiIsflyout=!1,String(navigator.userAgent).indexOf("MSIE")>=0||!!navigator.userAgent.match(/Trident.*rv\:11\./))$(document).on("click",w2ui_hide_items_flyout);var __extends=this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
__.prototype=b.prototype;d.prototype=new __();};var Ccx;(function(Ccx){(function(Scheduling){(function(Models){var Appointment=(function(_super){__extends(Appointment,_super);function Appointment(){_super.apply(this,arguments);}
Appointment.prototype.ListResources=function(callback){callback([{text:"Alex",value:1,color:"#f8a398"},{text:"Bob",value:2,color:"#51a0ed"},{text:"Charlie",value:3,color:"#56ca85"}]);};Appointment.prototype.GetProviderAppointments=function(providerId,callback){this.DataAccess.query("appointment").where("statecode",AppData.ExpressionOperator.NotEquals,2).where("ccx_apptcategory",AppData.ExpressionOperator.NotNull).select("scheduledstart","scheduledend","subject","scheduleddurationminutes","location","regardingobjectidname","regardingobjectid","ccx_programunit","ccx_programunitname","ownerid","owneridname","ccx_apptcategory").orderBy("scheduledstart",false).join("activityparty","activityid","activityid").where("participationtypemask",AppData.ExpressionOperator.Equals,5).select("partyid").join("equipment","equipmentid","partyid").where("ccx_provider",AppData.ExpressionOperator.Equals,providerId).execute(callback);};Appointment.prototype.GetProviderAppointmentsByDate=function(providerId,startDate,endDate,callback){this.DataAccess.query("appointment").where("statecode",AppData.ExpressionOperator.NotEquals,2).where("ccx_apptcategory",AppData.ExpressionOperator.NotNull).where("scheduledstart",AppData.ExpressionOperator.OnOrAfter,startDate).where("scheduledstart",AppData.ExpressionOperator.OnOrBefore,endDate).select("scheduledstart","scheduledend","subject","scheduleddurationminutes","location","regardingobjectidname","regardingobjectid","ccx_programunit","ccx_programunitname","ownerid","owneridname","seriesid","activityid","ccx_anyprovidercanmodify","ccx_serviceitem","ccx_serviceitemname","optionalattendees","ccx_servicestatus","ccx_servicestatusname","ccx_recordedservice","ccx_recordedservicename","ccx_plannedservice","ccx_plannedservicename").orderBy("scheduledstart",false).join("activityparty","activityid","activityid").where("participationtypemask",AppData.ExpressionOperator.Equals,5).select("partyid").join("equipment","equipmentid","partyid").where("ccx_provider",AppData.ExpressionOperator.Equals,providerId).execute(callback);};Appointment.prototype.ListAppointments=function(selectedDateTime,callback){callback([{"TaskID":4,"OwnerID":2,"Title":"Bowling tournament","Description":"","StartTimezone":null,"Start":"\/Date(1370811600000)\/","End":"\/Date(1370822400000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":5,"OwnerID":2,"Title":"Take the dog to the vet","Description":"","StartTimezone":null,"Start":"\/Date(1370847600000)\/","End":"\/Date(1370851200000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":6,"OwnerID":2,"Title":"Call Charlie about the project","Description":"","StartTimezone":null,"Start":"\/Date(1370950200000)\/","End":"\/Date(1370955600000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":7,"OwnerID":3,"Title":"Meeting with Alex","Description":"","StartTimezone":null,"Start":"\/Date(1371034800000)\/","End":"\/Date(1371038400000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":9,"OwnerID":2,"Title":"Alex's Birthday","Description":"","StartTimezone":null,"Start":"\/Date(1371175200000)\/","End":"\/Date(1371175200000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":true},{"TaskID":12,"OwnerID":2,"Title":"Car Service","Description":"Might come to work later!","StartTimezone":null,"Start":"\/Date(1372062600000)\/","End":"\/Date(1372066200000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":14,"OwnerID":3,"Title":"Replace the printer on the 1st floor","Description":"","StartTimezone":null,"Start":"\/Date(1372068000000)\/","End":"\/Date(1372071600000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":15,"OwnerID":1,"Title":"Attending HR Conference","Description":"","StartTimezone":null,"Start":"\/Date(1372118400000)\/","End":"\/Date(1372204800000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":true},{"TaskID":16,"OwnerID":1,"Title":"Business Lunch with Gregory Watkins","Description":"","StartTimezone":null,"Start":"\/Date(1372161600000)\/","End":"\/Date(1372165200000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":17,"OwnerID":1,"Title":"Breakfast with CFO and COO","Description":"","StartTimezone":null,"Start":"\/Date(1372321800000)\/","End":"\/Date(1372325400000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":18,"OwnerID":1,"Title":"Job Interview - Mathew Stevens","Description":"Junior Researcher","StartTimezone":null,"Start":"\/Date(1372327200000)\/","End":"\/Date(1372330800000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":19,"OwnerID":1,"Title":"Review CVs with Tim","Description":"","StartTimezone":null,"Start":"\/Date(1372330800000)\/","End":"\/Date(1372332600000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":20,"OwnerID":1,"Title":"Lunch with Monica","Description":"Discuss the Employee handbook","StartTimezone":null,"Start":"\/Date(1372334400000)\/","End":"\/Date(1372339800000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":21,"OwnerID":1,"Title":"Job Interview - John Stewart","Description":"Accountant","StartTimezone":null,"Start":"\/Date(1372341600000)\/","End":"\/Date(1372345200000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":22,"OwnerID":1,"Title":"Job Interview - Mary Smith","Description":"Accountant","StartTimezone":null,"Start":"\/Date(1372347000000)\/","End":"\/Date(1372350600000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":24,"OwnerID":3,"Title":"Register new Access Cards","Description":"","StartTimezone":null,"Start":"\/Date(1372075200000)\/","End":"\/Date(1372077000000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":25,"OwnerID":1,"Title":"HR Lecture","Description":"","StartTimezone":null,"Start":"\/Date(1370372400000)\/","End":"\/Date(1370379600000)\/","EndTimezone":null,"RecurrenceRule":"FREQ=WEEKLY;BYDAY=TU,TH","RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":26,"OwnerID":1,"Title":"Dentist","Description":"","StartTimezone":null,"Start":"\/Date(1372406400000)\/","End":"\/Date(1372410000000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":27,"OwnerID":1,"Title":"Job Interview - Laura Bailey","Description":"Helpdesk","StartTimezone":null,"Start":"\/Date(1372411800000)\/","End":"\/Date(1372415400000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":28,"OwnerID":1,"Title":"Job Interview - Jenny Baxter","Description":"Helpdesk","StartTimezone":null,"Start":"\/Date(1372417200000)\/","End":"\/Date(1372420800000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":31,"OwnerID":1,"Title":"Team building prep tasks","Description":"","StartTimezone":null,"Start":"\/Date(1372428000000)\/","End":"\/Date(1372438800000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":32,"OwnerID":1,"Title":"Job Interview - Bernard Atkins","Description":"Helpdesk","StartTimezone":null,"Start":"\/Date(1372080600000)\/","End":"\/Date(1372084200000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":34,"OwnerID":1,"Title":"Review Job Applications","Description":"","StartTimezone":null,"Start":"\/Date(1372086000000)\/","End":"\/Date(1372095000000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":35,"OwnerID":1,"Title":"Grand Canyon tour","Description":"","StartTimezone":null,"Start":"\/Date(1371945600000)\/","End":"\/Date(1371945600000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":true},{"TaskID":40,"OwnerID":3,"Title":"Install new laptops in conference rooms","Description":"","StartTimezone":null,"Start":"\/Date(1372080600000)\/","End":"\/Date(1372096800000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":66,"OwnerID":3,"Title":"Bob's Birthday","Description":"","StartTimezone":null,"Start":"\/Date(1372492800000)\/","End":"\/Date(1372485600000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":true},{"TaskID":68,"OwnerID":1,"Title":"Breakfast with Tom","Description":"","StartTimezone":null,"Start":"\/Date(1372062600000)\/","End":"\/Date(1372064400000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":69,"OwnerID":2,"Title":"Team planning meeting","Description":"","StartTimezone":null,"Start":"\/Date(1372068000000)\/","End":"\/Date(1372075200000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":70,"OwnerID":2,"Title":"Support Phone Call","Description":"","StartTimezone":null,"Start":"\/Date(1372089600000)\/","End":"\/Date(1372091400000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":71,"OwnerID":2,"Title":"Business breakfast with Caroline","Description":"","StartTimezone":null,"Start":"\/Date(1372150800000)\/","End":"\/Date(1372154400000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":72,"OwnerID":2,"Title":"Discuss preojects' deadlines","Description":"","StartTimezone":null,"Start":"\/Date(1372158000000)\/","End":"\/Date(1372159800000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":73,"OwnerID":2,"Title":"Support Meeting","Description":"","StartTimezone":null,"Start":"\/Date(1372172400000)\/","End":"\/Date(1372176000000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":74,"OwnerID":2,"Title":"Dine with Mathew","Description":"","StartTimezone":null,"Start":"\/Date(1372185000000)\/","End":"\/Date(1372190400000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":79,"OwnerID":2,"Title":"Banking","Description":"","StartTimezone":null,"Start":"\/Date(1372237200000)\/","End":"\/Date(1372240800000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":80,"OwnerID":3,"Title":"Software updates","Description":"","StartTimezone":null,"Start":"\/Date(1372154400000)\/","End":"\/Date(1372161600000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":81,"OwnerID":3,"Title":"UPS maintenance","Description":"","StartTimezone":null,"Start":"\/Date(1372177800000)\/","End":"\/Date(1372183200000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":82,"OwnerID":2,"Title":"Support Call","Description":"","StartTimezone":null,"Start":"\/Date(1372246200000)\/","End":"\/Date(1372248000000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":83,"OwnerID":3,"Title":"Phone Sync with NY office ","Description":"","StartTimezone":null,"Start":"\/Date(1372253400000)\/","End":"\/Date(1372257000000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":84,"OwnerID":3,"Title":"Phone Sync with Boston Office","Description":"","StartTimezone":null,"Start":"\/Date(1372258800000)\/","End":"\/Date(1372262400000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":85,"OwnerID":3,"Title":"Server maintenance","Description":"","StartTimezone":null,"Start":"\/Date(1372271400000)\/","End":"\/Date(1372282200000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":86,"OwnerID":2,"Title":"Status meeting","Description":"","StartTimezone":null,"Start":"\/Date(1372426200000)\/","End":"\/Date(1372433400000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":87,"OwnerID":3,"Title":"Helpdesk status meeting","Description":"","StartTimezone":null,"Start":"\/Date(1372329000000)\/","End":"\/Date(1372332600000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":88,"OwnerID":2,"Title":"Business Lunch","Description":"","StartTimezone":null,"Start":"\/Date(1372334400000)\/","End":"\/Date(1372338000000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":89,"OwnerID":3,"Title":"Employee database update","Description":"","StartTimezone":null,"Start":"\/Date(1372341600000)\/","End":"\/Date(1372347000000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":90,"OwnerID":3,"Title":"Website upload","Description":"","StartTimezone":null,"Start":"\/Date(1372318200000)\/","End":"\/Date(1372321800000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":91,"OwnerID":2,"Title":"Meeting with marketing guys","Description":"","StartTimezone":null,"Start":"\/Date(1372352400000)\/","End":"\/Date(1372357800000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":92,"OwnerID":3,"Title":"Meeting with Internet provider","Description":"","StartTimezone":null,"Start":"\/Date(1372415400000)\/","End":"\/Date(1372419000000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":93,"OwnerID":3,"Title":"Bob's Birthday Party","Description":"","StartTimezone":null,"Start":"\/Date(1372536000000)\/","End":"\/Date(1372548600000)\/","EndTimezone":null,"RecurrenceRule":null,"RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":95,"OwnerID":2,"Title":"Dance Practice","Description":"","StartTimezone":null,"Start":"\/Date(1370284200000)\/","End":"\/Date(1370289600000)\/","EndTimezone":null,"RecurrenceRule":"FREQ=WEEKLY;BYDAY=MO,WE","RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":114,"OwnerID":3,"Title":"Software updates","Description":"","StartTimezone":null,"Start":"\/Date(1370336400000)\/","End":"\/Date(1370347200000)\/","EndTimezone":null,"RecurrenceRule":"","RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":115,"OwnerID":1,"Title":"Breakfast at Starbucks","Description":"","StartTimezone":null,"Start":"\/Date(1370332800000)\/","End":"\/Date(1370338200000)\/","EndTimezone":null,"RecurrenceRule":"","RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":116,"OwnerID":2,"Title":"Performance review","Description":"","StartTimezone":null,"Start":"\/Date(1370354400000)\/","End":"\/Date(1370365200000)\/","EndTimezone":null,"RecurrenceRule":"","RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":118,"OwnerID":1,"Title":"HR seminar preparation","Description":"","StartTimezone":null,"Start":"\/Date(1370426400000)\/","End":"\/Date(1370433600000)\/","EndTimezone":null,"RecurrenceRule":"","RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":119,"OwnerID":3,"Title":"Helpdesk weekly meeting","Description":"","StartTimezone":null,"Start":"\/Date(1370444400000)\/","End":"\/Date(1370448000000)\/","EndTimezone":null,"RecurrenceRule":"FREQ=WEEKLY;BYDAY=WE","RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false},{"TaskID":120,"OwnerID":3,"Title":"Website upload","Description":"","StartTimezone":null,"Start":"\/Date(1370588400000)\/","End":"\/Date(1370593800000)\/","EndTimezone":null,"RecurrenceRule":"","RecurrenceID":null,"RecurrenceException":null,"IsAllDay":false}]);};return Appointment;})(AppData.Model);Models.Appointment=Appointment;})(Scheduling.Models||(Scheduling.Models={}));var Models=Scheduling.Models;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var Ccx;(function(Ccx){(function(Scheduling){(function(Models){var ProviderSchedule=(function(_super){__extends(ProviderSchedule,_super);function ProviderSchedule(){_super.call(this);}
ProviderSchedule.prototype.UpdateCalendarStatus=function(EquipmentID,callback){this.DataAccess.update({'ccx_schedulestatus':false},'equipment',EquipmentID,callback);};ProviderSchedule.prototype.GetCalendar=function(calendarid,callback){CrmData.ScheduleData.GetCalendar(calendarid,callback);};ProviderSchedule.prototype.GetCalenderId=function(equipmentid,callback){try{this.DataAccess.query('equipment').select('calendarid').where('equipmentid',AppData.ExpressionOperator.Equals,equipmentid).execute(callback);}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};ProviderSchedule.prototype.GetTimeZone=function(callback){try{var timeZones=[];this.DataAccess.query('timezonedefinition').select('userinterfacename','timezonecode').orderBy('userinterfacename').execute(function(timezone){timezone.forEach(function(elem,i,array){timeZones.push({Text:(elem.userinterfacename)?elem.userinterfacename:"No time zone name found",Value:elem.timezonecode});});callback(timeZones);});}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};ProviderSchedule.prototype.GetFacilityEquipmentResourceIds=function(providerId,callback){try{this.DataAccess.query('equipment').select('equipmentid','name','ccx_agencylocation','calendarid').where('ccx_provider',AppData.ExpressionOperator.Equals,providerId).where('ccx_schedulestatus',AppData.ExpressionOperator.Equals,true).execute(callback);}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};ProviderSchedule.prototype.GetProviderLocations=function(providerId,callback){try{this.DataAccess.query('equipment').select('ccx_agencylocation','equipmentid','ccx_schedulestatus').where('ccx_provider',AppData.ExpressionOperator.Equals,providerId).execute(callback);}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};ProviderSchedule.prototype.GetFaciliytName=function(equipmentId,callback){try{this.DataAccess.single('equipment',equipmentId,callback);}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};ProviderSchedule.prototype.GetAllLocations=function(providerLocations,callback){try{this.GetLocations(providerLocations,function(results){callback(AppData.select(results,function(l){return{FacilityId:l['ccx_agencylocationid'],FacilityName:l['ccx_name'],OfficeAddress:(l['ccx_agencylocationaddress.ccx_addresstype'])?((l['ccx_agencylocationaddress.ccx_addresstype']!='100000000')?((l['ccx_agencylocationaddress.ccx_line1'])?l['ccx_agencylocationaddress.ccx_line1']:'')+((l['ccx_agencylocationaddress.ccx_city'])?(', '+l['ccx_agencylocationaddress.ccx_city']):'')+((l['ccx_agencylocationaddress.ccx_state'])?(', '+l['ccx_agencylocationaddress.ccx_state']):'')+((l['ccx_agencylocationaddress.ccx_postalcode'])?(', '+l['ccx_agencylocationaddress.ccx_postalcode']):''):''):l['ccx_agencylocationaddress.ccx_name'],MainPhone:l['ccx_agencylocationaddress.ccx_telephone1']};}));});}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};ProviderSchedule.prototype.GetLocations=function(providerLocations,callback){try{if(providerLocations){this.DataAccess.query('ccx_agencylocation').select('ccx_agencylocationid','ccx_name','createdon').orderBy('ccx_name',false).where('ccx_name',AppData.ExpressionOperator.NotIn,providerLocations).join('ccx_agencylocationaddress','ccx_parentid','ccx_agencylocationid').select('ccx_name','ccx_telephone1','ccx_addresstype','ccx_line1','ccx_city','ccx_state','ccx_postalcode').execute(callback);}else{this.DataAccess.query('ccx_agencylocation').select('ccx_agencylocationid','ccx_name','createdon').orderBy('ccx_name',false).join('ccx_agencylocationaddress','ccx_parentid','ccx_agencylocationid').select('ccx_name','ccx_telephone1','ccx_addresstype','ccx_line1','ccx_city','ccx_state','ccx_postalcode').execute(callback);}}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};ProviderSchedule.prototype.GetProviderInformation=function(providerId,callback){try{this.DataAccess.query('systemuser').where('systemuserid',AppData.ExpressionOperator.Equals,providerId).select('fullname','systemuserid','businessunitid','photourl','title').join('usersettings','systemuserid','systemuserid').select('timezonecode').execute(callback);}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};ProviderSchedule.prototype.LoadCalendarIdMappings=function(rulesCollection){var CalendIdMappingArray;CalendIdMappingArray=[];if(rulesCollection){$.each(rulesCollection,function(i,rules){if(rules.scheduleInfo){$.each(rules.scheduleInfo,function(j,rule){if(CalendIdMappingArray.length>0){var existingCount=AppData.where(CalendIdMappingArray,function(r){return r.InnerCalendarId===rule['innercalendarid'];});if(existingCount.length===0){CalendIdMappingArray.push({CalendarId:rule['calendarid'],InnerCalendarId:rule['innercalendarid'],Pattern:rule['pattern'],StartTime:rule['starttime'],GroupDesignator:rule['groupdesignator'],EffectiveIntervalEnd:rule['effectiveintervalend'],TimezoneCode:rule['timezonecode'],IsVaried:(rule['isvaried'])?rule['isvaried']:false});}}else{CalendIdMappingArray.push({CalendarId:rule['calendarid'],InnerCalendarId:rule['innercalendarid'],Pattern:rule['pattern'],StartTime:rule['starttime'],GroupDesignator:rule['groupdesignator'],EffectiveIntervalEnd:rule['effectiveintervalend'],TimezoneCode:rule['timezonecode'],IsVaried:(rule['isvaried'])?rule['isvaried']:false});}});}});}
return CalendIdMappingArray;};ProviderSchedule.prototype.GetProviderWorkHours=function(locations,startDate,endDate,callback){var _this=this;try{var CalendarRulesArray;CalendarRulesArray=[];var Rules;Rules=[];var CalendarInnerCalendarIdMappings;CalendarInnerCalendarIdMappings=[];var locCount=0;if(locations){$.each(locations,function(i,loc){_this.GetCalendar(loc.calendarid,function(calendarRules){CalendarRulesArray.push({CalendarId:loc.calendarid,CalendarRules:calendarRules});Rules.push(calendarRules);locCount++;if(locCount===locations.length){CALENDAR_RULES_COLLECTION=CalendarRulesArray;CalendarInnerCalendarIdMappings=_this.LoadCalendarIdMappings(Rules);var resourceIds=AppData.select(locations,function(l){return l.equipmentid;});CrmData.ScheduleData.QueryMultipleSchedulesRequest(resourceIds,startDate,endDate,0,function(results){var allResults=[];$.each(results.TimeInfos,function(i,locationTimes){var locationName='';var locationId='';$.each(locationTimes,function(i,t){if(t.ActivityStatusCode.toString()!=="4"){var calendarRule=AppData.where(CalendarInnerCalendarIdMappings,function(m){return m.InnerCalendarId===t.CalendarId;})[0];locationName=AppData.where(locations,function(l){return l.calendarid===calendarRule.CalendarId;})[0].ccx_agencylocation_name;locationId=AppData.where(locations,function(l){return l.calendarid===calendarRule.CalendarId;})[0].ccx_agencylocation;allResults.push({RecurrenceId:(calendarRule.IsVaried)?calendarRule.GroupDesignator+'-'+AppData.formatDate(calendarRule.StartTime).toString().replace('/','-').replace('/','-'):calendarRule.InnerCalendarId,LinkID:(calendarRule.IsVaried)?calendarRule.GroupDesignator+locationId+'-'+AppData.formatDate(calendarRule.StartTime).toString().replace('/','-').replace('/','-'):calendarRule.InnerCalendarId,Reason:t.DisplayText,Location:locationName,LocationID:locationId,Date:t.Start,StartTime:t.Start,EndTime:t.End,CalendarId:t.CalendarId,IsTimeOff:(t.SubCode==6),IsBreak:(t.SubCode==4),Pattern:calendarRule.Pattern,ParentCalendarId:calendarRule.CalendarId,EffectiveIntervalEnd:(calendarRule.EffectiveIntervalEnd)?calendarRule.EffectiveIntervalEnd:null,ScheduleInfoStartTime:calendarRule.StartTime,TimezoneCode:calendarRule.TimezoneCode,GroupDesignator:calendarRule.GroupDesignator,IsVaried:calendarRule.IsVaried});}});});callback(allResults);});return;}});});}}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');return;}};ProviderSchedule.prototype.GetProviderWorkHourForEdit=function(locationId,locationName,startDate,endDate,callback){try{CrmData.ScheduleData.QueryUserWorkHours([locationId],startDate,endDate,function(results){var allResults=[];$.each(results.TimeInfos,function(i,timeInfo){$.each(timeInfo,function(j,t){allResults.push({RecurrenceId:'',Reason:t.DisplayText,Location:locationName,Date:t.Start,StartTime:t.Start,EndTime:t.End,CalendarId:t.CalendarId,IsTimeOff:(t.SubCode==CrmData.SubCode[6]),IsBreak:(t.SubCode==CrmData.SubCode[4])});});});callback(allResults);});}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};ProviderSchedule.prototype.SaveFacilityEquipment=function(equipment,callback){try{this.DataAccess.create(equipment,"equipment",function(id){equipment.equipmentid=id.toString();callback(id);});}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};return ProviderSchedule;})(AppData.Model);Models.ProviderSchedule=ProviderSchedule;})(Scheduling.Models||(Scheduling.Models={}));var Models=Scheduling.Models;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var Ccx;(function(Ccx){(function(Scheduling){(function(Models){var ProviderSearch=(function(_super){__extends(ProviderSearch,_super);function ProviderSearch(){_super.apply(this,arguments);}
ProviderSearch.prototype.GetProviders=function(name,callback){try{var providers=[];this.DataAccess.query('systemuser').or(function(orExp){orExp.where('lastname',AppData.ExpressionOperator.Contains,'%%'+name+'%%');orExp.where('fullname',AppData.ExpressionOperator.Contains,'%%'+name+'%%');orExp.where('firstname',AppData.ExpressionOperator.Contains,'%%'+name+'%%');}).select('fullname','firstname','lastname','internalemailaddress','systemuserid').orderBy('fullname',false).execute(function(provider){ko.utils.arrayForEach(provider,function(elem){providers.push({Text:elem['fullname']+" | "+((elem['internalemailaddress'])?elem['internalemailaddress']:"No email found"),Value:elem['systemuserid']});});callback(providers);});}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};return ProviderSearch;})(AppData.Model);Models.ProviderSearch=ProviderSearch;})(Scheduling.Models||(Scheduling.Models={}));var Models=Scheduling.Models;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var SchedulingApp;(function(SchedulingApp){function InitApplication(){}
SchedulingApp.InitApplication=InitApplication;})(SchedulingApp||(SchedulingApp={}));var Ccx;(function(Ccx){(function(Scheduling){(function(Models){var Settings=(function(){function Settings(){}
return Settings;})();Models.Settings=Settings;})(Scheduling.Models||(Scheduling.Models={}));var Models=Scheduling.Models;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var CrmData;(function(CrmData){(function(SubCode){SubCode[SubCode["Unspecified"]=0]="Unspecified";SubCode[SubCode["Schedulable"]=1]="Schedulable";SubCode[SubCode["Committed"]=2]="Committed";SubCode[SubCode["Uncommitted"]=3]="Uncommitted";SubCode[SubCode["Break"]=4]="Break";SubCode[SubCode["Holiday"]=5]="Holiday";SubCode[SubCode["Vacation"]=6]="Vacation";SubCode[SubCode["Appointment"]=7]="Appointment";SubCode[SubCode["ResourceStartTime"]=8]="ResourceStartTime";SubCode[SubCode["ResourceServiceRestriction"]=9]="ResourceServiceRestriction";SubCode[SubCode["ResourceCapacity"]=10]="ResourceCapacity";SubCode[SubCode["ServiceRestriction"]=11]="ServiceRestriction";SubCode[SubCode["ServiceCost"]=12]="ServiceCost";})(CrmData.SubCode||(CrmData.SubCode={}));var SubCode=CrmData.SubCode;(function(TimeCode){TimeCode[TimeCode["Available"]=0]="Available";TimeCode[TimeCode["Busy"]=1]="Busy";TimeCode[TimeCode["Unavailable"]=2]="Unavailable";TimeCode[TimeCode["Filter"]=3]="Filter";})(CrmData.TimeCode||(CrmData.TimeCode={}));var TimeCode=CrmData.TimeCode;var ScheduleData=(function(){function ScheduleData(){}
ScheduleData.QueryMultipleSchedulesRequest=function(resourceIds,startDate,endDate,timeCode,callback){try{SoapHelper.soapExecuteRequest('QueryMultipleSchedulesRequest',{ResourceIds:{type:'guid',value:resourceIds},Start:{type:'dateTime',value:startDate},End:{type:'dateTime',value:endDate},TimeCodes:{type:'TimeCode',value:[TimeCode[timeCode]]}},callback);}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};ScheduleData.AddWorkHours=function(startDate,startTime,endDate,endTime,breakStartTime,breakEndTime,equipmentid,days,timezonecode,innercalid,typecode,isedit,isdelete,observe,selecteddate,vbdpattern,recsubtype,callback){try{SoapHelper.soapExecuteRequest('ccx_Schedule',{startDate:{type:'dateTime',value:startDate},endDate:{type:'dateTime',value:endDate},equipment:{type:'EntityReference',value:equipmentid,logicalName:'equipment'},startTime:{type:'string',value:startTime},endTime:{type:'string',value:endTime},breakStartTime:{type:'string',value:breakStartTime},breakEndTime:{type:'string',value:breakEndTime},days:{type:'string',value:days},timezonecode:{type:'int',value:timezonecode},Typecode:{type:'int',value:typecode},isedit:{type:'boolean',value:isedit},isdelete:{type:'boolean',value:isdelete},observe:{type:'boolean',value:observe},Innercalid:{type:'string',value:innercalid},selectedDate:{type:'dateTime',value:selecteddate},vbdpattern:{type:'string',value:vbdpattern},recSubType:{type:'int',value:recsubtype}},callback);}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};ScheduleData.DeleteSchedule=function(equipmentId,innerCalendarId,typecode,selecteddate,recsubtype,callback){SoapHelper.soapExecuteRequest('ccx_Schedule',{startDate:{type:'dateTime',value:$.datepicker.formatDate('yy-mm-dd',new Date())},endDate:{type:'dateTime',value:$.datepicker.formatDate('yy-mm-dd',new Date())},equipment:{type:'EntityReference',value:equipmentId,logicalName:'equipment'},startTime:{type:'string',value:'08:00 AM'},endTime:{type:'string',value:'08:00 AM'},breakStartTime:{type:'string',value:''},breakEndTime:{type:'string',value:''},days:{type:'string',value:''},timezonecode:{type:'int',value:'35'},Typecode:{type:'int',value:typecode},isedit:{type:'boolean',value:false},isdelete:{type:'boolean',value:true},observe:{type:'boolean',value:false},Innercalid:{type:'string',value:innerCalendarId},selectedDate:{type:'dateTime',value:selecteddate},vbdpattern:{type:'string',value:''},recSubType:{type:'int',value:recsubtype}},callback);};ScheduleData.DeleteSingleDaySchedule=function(equipmentId,startDate,innerCalendarId,typecode,selecteddate,recsubtype,callback){SoapHelper.soapExecuteRequest('ccx_Schedule',{startDate:{type:'dateTime',value:$.datepicker.formatDate('yy-mm-dd',new Date())},endDate:{type:'dateTime',value:$.datepicker.formatDate('yy-mm-dd',new Date())},equipment:{type:'EntityReference',value:equipmentId,logicalName:'equipment'},startTime:{type:'string',value:'08:00 AM'},endTime:{type:'string',value:'08:00 AM'},breakStartTime:{type:'string',value:''},breakEndTime:{type:'string',value:''},days:{type:'string',value:''},timezonecode:{type:'int',value:'35'},Typecode:{type:'int',value:typecode},isedit:{type:'boolean',value:false},isdelete:{type:'boolean',value:true},observe:{type:'boolean',value:false},Innercalid:{type:'string',value:innerCalendarId},selectedDate:{type:'dateTime',value:selecteddate},vbdpattern:{type:'string',value:''},recSubType:{type:'int',value:recsubtype}},callback);};ScheduleData.QueryUserWorkHours=function(resourceIds,startDate,endDate,callback){try{SoapHelper.soapExecuteRequest('QueryMultipleSchedulesRequest',{ResourceIds:{type:'guid',value:resourceIds},Start:{type:'dateTime',value:new Date(startDate.setHours(0))},End:{type:'dateTime',value:new Date(endDate.setHours(23,59))},TimeCodes:{type:'TimeCode',value:[TimeCode[0],TimeCode[2]]}},callback);}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};ScheduleData.GetCalendar=function(calendarid,callback){try{var request="<fetch version='1.0' output-format='xml - platform' mapping='logical'><entity name='calendar'><filter type='and'>"+"<condition attribute='calendarid' operator='eq' value='"+calendarid+"'/></filter><all-attributes/></entity></fetch>";SoapHelper.soapExecuteRequest('RetrieveMultipleRequest',{Query:{type:'FetchExpression',value:request}},callback);}catch(ex){AppUI.Popup.showMessage('An Unexpected error has occured.Please try refreshing the application');}};return ScheduleData;})();CrmData.ScheduleData=ScheduleData;var SoapHelper=(function(){function SoapHelper(){}
SoapHelper.soapExecuteRequest=function(actionName,parameters,callback){var requestXML=[];requestXML.push('<request xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts"');requestXML.push('         xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic"');requestXML.push('         xmlns:c="http://schemas.microsoft.com/crm/2011/Contracts"');requestXML.push('         xmlns:d="http://www.w3.org/2001/XMLSchema"');requestXML.push('         xmlns:e="http://www.w3.org/2001/XMLSchema-instance"');requestXML.push('         xmlns:f="http://schemas.microsoft.com/2003/10/Serialization/Arrays">');requestXML.push('<a:Parameters>');var dTypes=['int','decimal','double','boolean','dateTime','string','guid'];$.each(parameters,function(key,param){requestXML.push('<a:KeyValuePairOfstringanyType>');requestXML.push('<b:key>'+key+'</b:key>');if(param.type=='EntityReference'||param.type=='a:EntityReference'){requestXML.push('<b:value e:type="a:EntityReference">');requestXML.push('<a:Id>'+param.value+'</a:Id>');requestXML.push('<a:LogicalName>'+param.logicalName+'</a:LogicalName>');requestXML.push('<a:Name e:nil="true" />');requestXML.push('</b:value>');}else if(param.type=='OptionSetValue'){requestXML.push('<b:value e:type="a:OptionSetValue">');requestXML.push('<a:Value>'+param.value+'</a:Value>');requestXML.push('</b:value>');}else if(param.type=='FetchExpression'||param.type=='a:FetchExpression'){requestXML.push('<b:value e:type="a:FetchExpression">');requestXML.push('<a:Query>'+SoapHelper.encodeValue(param.value)+'</a:Query>');requestXML.push('</b:value>');}else if(param.type){var isCrmType=(param.type.charAt(0).toUpperCase()==param.type.charAt(0));var isPrimType=($.inArray(param.type,dTypes)>-1);if($.isArray(param.value)){var typePrefix=(isPrimType?'f:':isCrmType?'c:':'f:');var itemType=typePrefix+param.type;var arrayType=typePrefix+'ArrayOf'+param.type;requestXML.push('<b:value e:type="'+arrayType+'">');$.each(param.value,function(i,item){requestXML.push('<'+itemType+'>');requestXML.push(SoapHelper.encodeValue(item));requestXML.push('</'+itemType+'>');});requestXML.push('</b:value>');}else{var typePrefix=(isPrimType?'d:':isCrmType?'c:':'f:');var itemType=typePrefix+param.type;requestXML.push('<b:value e:type="'+itemType+'">');requestXML.push(SoapHelper.encodeValue(param.value));requestXML.push('</b:value>');}}else{var type='d:'+SoapHelper.getValueType(param.value);requestXML.push('<b:value e:type="'+type+'">');requestXML.push(SoapHelper.encodeValue(param.value));requestXML.push('</b:value>');}
requestXML.push('</a:KeyValuePairOfstringanyType>');});requestXML.push("</a:Parameters>");requestXML.push("<a:RequestId e:nil=\"true\" />");if(actionName.indexOf('ccx_')==0){requestXML.push("<a:RequestName>"+actionName+"</a:RequestName>");}else{requestXML.push("<a:RequestName>"+actionName.replace('Request','')+"</a:RequestName>");}
requestXML.push("</request>");XrmServiceToolkit.Soap.Execute(requestXML.join(''),function(responseXML){var result={};if(actionName==="RetrieveMultipleRequest"){var itemCollection=[];var nodes=$(responseXML).find("a\\:Entities a\\:Entity a\\:Attributes a\\:Entities a\\:Entity,Entities Entity Attributes Entities Entity");nodes.each(function(i,n){var node=$(n);var attributes=node.find("a\\:attributes, attributes");attributes.each(function(k,nd){var keyvaluePair=$(nd).find("a\\:KeyValuePairOfstringanyType, KeyValuePairOfstringanyType");var item;item={};keyvaluePair.each(function(m,s){var pair=$(s);var key=pair.find('b\\:key, key').text();var valueNodes=pair.find('b\\:value, value');switch(key.toLowerCase()){case"calendarid":var value=valueNodes.find('a\\:id, id');item.calendarid=SoapHelper.convertValue(value.text());break;case"calendarruleid":item.calendarruleid=SoapHelper.convertValue(valueNodes.text());break;case"innercalendarid":var value=valueNodes.find('a\\:id, id');item.innercalendarid=SoapHelper.convertValue(value.text());break;case"starttime":var d=new Date(valueNodes.text());d.setTime(d.getTime()+d.getTimezoneOffset()*60*1000);item.starttime=new Date(d.getFullYear(),d.getMonth(),d.getDate());break;case"timezonecode":item.timezonecode=SoapHelper.convertValue(valueNodes.text());break;case"effectiveintervalend":item.effectiveintervalend=SoapHelper.convertValue(valueNodes.text());break;case"isvaried":item.isvaried=SoapHelper.convertValue(valueNodes.text());break;case"pattern":item.pattern=SoapHelper.convertValue(valueNodes.text());break;case"groupdesignator":item.groupdesignator=SoapHelper.convertValue(valueNodes.text());break;}});if(item){itemCollection.push(item);}});});if(itemCollection.length>0){result["scheduleInfo"]=itemCollection;}}else{var nodes=$(responseXML).find('a\\:Results a\\:KeyValuePairOfstringanyType, KeyValuePairOfstringanyType');nodes.each(function(i,n){var node=$(n);var key=node.find('b\\:key, key').text();var valueNodes=node.find('b\\:value, value');if(valueNodes[0]&&valueNodes[0].childNodes[0]&&valueNodes[0].childNodes[0].nodeType==1){if(valueNodes[0].childNodes[0].nodeName.indexOf('ArrayOf')>-1){if(valueNodes[0].childNodes.length>0){var multi=[];$.each(valueNodes[0].childNodes,function(m,outer){var items=[];$.each(outer.childNodes,function(o,obj){var item={};$.each(obj.childNodes,function(p,prop){var name=(prop.nodeName.indexOf(':')>-1?prop.nodeName.split(':')[1]:prop.nodeName);item[name]=SoapHelper.convertValue($(prop).text());});items.push(item);});multi.push(items);});result[key]=multi;}else{var items=[];$.each(valueNodes[0].childNodes[0].childNodes,function(o,obj){var item={};$.each(obj.childNodes,function(p,prop){var name=(prop.nodeName.indexOf(':')>-1?prop.nodeName.split(':')[1]:prop.nodeName);item[name]=SoapHelper.convertValue($(prop).text());});items.push(item);});result[key]=items;}}else{var item={};$.each(valueNodes[0].childNodes[0].childNodes,function(p,prop){var name=(prop.nodeName.indexOf(':')>-1?prop.nodeName.split(':')[1]:prop.nodeName);item[name]=SoapHelper.convertValue($(prop).text());});result[key]=item;}}else{result[key]=SoapHelper.convertValue(valueNodes.text());}});}
callback(result);});};SoapHelper.encodeValue=function(value){if(value===0)
return'0';if(value===true)
return'true';if(value===false)
return'false';if(!value)
return'';return(typeof(value)==='object'&&value.getTime?SoapHelper.encodeDate(value):SoapHelper.xmlEncode(value.toString()));};SoapHelper.xmlEncode=function(text){if(text===null||typeof text!='string')
return text;text=text.replace(/&/g,'&amp;');text=text.replace(/\"/g,'&quot;');text=text.replace(/\'/g,'&apos;');text=text.replace(/</g,'&lt;');text=text.replace(/>/g,'&gt;');return text;};SoapHelper.encodeDate=function(dateTime){return dateTime.getFullYear()+"-"+SoapHelper.padNumber(dateTime.getMonth()+1)+"-"+SoapHelper.padNumber(dateTime.getDate())+"T"+SoapHelper.padNumber(dateTime.getHours())+":"+SoapHelper.padNumber(dateTime.getMinutes())+":"+SoapHelper.padNumber(dateTime.getSeconds());};SoapHelper.padNumber=function(str,len){if(typeof len==="undefined"){len=2;}
str=(str&&str.toString())||'';while(str.length<len){str='0'+str;}
return str;};SoapHelper.convertValue=function(val){if(val==='true'){return true;}else if(val==='false'){return false;}else if(val>0){return parseFloat(val);}else if(val&&val.indexOf('20')==0&&val.indexOf('T')>-1&&val.slice(-1)=='Z'){return AppData.parseDate(val);}else{return val;}};SoapHelper.getValueType=function(val){var valStr=((val&&val.toString())||'');if(val===true||val===false){return'boolean';}else if(valStr.indexOf('.')>-1&&(val===0||val>0)){return'decimal';}else if(val===0||val>0){return'int';}else if(val&&typeof(val)=='object'&&val.getTime){return'dateTime';}else if(valStr.length==36&&valStr.split('-').join('').length==32){return'guid';}else if(valStr.length==38&&valStr.split('-').join('').length==34){return'guid';}else{return'string';}};return SoapHelper;})();CrmData.SoapHelper=SoapHelper;var Common=(function(){function Common(){}
Common.showMessage=function(message,duration){AppUI.Popup.showMessage(message,duration);Common.enableHTMLScroll();};Common.enableHTMLScroll=function(){if($("html")){$("html").css("overflow","auto");}};Common.disableHTMLScroll=function(){if($("html")){$("html").css("overflow","hidden");}};Common.ShowBusyIndicator=function(){};Common.HideBusyIndicator=function(){};return Common;})();CrmData.Common=Common;var SingletonClass=(function(){function SingletonClass(){SingletonClass._instance=this;}
SingletonClass.setDocumentClickHandler=function(){if(SingletonClass._instance==null){SingletonClass._instance=new SingletonClass();$(document).click(function(o){try{var src=o.target;if(src&&src.getAttribute&&!(src.getAttribute('id')=="FilterButtonImg"||src.getAttribute('id')=="FilterButton")&&$('#ddllocations')&&$('#ddllocations:visible').length>0){$('#ddllocations').stop().slideUp(500);}}catch(ex){console.log(ex);}});}};SingletonClass._instance=null;return SingletonClass;})();CrmData.SingletonClass=SingletonClass;})(CrmData||(CrmData={}));var CrmData;(function(CrmData){(function(MonthNames){MonthNames[MonthNames["January"]=0]="January";MonthNames[MonthNames["February"]=1]="February";MonthNames[MonthNames["March"]=2]="March";MonthNames[MonthNames["April"]=3]="April";MonthNames[MonthNames["May"]=4]="May";MonthNames[MonthNames["June"]=5]="June";MonthNames[MonthNames["July"]=6]="July";MonthNames[MonthNames["August"]=7]="August";MonthNames[MonthNames["September"]=8]="September";MonthNames[MonthNames["October"]=9]="October";MonthNames[MonthNames["November"]=10]="November";MonthNames[MonthNames["December"]=11]="December";})(CrmData.MonthNames||(CrmData.MonthNames={}));var MonthNames=CrmData.MonthNames;(function(WeekDays){WeekDays[WeekDays["Sunday"]=0]="Sunday";WeekDays[WeekDays["Monday"]=1]="Monday";WeekDays[WeekDays["Tuesday"]=2]="Tuesday";WeekDays[WeekDays["Wednesday"]=3]="Wednesday";WeekDays[WeekDays["Thursday"]=4]="Thursday";WeekDays[WeekDays["Friday"]=5]="Friday";WeekDays[WeekDays["Saturday"]=6]="Saturday";})(CrmData.WeekDays||(CrmData.WeekDays={}));var WeekDays=CrmData.WeekDays;var CalendarUtils=(function(){function CalendarUtils(){}
CalendarUtils.GetWeekDays=function(dateTimeStr){var dte=(dateTimeStr)?new Date(dateTimeStr):new Date();var firstDayOfWeek=new Date(dte.toString());firstDayOfWeek.setDate(dte.getDate()-dte.getDay());var weekArrStr=new Array();weekArrStr.push(firstDayOfWeek);for(var i=1;i<=6;i++){dte=new Date(firstDayOfWeek.toString());dte.setDate(firstDayOfWeek.getDate()+i);weekArrStr.push(dte);}
return weekArrStr;};CalendarUtils.getMonthName=function(date){var month=date.getMonth();return MonthNames[month];};CalendarUtils.daysAreEqual=function(date1,date2){var date=new Date(date1);return(date.getFullYear()==date2.getFullYear()&&date.getMonth()==date2.getMonth()&&date.getDate()==date2.getDate());};CalendarUtils.GetProviderAppointments=function(providerId,startDate,endDate,callback){var _this=this;var doneLoading=AppUI.loading('Loading...',1,$('.scheduling-provider-appointmenthours-appointmentweekly')[0]);var allAppointments=[];var providerLocations=[];var appointmentMode=new Ccx.Scheduling.Models.Appointment();appointmentMode.GetProviderAppointmentsByDate(providerId,startDate,endDate,function(appointments){if(appointments.length>0){appointments=AppData.sort(appointments,function(l){return(l['activityparty.partyid_name']).split('-')[1];},false);var facilityName;for(var i=0;i<appointments.length;i++){facilityName=appointments[i]['activityparty.partyid_name'];allAppointments.push({subject:appointments[i]['subject'],scheduledstart:appointments[i]['scheduledstart'],scheduledend:appointments[i]['scheduledend'],isalldayevent:appointments[i]['isalldayevent'],activityid:appointments[i]['activityid'],scheduleddurationminutes:appointments[i]['scheduleddurationminutes'],equipmentid:appointments[i]['activityparty.partyid'],name:appointments[i]['activityparty.partyid_name'],bordercolorcode:ko.observable(''),color:ko.observable(''),location:facilityName.split('-')[1].toString().trim(),regardingobjectid:appointments[i]['regardingobjectid'],regardingobjectidname:appointments[i]['regardingobjectid_name'],title:_this.GetTitleForAppointment(appointments[i])});providerLocations.push({LocationName:(facilityName.split('-')[1].length>20?facilityName.split('-')[1].substring(1,19)+'...':facilityName.split('-')[1]),Id:appointments[i]['activityparty.partyid'],PartialLocationName:(facilityName.split('-')[1].length>20?facilityName.split('-')[1].substring(1,19)+'...':facilityName.split('-')[1]),ScheduledStart:appointments[i]['scheduledstart'],BorderColorCode:ko.observable(''),Color:ko.observable('')});}}
doneLoading();providerLocations=AppData.distinct(providerLocations,function(l){return l.Id;});var returnObj={"allAppointments":allAppointments,"providerLocations":providerLocations};callback(returnObj);});};CalendarUtils.GetTitleForAppointment=function(app){var text;text='Date: '+AppData.formatDate(app['scheduledstart'])+"( "+AppData.formatTime(app['scheduledstart'])+" - "+AppData.formatTime(app['scheduledend'])+")";if(app["regardingobjectid_name"]){text+="\n Patient: "+app["regardingobjectid_name"];}
text+="\n Facility: "+(app['activityparty.partyid_name']).split('-')[1].toString().trim();return text;};CalendarUtils.ColorMapping=function(ProviderLocations){var locCount=ProviderLocations().length;var i=0;var m=locCount/(CalendarUtils.colors.length);var reminder=locCount%(CalendarUtils.colors.length);if(m>=1){while(i<locCount){for(var y=1;y<=m;y++){for(var z=0;z<this.colors.length;z++){if(ProviderLocations()[i]){ProviderLocations()[i]["BorderColorCode"](this.colors[z]["BorderColor"]);ProviderLocations()[i]["Color"](this.colors[z]["color"]);i=i+1;}}}
if(reminder>=1){for(var k=0;k<reminder;k++){if(ProviderLocations()[i]){ProviderLocations()[i]["BorderColorCode"](this.colors[k]["BorderColor"]);ProviderLocations()[i]["Color"](this.colors[k]["color"]);i=i+1;}}}}}else{for(var z=0;z<this.colors.length;z++){if(ProviderLocations()[i]){ProviderLocations()[i]["BorderColorCode"](this.colors[z]["BorderColor"]);ProviderLocations()[i]["Color"](this.colors[z]["color"]);i=i+1;}}}};CalendarUtils.ColorMappingAppointment=function(appointments,ProviderLocations){var location;ko.utils.arrayForEach(appointments(),function(app){location=AppData.where(ProviderLocations,function(loc){return(loc.Id==app.equipmentid);});if(location&&location.length>0){app.bordercolorcode(location[0]["BorderColorCode"]);app.color(location[0]["Color"]);}});};CalendarUtils.colors=[{'color':'#F4A49B','BorderColor':'#E41300'},{'color':'#DD9DAB','BorderColor':'#9F0625'},{'color':'#A6E4F3','BorderColor':'#19A0E0'},{'color':'#B6DCB7','BorderColor':'#038D02'},{'color':'#FAC8EB','BorderColor':'#F374CF'},{'color':'#C1FFC0','BorderColor':'#01FE03'},{'color':'#FEC49E','BorderColor':'#FB6600'},{'color':'#C6D1c1','BorderColor':'#69885E'},{'color':'#C8C1D1','BorderColor':'#776188'}];return CalendarUtils;})();CrmData.CalendarUtils=CalendarUtils;})(CrmData||(CrmData={}));var Ccx;(function(Ccx){(function(Scheduling){(function(ViewModels){var AdministrationViewModel=(function(){function AdministrationViewModel(){this.SelectedView=ko.observable('');this.CalendarSubMenuVisibility=ko.observable(false);this.IsManualSchedulerVisible=ko.observable(this.CalendarSubMenuVisibility());this.clicks=0;CrmData.SingletonClass.setDocumentClickHandler();}
AdministrationViewModel.prototype.SetCalendarSubMenuVisibility=function(){this.CalendarSubMenuVisibility(true);this.LoadView('Scheduling-ProviderProfileDisplay','LeftPanelTargetContainer',new ViewModels.ProviderProfileViewModel());};AdministrationViewModel.prototype.SetSubMenusVisibility=function(){this.CalendarSubMenuVisibility(false);$("#LeftPanelTargetContainer").empty();};AdministrationViewModel.prototype.LoadView=function(viewName,targetContainer,viewContext){App.View.load({ViewName:viewName,ViewContext:viewContext},document.getElementById(targetContainer));};return AdministrationViewModel;})();ViewModels.AdministrationViewModel=AdministrationViewModel;})(Scheduling.ViewModels||(Scheduling.ViewModels={}));var ViewModels=Scheduling.ViewModels;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var Ccx;(function(Ccx){(function(Scheduling){(function(ViewModels){var CalendarAdministrationMyServicesViewModel=(function(){function CalendarAdministrationMyServicesViewModel(){this.ColumnValue=ko.observableArray([{Text:'',Value:''},{Text:'Tribridge North',Value:'TBN'},{Text:'Westgate',Value:'WES'},{Text:'Riverside',Value:'RVS'},{Text:'Cedar Hills',Value:'CDH'},{Text:'Misty Vale',Value:'MSV'}]);this.RowValue=ko.observableArray([{Text:'Art Therapy Individual',Value:'ATI'},{Text:'Art Therapy Group',Value:'ATG'},{Text:'Medication Management',Value:'MDM'},{Text:'Substance Abuse Individual',Value:'SAI'},{Text:'Substance Abuse Group',Value:'SAG'},{Text:'Methadone Treatment',Value:'MDT'},{Text:'Residential Services-Adult',Value:'RSA'},{Text:'UCR Services - Per Encounter',Value:'USE'}]);}
CalendarAdministrationMyServicesViewModel.prototype.test3=function(){AppUI.Popup.showMessage('Testing',5);};return CalendarAdministrationMyServicesViewModel;})();ViewModels.CalendarAdministrationMyServicesViewModel=CalendarAdministrationMyServicesViewModel;})(Scheduling.ViewModels||(Scheduling.ViewModels={}));var ViewModels=Scheduling.ViewModels;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var Ccx;(function(Ccx){(function(Scheduling){(function(ViewModels){var ConfirmationViewModel=(function(){function ConfirmationViewModel(IsConflict,conflictFacilityName,ConflictSchedule,OnSave){this.OnSave=OnSave;this.IsConflict=ko.observable(IsConflict||false);this.ConflictFacilityName=ko.observable(conflictFacilityName||'');this.ConflictSchedule=ko.observable(ConflictSchedule||'');}
ConfirmationViewModel.prototype.SaveConflict=function(){this.OnSave(true);};ConfirmationViewModel.prototype.CancelConflict=function(){AppUI.Popup.hideAll();};return ConfirmationViewModel;})();ViewModels.ConfirmationViewModel=ConfirmationViewModel;})(Scheduling.ViewModels||(Scheduling.ViewModels={}));var ViewModels=Scheduling.ViewModels;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var NOLOCATIONFOUND='There is no location(s) found';var NOCALENDARINFOFOUND='There is no calendar info found';var NOWORKHOURFOUND='There are no work hours found';var Ccx;(function(Ccx){(function(Scheduling){(function(ViewModels){(function(Provider){(function(WorkHours){(function(LocationColorCode){LocationColorCode[LocationColorCode["Green"]=0]="Green";LocationColorCode[LocationColorCode["Blue"]=1]="Blue";LocationColorCode[LocationColorCode["Orange"]=2]="Orange";LocationColorCode[LocationColorCode["Purple"]=3]="Purple";LocationColorCode[LocationColorCode["Red"]=4]="Red";LocationColorCode[LocationColorCode["Yellow"]=5]="Yellow";LocationColorCode[LocationColorCode["Pink"]=6]="Pink";})(WorkHours.LocationColorCode||(WorkHours.LocationColorCode={}));var LocationColorCode=WorkHours.LocationColorCode;(function(CalendarScheduleType){CalendarScheduleType[CalendarScheduleType["Weekly"]=0]="Weekly";CalendarScheduleType[CalendarScheduleType["Daily"]=1]="Daily";CalendarScheduleType[CalendarScheduleType["TimeOff"]=2]="TimeOff";CalendarScheduleType[CalendarScheduleType["Break"]=3]="Break";CalendarScheduleType[CalendarScheduleType["Entire"]=4]="Entire";})(WorkHours.CalendarScheduleType||(WorkHours.CalendarScheduleType={}));var CalendarScheduleType=WorkHours.CalendarScheduleType;var CalendarViewModel=(function(){function CalendarViewModel(data){var _this=this;this.ParameterDeclaration(data);this.GetAllLocation();this.CalendarRows=ko.computed(function(){var selectedDate=_this.SelectedDate();var thisMonth=new Date(selectedDate.getFullYear(),selectedDate.getMonth(),1);var startDate=new Date(selectedDate.getFullYear(),selectedDate.getMonth(),-(thisMonth.getDay()-1));var days=[];for(var d=0;d<=42;d++){var date=new Date(startDate.getFullYear(),startDate.getMonth(),startDate.getDate()+d);days.push({IsCurrentMonth:date.getMonth()==selectedDate.getMonth(),Month:date.getMonth()+1,Day:date.getDate(),Date:date});}
var rows=[];for(var d=0;d<=days.length;d++){if(d%7==0){rows.push({Days:days.slice(d-7,d)});}}
return rows;});this.formatLocationInRows();CrmData.SingletonClass.setDocumentClickHandler();}
CalendarViewModel.prototype.formatLocationInRows=function(){var _this=this;this.LocationRows=ko.computed(function(){var result=[],row,colLength=3;for(var i=0,j=_this.ProviderLocations().length;i<j;i++){if(i%colLength===0){if(row){result.push(row);}
row=[];}
row.push(_this.ProviderLocations()[i]);}
if(row){result.push(row);}
return result;});};CalendarViewModel.prototype.ParameterDeclaration=function(data){var _this=this;this.IsWorkhouRefreshed=ko.observable(false);this.TimezoneCode=data.timezonecode||'';this.ProviderId=ko.observable(data.providerId);this.FilteredLocation=ko.observable('');this.SelectAll=ko.observable(false);this.SelectedItemIds=ko.observableArray([]);this.colors=[{'color':'#F4A49B','BorderColor':'#E41300'},{'color':'#DD9DAB','BorderColor':'#9F0625'},{'color':'#A6E4F3','BorderColor':'#19A0E0'},{'color':'#B6DCB7','BorderColor':'#038D02'},{'color':'#FAC8EB','BorderColor':'#F374CF'},{'color':'#C1FFC0','BorderColor':'#01FE03'},{'color':'#FEC49E','BorderColor':'#FB6600'},{'color':'#C6D1c1','BorderColor':'#69885E'},{'color':'#C8C1D1','BorderColor':'#776188'}];REMOVE_ITEM_DELEGATE_TEMP=this.removeItem.bind(this);this.SelectedDate=ko.observable(data.selectedDate||new Date());this.SelectedMonth=ko.computed(function(){return _this.getMonthName(_this.SelectedDate());});this.WorkHours=ko.observableArray([]);this.FilterWorkHours=[];this.ProviderLocations=ko.observableArray([]);this.SelectedMonthLocations=ko.observableArray([]);var providerModel=new Scheduling.Models.ProviderSchedule();};CalendarViewModel.prototype.GetAllLocation=function(){var _this=this;try{var providerModel=new Scheduling.Models.ProviderSchedule();providerModel.GetProviderLocations(this.ProviderId(),function(locations){if(locations){locations=AppData.sort(locations,function(l){return l.ccx_agencylocation_name;},false);_this.ProviderLocations(AppData.select(locations,function(item){return{LocationName:item['ccx_agencylocation_name'],Id:item['equipmentid'],PartialLocationName:(item['ccx_agencylocation_name'].length>20)?item['ccx_agencylocation_name'].substring(0,19)+'...':item['ccx_agencylocation_name'],BorderColorCode:ko.observable(''),Color:ko.observable(''),IsActive:item['ccx_schedulestatus']};}));_this.ColorMapping();}});this.SelectedDate.subscribe(function(){_this.IsWorkhouRefreshed=ko.observable(false);_this.getFacilityResourceIds(_this.ProviderId());});if(!this.IsWorkhouRefreshed()){this.getFacilityResourceIds(this.ProviderId());}}catch(ex){console.log(ex);}};CalendarViewModel.prototype.ColorMapping=function(){var locCount=this.ProviderLocations().length;var i=0;var m=locCount/(this.colors.length);var reminder=locCount%(this.colors.length);if(m>=1){while(i<locCount){for(var y=1;y<=m;y++){for(var z=0;z<this.colors.length;z++){if(this.ProviderLocations()[i]){this.ProviderLocations()[i]["BorderColorCode"](this.colors[z]["BorderColor"]);this.ProviderLocations()[i]["Color"](this.colors[z]["color"]);i=i+1;}}}
if(reminder>=1){for(var k=0;k<reminder;k++){if(this.ProviderLocations()[i]){this.ProviderLocations()[i]["BorderColorCode"](this.colors[k]["BorderColor"]);this.ProviderLocations()[i]["Color"](this.colors[k]["color"]);i=i+1;}}}}}else{for(var z=0;z<this.colors.length;z++){if(this.ProviderLocations()[i]){this.ProviderLocations()[i]["BorderColorCode"](this.colors[z]["BorderColor"]);this.ProviderLocations()[i]["Color"](this.colors[z]["color"]);i=i+1;}}}};CalendarViewModel.prototype.prevMonth=function(){try{var selectedDate=this.SelectedDate();var newMonth=new Date(selectedDate.getFullYear(),selectedDate.getMonth()-1,1);this.SelectedDate(newMonth);}catch(ex){console.log(ex);}};CalendarViewModel.prototype.nextMonth=function(){try{var selectedDate=this.SelectedDate();var newMonth=new Date(selectedDate.getFullYear(),selectedDate.getMonth()+1,1);this.SelectedDate(newMonth);}catch(ex){console.log(ex);}};CalendarViewModel.prototype.showPopup=function(element,title){if(typeof element==="undefined"){element=null;}
if(typeof title==="undefined"){title='';}
CrmData.Common.disableHTMLScroll();if(!element){element=document.createElement('DIV');}
var contentWidth=$(element).innerWidth();var contentHeight=$(element).innerHeight();var elementOwner=element.parentNode;var closePopupDelegate=element['closePopup']=function(e,data){if($(popupElement).find('#spnDataChanged').text().toLowerCase()=="true"){var scheduleType=($(popupElement).find('#spnScheduleType').text().toLowerCase()=="true")?'Recurring':'Single Day';AppUI.confirm('Your changes will be lost if you continue, press yes to close or no to return to Set '+scheduleType+' Schedule',function(){return contentElement.fadeOut('fast',function(){if(popupElement){if(elementOwner){elementOwner.appendChild(element);}
$(popupElement).remove();popupElement=null;if($('.ccx-ui-popup-container').length==0){document.body.style.overflow='auto';}
if(element['onHidePopup']){element['onHidePopup']();}}
CrmData.Common.enableHTMLScroll();});});}else{if(popupElement){if(elementOwner){elementOwner.appendChild(element);}
$(popupElement).remove();popupElement=null;if($('.ccx-ui-popup-container').length==0){document.body.style.overflow='auto';}
if(element['onHidePopup']){element['onHidePopup']();}}
CrmData.Common.enableHTMLScroll();}};element['hidePopup']=function(){if(popupElement){$('.ccx-ui-popup',popupElement).fadeOut('fast');$('#w2ui-global-items').remove();}};element['showPopup']=function(){if(popupElement){$('.ccx-ui-popup',popupElement).fadeIn('fast');}};var popupElement=AppUI.createElementTree({'@class':'ccx-ui-popup-container','.ccx-ui-popup-shade':{},'.ccx-ui-popup':{'.ccx-ui-popup-content':{'onclick':function(e){return AppUI.cancelEvent(e);},'.ccx-ui-popup-title':{'.ccx-ui-popup-close':{'onclick':function(e){return closePopupDelegate(e);}},'H4':title},'.ccx-ui-popup-body':element}}});var contentElement=$('.ccx-ui-popup-content',popupElement);$(contentElement).css('max-width','870px');var bodyElement=$('.ccx-ui-popup-body',popupElement);if($('.ccx-ui-popup-shade').length>0){$('.ccx-ui-popup-shade',popupElement).remove();contentElement.addClass('ccx-ui-noshadow');}
if(contentWidth>0){contentElement.width(contentWidth);}
if(contentHeight>0){bodyElement.css("overflow","auto");}
contentElement.hide();document.body.style.overflow='auto';$(popupElement).appendTo(document.body);contentElement.fadeIn('slow');return element;};CalendarViewModel.prototype.showRelated=function(item){$('.schedule-item').removeClass('related');if(this.HighlightedItem){this.HighlightedItem.LinkVisible=false;}
if(!item.LinkVisible&&item.LinkId){item.LinkVisible=true;$('.link-'+item.LinkId).addClass('related');this.HighlightedItem=item;}};CalendarViewModel.prototype.hideRelated=function(item){if(item.LinkVisible&&item.LinkId){item.LinkVisible=false;$('.link-'+item.LinkId).removeClass('related');}};CalendarViewModel.prototype.showDetail=function(item){var element=AppUI.Popup.show(null,'Schedule Detail');CrmData.Common.disableHTMLScroll();$(element).addClass('read-only').addClass('ccx-page').addClass('static');App.View.load({ViewName:'Scheduling-Provider-WorkHours-WorkHourFlyout',ViewContext:item},element);};CalendarViewModel.prototype.removeItem=function(item){var _this=this;try{$(document).click();if(item.LinkId){this.selectRecurrence(item.Date,function(r){AppUI.Popup.hideAll();if(r=='Single'){_this.WorkHours.remove(item);}else if(r=='Remaining'){_this.WorkHours.remove(function(wh){return wh.LinkId==item.LinkId&&wh.Date>=item.Date;});}else if(r=='All'){_this.WorkHours.remove(function(wh){return wh.LinkId==item.LinkId;});}});}else{if(AppUI.confirm('Are you sure you want to remove this item?',function(){_this.WorkHours.remove(item);}));}}catch(ex){console.log(ex);}};CalendarViewModel.prototype.addLocation=function(date){var _this=this;try{var self=this;if(self.ProviderLocations().length>0){var providerModel=new Scheduling.Models.ProviderSchedule();var providerLocations=AppData.select(self.ProviderLocations(),function(location){return location.LocationName;});var element=AppUI.Popup.show(null,'Select a Facility To Add:');CrmData.Common.disableHTMLScroll();App.View.load({ViewName:'Scheduling-Provider-WorkHours-AddLocationPopup',ViewContext:new WorkHours.LocationViewModel(providerLocations,this.ProviderId(),this.TimezoneCode,function(id){providerModel.GetProviderLocations(_this.ProviderId(),function(locations){_this.ProviderLocations(AppData.select(locations,function(item){return{LocationName:item['ccx_agencylocation_name'],Id:item['equipmentid'],PartialLocationName:(item['ccx_agencylocation_name'].length>20)?item['ccx_agencylocation_name'].substring(0,19)+'...':item['ccx_agencylocation_name'],BorderColorCode:ko.observable(''),Color:ko.observable(''),IsActive:item['ccx_schedulestatus']};}));_this.ColorMapping();});self.reload();self.selectType(function(type){AppUI.Popup.hideAll();CrmData.Common.enableHTMLScroll();_this.showSchedule(type,id,null,date);});})},element);}}catch(ex){console.log(ex);}};CalendarViewModel.prototype.addItem=function(date){var _this=this;try{if(this.ProviderLocations().length>0){this.selectLocation(this.LocationRows(),function(location){AppUI.Popup.hideAll();CrmData.Common.enableHTMLScroll();if(location=="Add New"){_this.addLocation(date);}else{_this.selectType(function(type){_this.SelectedDateForAddItem=date;AppUI.Popup.hideAll();CrmData.Common.enableHTMLScroll();_this.showSchedule(type,location['Id'],undefined,date);});}});}else{var providerModel=new Scheduling.Models.ProviderSchedule();var element=AppUI.Popup.show(null,'Select a Facility To Add:');CrmData.Common.disableHTMLScroll();App.View.load({ViewName:'Scheduling-Provider-WorkHours-AddLocationPopup',ViewContext:new WorkHours.LocationViewModel(null,this.ProviderId(),this.TimezoneCode,function(id){if(id){_this.reload();_this.selectType(function(type){AppUI.Popup.hideAll();CrmData.Common.enableHTMLScroll();_this.showSchedule(type,id,null,date);});}else{providerModel.GetAllLocations(null,function(locations){_this.ProviderLocations(AppData.select(locations,function(item){return{LocationName:item['ccx_agencylocation_name'],Id:item['equipmentid'],PartialLocationName:(item['ccx_agencylocation_name'].length>20)?item['ccx_agencylocation_name'].substring(0,19)+'...':item['ccx_agencylocation_name'],BorderColorCode:ko.observable(''),Color:ko.observable(''),IsActive:item['ccx_schedulestatus']};}));});}})},element);}}catch(ex){console.log(ex);}};CalendarViewModel.prototype.showSchedule=function(type,equipmentID,selectedDayDetails,selectedDayDate){var self=this;var element=null;var viewContext=null;var ViewName="Scheduling-WeeklySchedule";switch(type){case 0:element=this.showPopup(null,"Set Recurring Weekly Schedule");viewContext=new Ccx.Scheduling.ViewModels.WeeklyScheduleViewModel(0,this.TimezoneCode,equipmentID,undefined,selectedDayDate,undefined,false,null,this.ProviderId(),function(onsave){if(onsave){self.reload();}});break;case 1:if(selectedDayDetails){element=this.showPopup(null,"Edit Schedule");viewContext=new Ccx.Scheduling.ViewModels.WeeklyScheduleViewModel(1,this.TimezoneCode,equipmentID,selectedDayDetails,null,undefined,false,null,this.ProviderId(),function(onsave){if(onsave){self.reload();}});}else{element=this.showPopup(null,"Set Work Hours and Service Restrictions");viewContext=new Ccx.Scheduling.ViewModels.WeeklyScheduleViewModel(1,this.TimezoneCode,equipmentID,undefined,selectedDayDate,undefined,false,null,this.ProviderId(),function(onsave){if(onsave){self.reload();}});}
break;}
$(element).addClass('ccx-page').css('position','static');App.View.load({ViewName:ViewName,ViewContext:viewContext},element);};CalendarViewModel.prototype.showEditOption=function(data,Index,scheduleInfoArray){var self=this;var equipmentid=AppData.where(this.ProviderLocations(),function(l){return l.LocationName==data.Location;})[0]['Id'];var element=AppUI.Popup.show(null,"Edit Schedule");CrmData.Common.disableHTMLScroll();var ViewName="Scheduling-Schedule-ScheduleType";App.View.load({ViewName:ViewName,ViewContext:new Ccx.Scheduling.ViewModels.ScheduleTypeViewModel(data,equipmentid,this.TimezoneCode,scheduleInfoArray,function(onsave){self.reload();})},element);$('#w2ui-overlay').find('.close').click();};CalendarViewModel.prototype.selectLocation=function(arrayOfLocations,callback){try{var element=AppUI.Popup.show(null,'Add Schedule');CrmData.Common.disableHTMLScroll();App.View.load({ViewName:'Scheduling-Provider-WorkHours-ScheduleLocationPopup',ViewContext:{locations:arrayOfLocations,select:callback.bind(this),location:function(l){callback(l);}}},element);}catch(ex){console.log(ex);}};CalendarViewModel.prototype.selectType=function(callback){try{var element=AppUI.Popup.show(null,'Add Schedule');CrmData.Common.disableHTMLScroll();App.View.load({ViewName:'Scheduling-Provider-WorkHours-ScheduleTypePopup',ViewContext:{select:callback.bind(this)}},element);}catch(ex){console.log(ex);}};CalendarViewModel.prototype.selectRecurrence=function(date,callback){try{var element=AppUI.Popup.show(null,'Remove Schedule');CrmData.Common.disableHTMLScroll();App.View.load({ViewName:'Scheduling-Provider-WorkHours-ScheduleRecurrencePopup',ViewContext:{date:date,select:callback.bind(this)}},element);}catch(ex){console.log(ex);}};CalendarViewModel.prototype.getMonthName=function(date){try{var month=date.getMonth();return MonthNames[month];}catch(ex){console.log(ex);}};CalendarViewModel.prototype.daysAreEqual=function(date1,date2){if(date1&&date2){return(date1.getFullYear()==date2.getFullYear()&&date1.getMonth()==date2.getMonth()&&date1.getDate()==date2.getDate());}};CalendarViewModel.prototype.reload=function(){try{this.FilteredLocation('');$("#ddllocations").css("display","none");this.IsWorkhouRefreshed(false);this.getFacilityResourceIds(this.ProviderId());this.GetAllLocation();}catch(ex){console.log(ex);}};CalendarViewModel.prototype.filter=function(event){$('#ddllocations').stop().slideToggle(500);};CalendarViewModel.prototype.HighLightSelection=function(viewdata,event,data,Index){$('.calendar-table').find('.schedule-item.selected').removeClass('selected');$('.calendar-table').find('.calendar-day.selected').removeClass('selected');$(event.srcElement).parent('.schedule-item').addClass("selected");$(event.srcElement).closest('.calendar-day').addClass("selected");};CalendarViewModel.prototype.filterLocation=function(selected){try{this.WorkHours(this.FilterWorkHours.filter(function(wh){return wh.Location==selected.LocationName;}));this.FilteredLocation(selected);$('#ddllocations').stop().slideUp(500);}catch(ex){console.log(ex);}};CalendarViewModel.prototype.getFacilityResourceIds=function(providerId){var _this=this;try{if(!this.IsWorkhouRefreshed()){var NoworkHours=true;var count=0;var providerModel=new Scheduling.Models.ProviderSchedule();var providerProfile=new ViewModels.ProviderProfileViewModel();this.SelectedMonthLocations.removeAll();providerModel.GetFacilityEquipmentResourceIds(providerId,function(locations){if(locations&&locations.length>0){NoworkHours=false;_this.updateWorkHours(_this.SelectedDate(),locations);}else{_this.WorkHours([]);CrmData.Common.showMessage(NOWORKHOURFOUND);}});this.IsWorkhouRefreshed=ko.observable(true);}}catch(ex){console.log(ex);}};CalendarViewModel.prototype.EditWorkHours=function(schedule,e,Index){$(document).click();schedule.ScheduleTypeInfo.ProviderID=this.ProviderId();if($(e.srcElement).parent('.schedule-item').hasClass('selected')){schedule.EquipmentId=AppData.where(this.ProviderLocations(),function(l){return l.LocationName==schedule.Location;})[0]['Id'];if(schedule.ScheduleTypeInfo.Frequency==0){this.showEditOption(schedule,Index,schedule.ScheduleTypeInfo);}else{this.showSchedule(schedule.Type,schedule.EquipmentId,schedule);}}};CalendarViewModel.prototype.RemoveDefaultWorkhour=function(){var _this=this;var allWorkhour=AppData.where(this.WorkHours(),function(s){return(s.EndTime.getHours()-s.StartTime.getHours()==0&&s.EndTime.getMinutes()-s.StartTime.getMinutes()==5);});ko.utils.arrayForEach(allWorkhour,function(item){_this.WorkHours.remove(item);});};CalendarViewModel.prototype.updateWorkHours=function(date,locations){var _this=this;var doneLoading=AppUI.loading('Loading...',10,$('.scheduling-provider-workhours-calendar')[0]);var thisMonth=new Date(date.getFullYear(),date.getMonth(),1);var startDate=new Date(date.getFullYear(),date.getMonth(),-(thisMonth.getDay()-1));var endDate=new Date(startDate.getFullYear(),startDate.getMonth(),startDate.getDate()+42);var providerModel=new Scheduling.Models.ProviderSchedule();providerModel.GetProviderWorkHours(locations,startDate,endDate,function(wh){if(wh&&wh.length>0){_this.WorkHours(AppData.select(wh,function(item){var borderColor=AppData.where(_this.ProviderLocations(),function(l){return l.LocationName==item.Location;})[0].BorderColorCode();var color=AppData.where(_this.ProviderLocations(),function(l){return l.LocationName==item.Location;})[0].Color();var pattern;pattern=item.Pattern;var patternCol=pattern.split(';');var freq=(patternCol[0].split('=')[1].toLowerCase()=="daily")?"Daily":"Weekly";var days='';var col={};if(item.IsVaried){var ruleCollection=AppData.where(CALENDAR_RULES_COLLECTION,function(c){return c.CalendarId===item.ParentCalendarId;})[0];col=AppData.where(ruleCollection['CalendarRules'].scheduleInfo,function(s){return(s['isvaried']&&AppData.formatDate(s['starttime'])===AppData.formatDate(item['ScheduleInfoStartTime']));});$.each(col,function(i,p){days+=p['pattern'].split(';')[2].split('=')[1]+',';});if(days){days=days.substring(0,days.lastIndexOf(','));}}else{days=((patternCol[2])?patternCol[2].split('=')[1]:'');}
return{LinkId:item.LinkID,Reason:item.Reason,Location:item.Location,LocationID:item.LocationID,PartialLocation:(item.Location.length>7)?item.Location.substring(0,6)+'...':item.Location,Date:item.Date,IsAllDay:(item.StartTime===item.EndTime),StartTime:item.StartTime,EndTime:item.EndTime,CalendarId:item.CalendarId,Type:(item.IsTimeOff?2:item.IsBreak?3:(freq==="Weekly")?0:1),BorderColor:borderColor,Color:color,IsFirstClick:ko.observable(true),ScheduleTypeInfo:{Frequency:CalendarScheduleType[freq],Days:days,StartTime:item.ScheduleInfoStartTime,EffectiveIntervalEnd:(item.EffectiveIntervalEnd)?AppData.formatDate(item.EffectiveIntervalEnd):'',IsVaried:(item.IsVaried)?item.IsVaried:false,TimeZoneCode:item.TimezoneCode,GroupDesignator:(item.GroupDesignator)?item.GroupDesignator:null,ParentCalendarId:item.ParentCalendarId}};}));_this.RemoveDefaultWorkhour();var currentMonthLocation=[];var distinctLocation=AppData.distinct(_this.WorkHours(),function(i){return i.Location;});ko.utils.arrayForEach(distinctLocation,function(item){var result=AppData.where(_this.ProviderLocations(),function(s){if(s['LocationName']===item['Location']){return{LocationName:s['LocationName'],PartialLocationName:s['PartialLocationName'],Id:s['Id'],BorderColorCode:ko.observable(s['BorderColorCode']),Color:ko.observable(s['Color']),IsActive:s['IsActive']};}});currentMonthLocation.push(result[0]);});_this.SelectedMonthLocations(currentMonthLocation);doneLoading();}else{doneLoading();_this.WorkHours([]);CrmData.Common.showMessage(NOWORKHOURFOUND);}
_this.FilterWorkHours=_this.WorkHours();if(_this.FilteredLocation()){_this.filterLocation(_this.FilteredLocation());}});};CalendarViewModel.prototype.formatTime=function(datetime,military){var jsDate=AppData.parseDate(datetime);if(!jsDate)
return'';var h=jsDate.getHours();var m=jsDate.getMinutes();var s=jsDate.getSeconds();var a=(h>=12?'PM':'AM');if(h==0)
h=12;if(h>12)
h-=12;var normalTime=(h+':'+(m<10?'0':'')+m+a);if(military){var time=$.datepicker['parseTime']('h:mm tt',normalTime);var timeString=$.datepicker['formatTime']('HH:mm',time);return timeString;}else{return normalTime;}};return CalendarViewModel;})();WorkHours.CalendarViewModel=CalendarViewModel;var MonthNames;(function(MonthNames){MonthNames[MonthNames["January"]=0]="January";MonthNames[MonthNames["February"]=1]="February";MonthNames[MonthNames["March"]=2]="March";MonthNames[MonthNames["April"]=3]="April";MonthNames[MonthNames["May"]=4]="May";MonthNames[MonthNames["June"]=5]="June";MonthNames[MonthNames["July"]=6]="July";MonthNames[MonthNames["August"]=7]="August";MonthNames[MonthNames["September"]=8]="September";MonthNames[MonthNames["October"]=9]="October";MonthNames[MonthNames["November"]=10]="November";MonthNames[MonthNames["December"]=11]="December";})(MonthNames||(MonthNames={}));})(Provider.WorkHours||(Provider.WorkHours={}));var WorkHours=Provider.WorkHours;})(ViewModels.Provider||(ViewModels.Provider={}));var Provider=ViewModels.Provider;})(Scheduling.ViewModels||(Scheduling.ViewModels={}));var ViewModels=Scheduling.ViewModels;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var NOUSERINFOFOUND='There is no user info found';var DEFAULTSTART_DATE='2000-01-01T00:00:00Z';var DEFAULTEND_DATE='9999-12-30T00:00:00Z';var DEFAULT_SCHEDULE_START_TIME='12:00 AM';var DEFAULT_SCHEDULE_END_TIME='12:05 AM';var Ccx;(function(Ccx){(function(Scheduling){(function(ViewModels){(function(Provider){(function(WorkHours){var LocationViewModel=(function(){function LocationViewModel(providerLocations,providerId,timeZoneCode,OnLocationAdded){this.OnLocationAdded=OnLocationAdded;this.TimeZoneCode=(timeZoneCode)?timeZoneCode:'0';this.providerModel=new Scheduling.Models.ProviderSchedule();this.AgencyLocations=ko.observableArray([]);this.GetProviderDetails(providerId);this.SelectedLocation=ko.observable(null);this.LoadData(providerLocations);this.IsSelected=ko.observable(false);this.IsEnable=ko.observable(false);this.IsSaved=false;}
LocationViewModel.prototype.LoadData=function(providerLocations){var _this=this;try{var doneLoading=AppUI.loading('Loading...',1,$('.scheduling-provider-workhours-addlocation-popup')[0]);var providerModel=new Scheduling.Models.ProviderSchedule();var self=this;providerModel.GetAllLocations(providerLocations,function(allLocations){_this.SelectRow(_this);_this.AgencyLocations(allLocations);if(_this.AgencyLocations().length>0){_this.IsEnable(true);}else{_this.IsEnable(false);CrmData.Common.showMessage("No location found");}
doneLoading();});}catch(ex){console.log(ex);}};LocationViewModel.prototype.SelectRow=function(location){if(location){this.SelectedLocation(location);if(location.FacilityName){this.IsSelected(true);}else{this.IsSelected(false);}}};LocationViewModel.prototype.GetProviderDetails=function(providerId){var _this=this;try{this.providerModel.GetProviderInformation(providerId,function(user){if(user[0]){_this.providerInformation={ProviderName:user[0]['fullname'],ProviderId:user[0]['systemuserid'],BusinessUnit:user[0]['businessunitid'],BusinessUnitName:user[0]['businessunitid_name'],Timezonecode:user[0]['usersettings.timezonecode']};}});}catch(ex){console.log(ex);}};LocationViewModel.prototype.SavefacilityRecordEquipment=function(){var _this=this;try{var equipment;var facilityName;var self=this;facilityName=this.SelectedLocation().FacilityName;if(this.providerInformation){equipment={ccx_agencylocation:this.SelectedLocation().FacilityId,name:this.providerInformation.ProviderName+'-'+facilityName,ccx_provider:this.providerInformation.ProviderId,businessunitid:this.providerInformation.BusinessUnit,timezonecode:this.providerInformation.Timezonecode,ccx_schedulestatus:false};this.providerModel.SaveFacilityEquipment(equipment,function(Equipmentid){if(Equipmentid){if(_this.OnLocationAdded){CrmData.ScheduleData.AddWorkHours(DEFAULTSTART_DATE,DEFAULT_SCHEDULE_START_TIME,DEFAULTEND_DATE,DEFAULT_SCHEDULE_END_TIME,'','',Equipmentid.toString(),'',parseInt(_this.TimeZoneCode),'',0,false,true,false,DEFAULTEND_DATE,'',-1,function(result){if(result&&result.issuccess){CrmData.ScheduleData.AddWorkHours(DEFAULTSTART_DATE,DEFAULT_SCHEDULE_START_TIME,DEFAULTEND_DATE,DEFAULT_SCHEDULE_END_TIME,'','',Equipmentid.toString(),'SU,MO,TU,WE,TH,FR,SA',parseInt(_this.TimeZoneCode),'',0,false,false,false,DEFAULTSTART_DATE,'',-1,function(isAdded){if(isAdded&&isAdded.issuccess){_this.providerModel.UpdateCalendarStatus(Equipmentid,function(isUpdated){CrmData.Common.showMessage("Location added successfully!");AppUI.Popup.hideAll();CrmData.Common.enableHTMLScroll();_this.OnLocationAdded(Equipmentid);});}});}});}}else{CrmData.Common.showMessage("Error");}});}}catch(ex){console.log(ex);}};LocationViewModel.prototype.SaveFacilityEquipementRecord=function(){var self=this;if(self.AgencyLocations().length>0&&self.IsSelected()){if(!self.IsSaved){self.IsSaved=true;AppUI.confirm('Are you sure you want to add this location?',function(){if(self.IsEnable()){self.IsEnable(false);self.SavefacilityRecordEquipment();}},function(){self.IsEnable(true);self.IsSaved=false;});setTimeout(function(){$('#w2ui-lock').css('z-index',99999);},200);}}else{CrmData.Common.showMessage("Please select a location to add.");}};return LocationViewModel;})();WorkHours.LocationViewModel=LocationViewModel;})(Provider.WorkHours||(Provider.WorkHours={}));var WorkHours=Provider.WorkHours;})(ViewModels.Provider||(ViewModels.Provider={}));var Provider=ViewModels.Provider;})(Scheduling.ViewModels||(Scheduling.ViewModels={}));var ViewModels=Scheduling.ViewModels;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var LOCATION_ORIGIN=document.location.href.substring(0,document.location.href.indexOf(document.location.pathname));var IMAGE_URL="https://scheduling.cocentrix.com/Image/download.aspx?Entity=systemuser&Attribute=entityimage&Id=";var EDIT_PROFILE_URL="/main.aspx?etc=8&pagetype=entityrecord&id=";var Ccx;(function(Ccx){(function(Scheduling){(function(ViewModels){var ProviderProfileViewModel=(function(){function ProviderProfileViewModel(){this.ProviderSearchvalue=ko.observable('');this.ProviderSearchVisibility=ko.observable(true);this.ProviderDetailsVisibility=ko.observable(false);this.SearchLabel=ko.observable('');this.SearchExpression=ko.observable('');this.TimezoneCode=ko.observable('');this.InFormulary=ko.observable(true);this.provider=new Scheduling.Models.ProviderSearch();this.IsSmartSearchEnabled=ko.observable(true);this.isProviderSelected=ko.observable(Boolean(this.SearchExpression()));this.IsSearching=ko.observable(false);this.ProviderName=ko.observable('');this.ProviderFullName=ko.observable('');this.ProviderId=ko.observable('');this.ProviderImageUrl=ko.observable(LOCATION_ORIGIN+'/_imgs/ContactPhoto.png');this.ProviderProfileUrl=ko.observable('');this.ProviderTitle=ko.observable('');}
ProviderProfileViewModel.prototype.ProviderSearch=function(search,callback){var _this=this;this.provider.GetProviders(search,function(list){_this.validateResults(list,callback);});return true;};ProviderProfileViewModel.prototype.ShowCalendar=function(){var viewContext=new ViewModels.Provider.WorkHours.CalendarViewModel({providerId:this.ProviderId(),timezonecode:this.TimezoneCode()});App.View.load({ViewName:'Scheduling-Provider-WorkHours-CalendarView',ViewContext:viewContext},document.getElementById('divRight-tab'));};ProviderProfileViewModel.prototype.ShowServicesUI=function(){var viewContext=new ViewModels.CalendarAdministrationMyServicesViewModel();App.View.load({ViewName:'Scheduling-CalendarAdministrationMyServices',ViewContext:viewContext},document.getElementById('divRight-tab'));};ProviderProfileViewModel.prototype.ClearAppointmentView=function(){$('#divRight-tab').empty();};ProviderProfileViewModel.prototype.ShowAppointments=function(){var viewContext=new Ccx.Scheduling.ViewModels.Schedule.AppointmentViewModel(this.ProviderId());App.View.load({ViewName:'Scheduling-Schedule-AppointmentView',ViewContext:viewContext},document.getElementById('divRight-tab'));viewContext.selectedView('month');$(".weekView").css("background","#A7CDF0");};ProviderProfileViewModel.prototype.onProviderSelected=function(){var findFDBId=function(fdbId,lookup){var match=$.grep(lookup,function(item){return(item["Id"]==fdbId);});if(match.length>0){return match[0]["Value"];}else{return null;}};};ProviderProfileViewModel.prototype.SelectItem=function(item,callback){if(item){var meds=item.Value;this.selectedMedication=meds;this.SearchExpression(item.Text);this.IsSmartSearchEnabled(true);this.IsSearching(false);$('.lookup').blur();callback(item);this.ClearAppointmentView();this.ViewProviderDetails(item);return true;}};ProviderProfileViewModel.prototype.ViewProviderDetails=function(profileInfo){this.ProviderDetailsVisibility(true);this.ProviderSearchVisibility(false);this.ProviderSearchvalue('');this.ProviderName(profileInfo.Text);this.BindProviderDetails(profileInfo.Value);};ProviderProfileViewModel.prototype.validateResults=function(list,callback){if(list.length==0&&this.PrevProviderName){CrmData.Common.showMessage('No Results Found. Selecting previous provider.',5);this.SearchExpression(this.PrevProviderName);$('.lookup').blur();}else{callback(list);}};ProviderProfileViewModel.prototype.BindProviderDetails=function(providerId){var _this=this;var Model=new Scheduling.Models.ProviderSchedule();Model.GetProviderInformation(providerId,function(Provider){_this.ProviderFullName(Provider[0]['fullname']);_this.ProviderTitle(Provider[0]['title']);_this.ProviderId(providerId);_this.ProviderImageUrl(IMAGE_URL+providerId);_this.ProviderProfileUrl(EDIT_PROFILE_URL+providerId);_this.TimezoneCode(Provider[0]['usersettings.timezonecode']);});};ProviderProfileViewModel.prototype.ShowWeeklyAppointments=function(){var viewContext=new Scheduling.ViewModels.Schedule.AppointmentWeeklyViewModel({providerId:this.ProviderId()});App.View.load({ViewName:'Scheduling-Schedule-AppointmentWeekly',ViewContext:viewContext},document.getElementById('divRight-tab'));};return ProviderProfileViewModel;})();ViewModels.ProviderProfileViewModel=ProviderProfileViewModel;})(Scheduling.ViewModels||(Scheduling.ViewModels={}));var ViewModels=Scheduling.ViewModels;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var Ccx;(function(Ccx){(function(Scheduling){(function(ViewModels){(function(Schedule){var AppointmentFlyoutViewModel=(function(){function AppointmentFlyoutViewModel(data){$('#w2ui-overlay').attr('style','left:100px !important;');this.SelectedData=ko.observable(data);}
AppointmentFlyoutViewModel.prototype.formatTime=function(datetime,military){var appoitmentStartTime=datetime;if(appoitmentStartTime){return appoitmentStartTime.getHours()+":"+appoitmentStartTime.getMinutes();}
return"";};return AppointmentFlyoutViewModel;})();Schedule.AppointmentFlyoutViewModel=AppointmentFlyoutViewModel;})(ViewModels.Schedule||(ViewModels.Schedule={}));var Schedule=ViewModels.Schedule;})(Scheduling.ViewModels||(Scheduling.ViewModels={}));var ViewModels=Scheduling.ViewModels;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var Ccx;(function(Ccx){(function(Scheduling){(function(ViewModels){(function(Schedule){(function(IAppointmentType){IAppointmentType[IAppointmentType["Hold"]=803080000]="Hold";IAppointmentType[IAppointmentType["ClientService"]=803080001]="ClientService";IAppointmentType[IAppointmentType["Group"]=803080002]="Group";})(Schedule.IAppointmentType||(Schedule.IAppointmentType={}));var IAppointmentType=Schedule.IAppointmentType;var MonthNames;(function(MonthNames){MonthNames[MonthNames["January"]=0]="January";MonthNames[MonthNames["February"]=1]="February";MonthNames[MonthNames["March"]=2]="March";MonthNames[MonthNames["April"]=3]="April";MonthNames[MonthNames["May"]=4]="May";MonthNames[MonthNames["June"]=5]="June";MonthNames[MonthNames["July"]=6]="July";MonthNames[MonthNames["August"]=7]="August";MonthNames[MonthNames["September"]=8]="September";MonthNames[MonthNames["October"]=9]="October";MonthNames[MonthNames["November"]=10]="November";MonthNames[MonthNames["December"]=11]="December";})(MonthNames||(MonthNames={}));(function(AppointmentScheduleType){AppointmentScheduleType[AppointmentScheduleType["AllDay"]=0]="AllDay";AppointmentScheduleType[AppointmentScheduleType["Duraion"]=1]="Duraion";})(Schedule.AppointmentScheduleType||(Schedule.AppointmentScheduleType={}));var AppointmentScheduleType=Schedule.AppointmentScheduleType;var AppointmentMonthViewModel=(function(){function AppointmentMonthViewModel(providerId,selectedDate,selectedDateTime){var _this=this;AppointmentMonthViewModel._self=this;this.ProviderId=ko.observable(providerId.toString());this.FilteredLocation=ko.observable('');this.allAppointments=ko.observableArray([]);this.ProviderLocations=ko.observableArray([]);this.FilterAppointments=[];this.WorkHours=ko.observableArray([]);this.ProviderLocationsMonthFilter=ko.observableArray([]);this.ProviderLocations=ko.observableArray([]);this.SelectedDate=ko.observable(selectedDate||new Date());this.SelectedMonth=ko.computed(function(){return _this.getMonthName(_this.SelectedDate());});this.HeaderText=ko.computed(function(){return _this.SelectedMonth()+' ,'+_this.SelectedDate().getFullYear();});this.CalendarRows=ko.computed(function(){var selectedDate=_this.SelectedDate();var thisMonth=new Date(selectedDate.getFullYear(),selectedDate.getMonth(),1);var startDate=new Date(selectedDate.getFullYear(),selectedDate.getMonth(),-(thisMonth.getDay()-1));var days=[];for(var d=0;d<=42;d++){var date=new Date(startDate.getFullYear(),startDate.getMonth(),startDate.getDate()+d);days.push({IsCurrentMonth:date.getMonth()==selectedDate.getMonth(),Month:date.getMonth()+1,Day:date.getDate(),Date:date});}
var rows=[];for(var d=0;d<=days.length;d++){if(d%7==0){rows.push({Days:days.slice(d-7,d)});}}
return rows;});this.SelectedMonthLocations=ko.observableArray([]);this.GetProviderAppointments(this.SelectedDate());var providerModel=new Scheduling.Models.Appointment();}
AppointmentMonthViewModel.prototype.GetProviderAppointments=function(date){var _this=this;try{var doneLoading=AppUI.loading('Loading...',1,$('.scheduling-provider-workhours-calendar')[0]);var thisMonth=new Date(date.getFullYear(),date.getMonth(),1);var startDate=new Date(date.getFullYear(),date.getMonth(),-(thisMonth.getDay()-1));var endDate=new Date(startDate.getFullYear(),startDate.getMonth(),startDate.getDate()+42);this.SelectedMonthLocations.removeAll();CrmData.CalendarUtils.GetProviderAppointments(this.ProviderId(),startDate.toDateString(),endDate.toDateString(),function(result){_this.ProviderLocations(result.providerLocations);_this.allAppointments(result.allAppointments);CrmData.CalendarUtils.ColorMapping(_this.ProviderLocations);CrmData.CalendarUtils.ColorMappingAppointment(_this.allAppointments,_this.ProviderLocations());_this.FilterAppointments=_this.allAppointments();});}catch(ex){console.log(ex);}};AppointmentMonthViewModel.prototype.EncompassBorder=function(){};AppointmentMonthViewModel.prototype.daysAreEqual=function(date1,date2){var date=new Date(date1);return(date.getFullYear()==date2.getFullYear()&&date.getMonth()==date2.getMonth()&&date.getDate()==date2.getDate());};AppointmentMonthViewModel.prototype.getMonthName=function(date){var month=date.getMonth();return MonthNames[month];};AppointmentMonthViewModel.prototype.showRelated=function(item){if(!item.LinkVisible&&item.LinkId){item.LinkVisible=true;$('.link-'+item.LinkId).addClass('related');}};AppointmentMonthViewModel.prototype.OnNextClick=function(){try{var vm=AppointmentMonthViewModel._self;var selectedDate=vm.SelectedDate();var newMonth=new Date(selectedDate.getFullYear(),selectedDate.getMonth()+1,1);vm.SelectedDate(newMonth);}catch(ex){console.log(ex);}};AppointmentMonthViewModel.prototype.OnPreviousClick=function(){try{var vm=AppointmentMonthViewModel._self;var tempDate;var selectedDate=vm.SelectedDate();var newMonth=new Date(selectedDate.getFullYear(),selectedDate.getMonth()-1,1);vm.SelectedDate(newMonth);}catch(ex){console.log(ex);}};AppointmentMonthViewModel.prototype.CurrentMonth=function(){try{var currentMonth=new Date();var newMonth=new Date(currentMonth.getFullYear(),currentMonth.getMonth(),1);this.SelectedDate(newMonth);}catch(ex){console.log(ex);}};AppointmentMonthViewModel.prototype.OnRefreshClick=function(){try{var vm=AppointmentMonthViewModel._self;vm.allAppointments([]);vm.ProviderLocations([]);$("#ddllocations").css("display","none");vm.GetProviderAppointments(vm.SelectedDate());}catch(ex){console.log(ex);}};AppointmentMonthViewModel.prototype.hideRelated=function(item){if(item.LinkVisible&&item.LinkId){item.LinkVisible=false;$('.link-'+item.LinkId).removeClass('related');}};AppointmentMonthViewModel.prototype.formatTime=function(datetime,military){var appoitmentStartTime=datetime;if(appoitmentStartTime){return appoitmentStartTime.getHours()+":"+appoitmentStartTime.getMinutes();}
return"";};AppointmentMonthViewModel.prototype.filter=function(event){$('#ddllocations').stop().slideToggle(500);};AppointmentMonthViewModel.prototype.viewBy=function(){};AppointmentMonthViewModel.prototype.OnLocationSelected=function(selected){try{var vm=AppointmentMonthViewModel._self;vm.allAppointments(vm.FilterAppointments.filter(function(wh){return wh.equipmentid==selected.Id;}));vm.FilteredLocation(selected);$('#ddllocations').stop().slideUp(500);}catch(ex){console.log(ex);}};AppointmentMonthViewModel.prototype.hoverValues=function(scheduledstart,subject,name){return("Start Time: "+scheduledstart+"\nClient Name: "+subject+"\nLocation :"+name);};return AppointmentMonthViewModel;})();Schedule.AppointmentMonthViewModel=AppointmentMonthViewModel;})(ViewModels.Schedule||(ViewModels.Schedule={}));var Schedule=ViewModels.Schedule;})(Scheduling.ViewModels||(Scheduling.ViewModels={}));var ViewModels=Scheduling.ViewModels;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var Ccx;(function(Ccx){(function(Scheduling){(function(ViewModels){(function(Schedule){var AppointmentViewModel=(function(){function AppointmentViewModel(ProviderId){var self=this;self.ProviderId=ko.observable('');self.CurrentView=ko.observable({});self.ProviderId(ProviderId);self.CurrentViewName='Week';}
AppointmentViewModel.prototype.selectedView=function(viewName){var self=this;$(".weekView").addClass(".defaultViewColor");if(viewName!=''&&viewName.toLowerCase()!=self.CurrentViewName){switch(viewName.toLowerCase()){case'day':var viewContext=new Scheduling.ViewModels.Schedule.AppointmentWeeklyViewModel({providerId:self.ProviderId()});self.CurrentView(viewContext);App.View.load({ViewName:'Scheduling-Schedule-AppointmentWeekly',ViewContext:viewContext},document.getElementById('selectedViewContent'));self.CurrentViewName=viewName;break;case'week':var viewContext=new Scheduling.ViewModels.Schedule.AppointmentWeeklyViewModel({providerId:self.ProviderId()});self.CurrentView(viewContext);App.View.load({ViewName:'Scheduling-Schedule-AppointmentWeekly',ViewContext:viewContext},document.getElementById('selectedViewContent'));self.CurrentViewName=viewName;break;case'month':var viewContext=new Scheduling.ViewModels.Schedule.AppointmentWeeklyViewModel({providerId:self.ProviderId()});self.CurrentView(viewContext);App.View.load({ViewName:'Scheduling-Schedule-AppointmentWeekly',ViewContext:viewContext},document.getElementById('selectedViewContent'));self.CurrentViewName=viewName;break;default:var viewContext=new Scheduling.ViewModels.Schedule.AppointmentWeeklyViewModel({providerId:self.ProviderId()});self.CurrentView(viewContext);App.View.load({ViewName:'Scheduling-Schedule-AppointmentWeekly',ViewContext:viewContext},document.getElementById('selectedViewContent'));$(".weekView").addClass(".selectedViewColor");}}};AppointmentViewModel.prototype.filter=function(event){$('#ddllocations').stop().slideToggle(500);};AppointmentViewModel.prototype.filterAppointmentByLocation=function(location){};return AppointmentViewModel;})();Schedule.AppointmentViewModel=AppointmentViewModel;})(ViewModels.Schedule||(ViewModels.Schedule={}));var Schedule=ViewModels.Schedule;})(Scheduling.ViewModels||(Scheduling.ViewModels={}));var ViewModels=Scheduling.ViewModels;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var Ccx;(function(Ccx){(function(Scheduling){(function(ViewModels){(function(Schedule){var Day=(function(){function Day(monthDay,weekDay){this.dayOfMonth=monthDay;this.dayOfWeek=weekDay;}
return Day;})();Schedule.Day=Day;var dayHour=(function(){function dayHour(hr,sfx){this.hour=hr;this.suffix=sfx?sfx:'';}
dayHour.prototype.PastHalfHour=function(){var srcHour=this;var hr=new dayHour(srcHour.hour+":30",srcHour.suffix);return hr;};dayHour.prototype.IsHalfPastHour=function(){if(this.hour.indexOf(":30")>0){return true;}else{return false;}};return dayHour;})();Schedule.dayHour=dayHour;var Appointment=(function(){function Appointment(){}
return Appointment;})();Schedule.Appointment=Appointment;var AppointmentWeeklyViewModel=(function(){function AppointmentWeeklyViewModel(data){var _this=this;this.hourFormat='24';AppointmentWeeklyViewModel._self=this;this.providerID=data.providerId;this.weekdays=ko.observableArray(CrmData.CalendarUtils.GetWeekDays());this.HeaderText=ko.computed(function(){var monthDesc='';monthDesc+=CrmData.MonthNames[(_this.weekdays()[0]).getMonth()]+" "+(_this.weekdays()[0]).getDate()+"- ";if((_this.weekdays()[0]).getMonth()!=(_this.weekdays()[6]).getMonth()){monthDesc+=CrmData.MonthNames[(_this.weekdays()[6]).getMonth()]+" ";}
monthDesc+=(_this.weekdays()[6]).getDate()+", "+(_this.weekdays()[0]).getFullYear();return monthDesc;});this.timings=ko.observableArray(this.getDayHours(this.hourFormat));this.weekAppointments=ko.observableArray([]);this.ProviderLocations=ko.observableArray([]);this.getAppointments();setTimeout(function(){$('.calendar-body').animate({scrollTop:($("#tr_16").offset().top-$(".calendar-body").offset().top)},'slow');});}
AppointmentWeeklyViewModel.prototype.getWeekAppointments=function(){var vm=AppointmentWeeklyViewModel._self;var x=AppData.where(this.allAppointments,function(app){var tempDate=new Date();var day1=new Date(tempDate.toString());day1.setDate((vm.weekdays()[0]).getDate());day1.setMonth((vm.weekdays()[0]).getMonth());day1.setFullYear((vm.weekdays()[0]).getFullYear());var day7=new Date(tempDate.toString());day7.setDate((vm.weekdays()[6]).getDate());day7.setMonth((vm.weekdays()[6]).getMonth());day7.setFullYear((vm.weekdays()[6]).getFullYear());var appDate=new Date(app.scheduledstart);var compareDate=new Date(tempDate.toString());compareDate.setDate(appDate.getDate());compareDate.setMonth(appDate.getMonth());compareDate.setFullYear(appDate.getFullYear());if(compareDate>=day1&&compareDate<=day7){return true;}else{return false;}});this.weekAppointments(x);this.appointmentsCopy=this.weekAppointments();};AppointmentWeeklyViewModel.prototype.getAppointments=function(){CrmData.CalendarUtils.GetProviderAppointments(this.providerID,this.weekdays()[0].toDateString(),this.weekdays()[6].toDateString(),function(result){AppointmentWeeklyViewModel._self.allAppointments=result.allAppointments;AppointmentWeeklyViewModel._self.getWeekAppointments();AppointmentWeeklyViewModel._self.ProviderLocations(result.providerLocations);CrmData.CalendarUtils.ColorMapping(AppointmentWeeklyViewModel._self.ProviderLocations);CrmData.CalendarUtils.ColorMappingAppointment(AppointmentWeeklyViewModel._self.weekAppointments,AppointmentWeeklyViewModel._self.ProviderLocations());});};AppointmentWeeklyViewModel.prototype.filterAppointmentByLocation=function(location){console.log(" || location: "+JSON.stringify(location));};AppointmentWeeklyViewModel.prototype.filter=function(event){$('#ddllocations').stop().slideToggle(500);};AppointmentWeeklyViewModel.prototype.getDayHours=function(format){var timeArr=[];var hr;var halfHr;if(format=='24'){hr=new dayHour('00','am');}else{hr=new dayHour('12','am');}
timeArr.push(hr);timeArr.push(hr.PastHalfHour());for(var i=1;i<24;i++){if(i>=12){if(i==12){hr=new dayHour(i.toString(),'pm');}else{if(format=='24'){hr=new dayHour(i.toString(),'00');}else{hr=new dayHour((i-12).toString(),'00');}}}else{if(i==8){hr=new dayHour(i.toString(),'am');}else{hr=new dayHour(i.toString(),'00');}}
timeArr.push(hr);timeArr.push(hr.PastHalfHour());}
return timeArr;};AppointmentWeeklyViewModel.prototype.onCellClick=function(){console.log(JSON.stringify(this));};AppointmentWeeklyViewModel.prototype.OnRefreshClick=function(){try{$("#ddllocations").css("display","none");AppointmentWeeklyViewModel._self.getAppointments();}catch(ex){console.log(ex);}};AppointmentWeeklyViewModel.prototype.isCurrentTimeSlotAppointment=function(timeslot,weekDay,currentApt){var aptDate;aptDate=new Date(currentApt.scheduledstart);if(aptDate.getDate()==weekDay.getDate()){if(aptDate.getHours()==Number(timeslot.hour)){return true;}else{return false;}}else{return false;}};AppointmentWeeklyViewModel.prototype.OnPreviousClick=function(){var vm=AppointmentWeeklyViewModel._self;var currWeekDay1=vm.weekdays()[0];var prevWeekDay7=new Date(currWeekDay1.toString());prevWeekDay7.setDate(currWeekDay1.getDate()-1);vm.weekdays(CrmData.CalendarUtils.GetWeekDays(prevWeekDay7.toString()));vm.getAppointments();};AppointmentWeeklyViewModel.prototype.OnNextClick=function(){var vm=AppointmentWeeklyViewModel._self;var currWeekDay7=vm.weekdays()[6];var nextWeekDay1=new Date(currWeekDay7.toString());nextWeekDay1.setDate(currWeekDay7.getDate()+1);vm.weekdays(CrmData.CalendarUtils.GetWeekDays(nextWeekDay1.toString()));vm.getAppointments();};AppointmentWeeklyViewModel.prototype.OnLocationSelected=function(selected){try{var vm=AppointmentWeeklyViewModel._self;vm.weekAppointments(vm.appointmentsCopy.filter(function(wh){return wh.equipmentid==selected.Id;}));$('#ddllocations').stop().slideUp(500);}catch(ex){console.log(ex);}};return AppointmentWeeklyViewModel;})();Schedule.AppointmentWeeklyViewModel=AppointmentWeeklyViewModel;})(ViewModels.Schedule||(ViewModels.Schedule={}));var Schedule=ViewModels.Schedule;})(Scheduling.ViewModels||(Scheduling.ViewModels={}));var ViewModels=Scheduling.ViewModels;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var Ccx;(function(Ccx){(function(Scheduling){(function(ViewModels){var ScheduleTypeViewModel=(function(){function ScheduleTypeViewModel(data,equipmentID,timezonecode,scheduleTypeInforArray,OnSave){this.OnSave=OnSave;this.TimeZoneCode=timezonecode;this.EquipmentId=equipmentID;this.ScheduleStartedDate=ko.observable(AppData.formatDate(scheduleTypeInforArray.StartTime));this.SelectedDate=ko.observable(AppData.formatDate(data.Date));this.ScheduleType=ko.observable('0');this.ProviderInfo=new Scheduling.Models.ProviderSchedule();this.ScheduleDetails=data;this.ScheduleInfoArray=(scheduleTypeInforArray)?scheduleTypeInforArray:undefined;$('#w2ui-overlay').find('.close').click();this.IsNotStartDateofRecurrence=ko.observable(true);if(this.ScheduleStartedDate()){if(AppData.formatDate(this.SelectedDate())===AppData.formatDate(this.ScheduleStartedDate())){this.IsNotStartDateofRecurrence=ko.observable(false);}}}
ScheduleTypeViewModel.prototype.Close=function(){AppUI.Popup.hideAll();CrmData.Common.enableHTMLScroll();};ScheduleTypeViewModel.prototype.showPopup=function(element,title){if(typeof element==="undefined"){element=null;}
if(typeof title==="undefined"){title='';}
CrmData.Common.disableHTMLScroll();if(!element){element=document.createElement('DIV');}
var contentWidth=$(element).innerWidth();var contentHeight=$(element).innerHeight();var elementOwner=element.parentNode;var closePopupDelegate=element['closePopup']=function(e,data){if($(popupElement).find('#spnDataChanged').text().toLowerCase()=="true"){var scheduleType=($(popupElement).find('#spnScheduleType').text().toLowerCase()=="true")?'Recurring':'Single Day';AppUI.confirm('Your changes will be lost if you continue, press yes to close or no to return to Set '+scheduleType+' Schedule',function(){return contentElement.fadeOut('fast',function(){if(popupElement){if(elementOwner){elementOwner.appendChild(element);}
$(popupElement).remove();popupElement=null;if($('.ccx-ui-popup-container').length==0){document.body.style.overflow='auto';}
if(element['onHidePopup']){element['onHidePopup']();}}
CrmData.Common.enableHTMLScroll();});});}else{if(popupElement){if(elementOwner){elementOwner.appendChild(element);}
$(popupElement).remove();popupElement=null;if($('.ccx-ui-popup-container').length==0){document.body.style.overflow='auto';}
if(element['onHidePopup']){element['onHidePopup']();}}
CrmData.Common.enableHTMLScroll();}};element['hidePopup']=function(){if(popupElement){$('.ccx-ui-popup',popupElement).fadeOut('fast');$('#w2ui-global-items').remove();CrmData.Common.enableHTMLScroll();}};element['showPopup']=function(){if(popupElement){$('.ccx-ui-popup',popupElement).fadeIn('fast');CrmData.Common.disableHTMLScroll();}};var popupElement=AppUI.createElementTree({'@class':'ccx-ui-popup-container','.ccx-ui-popup-shade':{},'.ccx-ui-popup':{'.ccx-ui-popup-content':{'onclick':function(e){return AppUI.cancelEvent(e);},'.ccx-ui-popup-title':{'.ccx-ui-popup-close':{'onclick':function(e){return closePopupDelegate(e);}},'H4':title},'.ccx-ui-popup-body':element}}});var contentElement=$('.ccx-ui-popup-content',popupElement);$(contentElement).css('max-width','870px');var bodyElement=$('.ccx-ui-popup-body',popupElement);if($('.ccx-ui-popup-shade').length>0){$('.ccx-ui-popup-shade',popupElement).remove();contentElement.addClass('ccx-ui-noshadow');}
if(contentWidth>0){contentElement.width(contentWidth);}
if(contentHeight>0){bodyElement.css("overflow","auto");}
contentElement.hide();document.body.style.overflow='auto';$(popupElement).appendTo(document.body);contentElement.fadeIn('slow');return element;};ScheduleTypeViewModel.prototype.ShowSchedule=function(){var _this=this;AppUI.Popup.hideAll();var element=null;var viewContext=null;var ViewName="Scheduling-WeeklySchedule";var self=this;var ScheduleType;ScheduleType=(this.ScheduleType()==2.toString())?2:1;switch(this.ScheduleType()){case 2.toString():case 1.toString():element=this.showPopup(null,"Edit Schedule");viewContext=new Ccx.Scheduling.ViewModels.WeeklyScheduleViewModel(0,this.TimeZoneCode,this.EquipmentId,this.ScheduleDetails,null,null,false,ScheduleType,this.ScheduleInfoArray.ProviderID,function(onsave){if(onsave){_this.OnSave(true);}});break;case 0.toString():element=this.showPopup(null,"Set Work Hours and Service Restrictions");viewContext=new Ccx.Scheduling.ViewModels.WeeklyScheduleViewModel(1,this.TimeZoneCode,this.EquipmentId,this.ScheduleDetails,null,null,true,0,this.ScheduleInfoArray.ProviderID,function(onsave){if(onsave){_this.OnSave(true);}});break;}
$(element).addClass('ccx-page').css('position','static');$('.ccx-ui-popup-content').css('max-width','870px');App.View.load({ViewName:ViewName,ViewContext:viewContext},element);};return ScheduleTypeViewModel;})();ViewModels.ScheduleTypeViewModel=ScheduleTypeViewModel;})(Scheduling.ViewModels||(Scheduling.ViewModels={}));var ViewModels=Scheduling.ViewModels;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));var DEFAULTSTARTTIME="08:00 AM";var DEFAULTENDTIME="05:00 PM";var UNTILDATE_CONFLICT_MESSAGE="Until Date cannot be less than Start Date";var DELETE_CALENDAR_CONFIRM="Do you want to delete this calendar? You can't undo this action.";var DELETE_SUCCESS="Work hours deleted successfully!";var DELETE_FAIL="Data delete not successfull";var ADD_SUCCESS="Work hours added successfully!";var UPDATE_SUCCESS="Work hours updated successfully!";var ADD_UPDATE_FAIL="Data save/Update not successfull";var WORK_RANGE_CONFLICT="Your entry conflicts with the Work Range.Please correct the entries";var NOENDDATE='No End Date';var MAXDATE='12/30/9999';var MINIMUM_DURATION_ALERT='Minimum schedule duration must be 10 minutes or more';var Ccx;(function(Ccx){(function(Scheduling){(function(ViewModels){(function(IScheduleType){IScheduleType[IScheduleType["RecurringSchedule"]=0]="RecurringSchedule";IScheduleType[IScheduleType["SingleDaySchedule"]=1]="SingleDaySchedule";IScheduleType[IScheduleType["TimerOff"]=2]="TimerOff";IScheduleType[IScheduleType["EntireSchedule"]=3]="EntireSchedule";})(ViewModels.IScheduleType||(ViewModels.IScheduleType={}));var IScheduleType=ViewModels.IScheduleType;(function(RecurrenceEditType){RecurrenceEditType[RecurrenceEditType["SingleDay"]=0]="SingleDay";RecurrenceEditType[RecurrenceEditType["SelectedDayForward"]=1]="SelectedDayForward";RecurrenceEditType[RecurrenceEditType["Entire"]=2]="Entire";})(ViewModels.RecurrenceEditType||(ViewModels.RecurrenceEditType={}));var RecurrenceEditType=ViewModels.RecurrenceEditType;(function(DayIndex){DayIndex[DayIndex["SU"]=0]="SU";DayIndex[DayIndex["MO"]=1]="MO";DayIndex[DayIndex["TU"]=2]="TU";DayIndex[DayIndex["WE"]=3]="WE";DayIndex[DayIndex["TH"]=4]="TH";DayIndex[DayIndex["FR"]=5]="FR";DayIndex[DayIndex["SA"]=6]="SA";})(ViewModels.DayIndex||(ViewModels.DayIndex={}));var DayIndex=ViewModels.DayIndex;var WeeklyScheduleViewModel=(function(){function WeeklyScheduleViewModel(type,timezonecode,equipmentID,selectedDayWorkHour,selectedDateForAddItem,scheduleTypeInfoArray,IsSingleDayEditOnRecurring,recurrenceEditSubType,providerId,OnSave){var _this=this;this.OnSave=OnSave;$(document).click();this.ParameterDeclaration(type,timezonecode,equipmentID,selectedDayWorkHour,selectedDateForAddItem,scheduleTypeInfoArray,IsSingleDayEditOnRecurring,recurrenceEditSubType,providerId);this.ScheduleTypeAction(type,selectedDayWorkHour,recurrenceEditSubType);this.Workdays=ko.observableArray([{Text:'Sun',Value:'SU'},{Text:'Mon',Value:'MO'},{Text:'Tue',Value:'TU'},{Text:'Wed',Value:'WE'},{Text:'Thu',Value:'TH'},{Text:'Fri',Value:'FR'},{Text:'Sat',Value:'SA'}]);this.WorkdaysVBD=ko.observableArray(['Sun','Mon','Tue','Wed','Thu','Fri','Sat']);this.SetVBDDays();this.selectedDate.subscribe(function(){if(selectedDayWorkHour){selectedDayWorkHour.Date=new Date(_this.selectedDate());_this.LoadWorkHoursForSingleDayEdit(selectedDayWorkHour);}});this.Business=ko.observableArray([{Text:'Observe',Value:'OBS'},{Text:'Do not observe',Value:'DNO'}]);this.BindChoices();this.BusinessClosure=ko.observable('DNO');this.Closures=ko.observable("checked");this.schedule.GetTimeZone(function(list){_this.TimeZone(list);});this.Total=ko.observable('9');this.Working=ko.observable('9');this.Breaks=ko.observable('0');this.TimeTypeBreaks=ko.observable('minutes');this.TimeTypeTotal=ko.observable('hours');this.TimeTypeWorking=ko.observable('hours');if(!this.IsEditMode()&&selectedDateForAddItem){this.UntilDate(new Date(this.DateRange()));this.UntilDate().setDate(selectedDateForAddItem.getDate()+1);this.UntilDateString=ko.observable(AppData.formatDate(this.UntilDate()));}
if(recurrenceEditSubType){this.RecSubType=recurrenceEditSubType;}
this.SubscribeObs();this.EnableSaveBtn=ko.computed(function(){_this.ScheduleRows(),_this.vbd_ScheduleRowsContainer();if(_this.WeeklySchedule()){if(!_this.VaryByDay()){if(_this.ScheduleRows().length>0&&_this.SelectedWorkDays().length>0)
return true;else
return false;}else{if(_this.vbd_ScheduleRowsContainer().length>0)
return true;else
return false;}}else{return true;}});this.IsDataChanged=ko.computed(function(){return false;});this.IsDataChanged=ko.computed(function(){_this.WorkHour(),_this.VaryByDay(),_this.DaysCollection(),_this.ScheduleRows(),_this.SetWorkHour(),_this.IsDeleteSchedule(),_this.SelectedWorkDays(),_this.BusinessClosure(),_this.DateRange(),_this.UntilDateString(),_this.TimezoneValue(),_this.selectedDate(),_this.IsFirstTime(),_this.Total();if(!_this.IsFirstTime()){return true;}else{_this.IsFirstTime=ko.observable(false);return false;}});if(this.IsMSIE()){setTimeout(function(){$('.ccx-ui-popup-content').css('max-width','950px');$('.ccx-ui-popup-content').css('width','950px');},200);}
this.AdjustButtonsForIE();}
WeeklyScheduleViewModel.prototype.SubscribeObs=function(){var _this=this;this.DateRange.subscribe(function(){if(_this.DateRange().toString()!=''){if(_this.UntilDateString().trim()!==MAXDATE){_this.UntilDate().setDate(new Date(_this.DateRange().toString()).getDate()+1);_this.UntilDateString(AppData.formatDate(_this.UntilDate()));}}});this.UntilDateString.subscribe(function(){if(_this.UntilDateString().length>0&&_this.UntilDateString().trim()!==MAXDATE){var startDate=new Date(_this.DateRange().toString());var untilDate=new Date(_this.UntilDateString().toString());if(untilDate<startDate){CrmData.Common.showMessage(UNTILDATE_CONFLICT_MESSAGE);_this.UntilDateString('');}}});this.VaryByDay.subscribe(function(){if(_this.VaryByDay()){_this.WorkHour(false);_this.SetWorkHour(false);if(_this.vbd_ScheduleRowsContainer().length>0&&!_this.IsEditMode())
_this.vbd_ScheduleRowsContainer.removeAll();}});this.WorkHour.subscribe(function(){if(_this.WorkHour()){if(!_this.IsMSIE()){$('.ccx-ui-popup-content').css('max-width','800px');}
_this.VaryByDay(false);_this.SelectedWorkDays(['SU','MO','TU','WE','TH','FR','SA']);_this.SetWorkHour(false);}});this.WorkhourType.subscribe(function(){if(_this.WorkhourType().toString()=="1"){_this.VaryByDay(false);_this.WorkHour(true);}else{_this.VaryByDay(true);_this.WorkHour(false);}});};WeeklyScheduleViewModel.prototype.SetVBDDays=function(){for(var i=0;i<7;i++){if(!this.IsEditMode()){this.DaysCollection.push({WorkDay:ko.observable(this.WorkdaysVBD()[i]),IsChecked:ko.observable(true),Color:ko.observable('black'),vbd_LinkText:ko.observable('Set Work Hours')});}else{this.DaysCollection.push({WorkDay:ko.observable(this.WorkdaysVBD()[i]),IsChecked:ko.observable(false),Color:ko.observable('black'),vbd_LinkText:ko.observable('Set Work Hours')});}}};WeeklyScheduleViewModel.prototype.ScheduleTypeAction=function(type,selectedDayWorkHour,subType){if(type==1){if(selectedDayWorkHour){if(selectedDayWorkHour.ScheduleTypeInfo.IsVaried){this.WorkhourType("2");this.VaryByDay(true);this.SED_enable(false);}
this.EditScheduleDetails=selectedDayWorkHour;this.LoadWorkHoursForSingleDayEdit(selectedDayWorkHour);}else{this.ScheduleRows.push({WorkStartTime:ko.observable(DEFAULTSTARTTIME),WorkEndTime:ko.observable(DEFAULTENDTIME),IsBreak:ko.observable(false),Index:ko.observable(1),ButtonStatus:ko.observable(true)});}
this.AdjustButtonsForIE();}else if(type==0){if(subType){switch(subType){case 0:this.EditScheduleDetails=selectedDayWorkHour;this.LoadWorkHoursForSingleDayEdit(selectedDayWorkHour);this.IsDeleteAvailable=ko.observable(false);break;case 1:this.IsDeleteAvailable=ko.observable(false);if(selectedDayWorkHour&&selectedDayWorkHour.ScheduleTypeInfo.IsVaried){this.WorkhourType("2");this.VaryByDay(true);this.EditScheduleDetails=selectedDayWorkHour;this.WorkHour(false);this.SED_enable(false);this.DateRange(AppData.formatDate(new Date(this.selectedDate())));if(selectedDayWorkHour.ScheduleTypeInfo.EffectiveIntervalEnd)
this.UntilDateString(AppData.formatDate(selectedDayWorkHour.ScheduleTypeInfo.EffectiveIntervalEnd));else
this.UntilDateString('12/30/9999');this.LoadWorkHoursForVaryByDay(selectedDayWorkHour);}else if(selectedDayWorkHour&&!selectedDayWorkHour.ScheduleTypeInfo.IsVaried){this.VBD_enable(false);if(type==0){this.DateRange(AppData.formatDate(new Date(this.selectedDate())));}else{this.DateRange(AppData.formatDate(selectedDayWorkHour.ScheduleTypeInfo.StartTime));}
if(selectedDayWorkHour.ScheduleTypeInfo.EffectiveIntervalEnd)
this.UntilDateString(AppData.formatDate(selectedDayWorkHour.ScheduleTypeInfo.EffectiveIntervalEnd));else
this.UntilDateString('12/30/9999');this.EditScheduleDetails=selectedDayWorkHour;this.LoadWorkHoursForSingleDayEdit(selectedDayWorkHour);var Days=selectedDayWorkHour.ScheduleTypeInfo.Days.split(',');for(var i=0;i<Days.length;i++)
this.SelectedWorkDays.push(Days[i].toUpperCase());}
break;case 2:this.IsDeleteAvailable=ko.observable(true);this.DateRange(AppData.formatDate(selectedDayWorkHour.ScheduleTypeInfo.StartTime));if(selectedDayWorkHour&&selectedDayWorkHour.ScheduleTypeInfo.IsVaried){if(selectedDayWorkHour.ScheduleTypeInfo.EffectiveIntervalEnd)
this.UntilDateString(AppData.formatDate(selectedDayWorkHour.ScheduleTypeInfo.EffectiveIntervalEnd));else
this.UntilDateString('12/30/9999');this.VaryByDay(true);this.WorkhourType("2");this.EditScheduleDetails=selectedDayWorkHour;this.WorkHour(false);this.SED_enable(false);this.LoadWorkHoursForVaryByDay(selectedDayWorkHour);}else if(selectedDayWorkHour&&!selectedDayWorkHour.ScheduleTypeInfo.IsVaried){this.VBD_enable(false);if(selectedDayWorkHour.ScheduleTypeInfo.EffectiveIntervalEnd)
this.UntilDateString(AppData.formatDate(selectedDayWorkHour.ScheduleTypeInfo.EffectiveIntervalEnd));else
this.UntilDateString('12/30/9999');this.EditScheduleDetails=selectedDayWorkHour;this.LoadWorkHoursForSingleDayEdit(selectedDayWorkHour);var Days=selectedDayWorkHour.ScheduleTypeInfo.Days.split(',');for(var i=0;i<Days.length;i++)
this.SelectedWorkDays.push(Days[i].toUpperCase());}
break;}}}};WeeklyScheduleViewModel.prototype.ParameterDeclaration=function(type,timezonecode,equipmentID,selectedDayWorkHour,selectedDateForAddItem,scheduleTypeInfoArray,IsSingleDayEditOnRecurring,recurrenceEditSubType,providerId){this.User_TimezoneCode=timezonecode||'';this.ProviderId=ko.observable(providerId||'');this.WorkhourType=ko.observable('1');this.RecSubType=recurrenceEditSubType;this.IsFirstTime=ko.observable(true);this.isClose=false;this.StartConflictVal=ko.observable('');this.EndConflictVal=ko.observable('');this.TimeZone=ko.observableArray([]);this.TimezoneValue=ko.observable('');this.EquipmentId=ko.observable('');this.schedule=new Scheduling.Models.ProviderSchedule();this.TimeChoices=ko.observableArray([]);this.SetWorkHour=ko.observable(false);this.WeeklySchedule=ko.observable((type==0||type==3)?true:false);this.EntireSchedule=ko.observable((type==3)?true:false);this.DailySchedule=ko.observable((type==1)?true:false);this.selectedDate=(selectedDayWorkHour)?ko.observable(AppData.formatDate(selectedDayWorkHour.Date)):((selectedDateForAddItem)?ko.observable(AppData.formatDate(selectedDateForAddItem)):ko.observable(AppData.formatDate(new Date)));this.WorkHour=ko.observable(true);this.VaryByDay=ko.observable(false);this.BreakCount=1;this.IsVaryDaysChangeOnEdit=ko.observable(false);this.IsRemoveItem=false;this.vbd_CurIndex=0;this.SED_enable=ko.observable(true);this.VBD_enable=ko.observable(true);this.ItemsAdded=false;this.Conflicts=ko.observableArray([]);this.ScheduleRows=ko.observableArray([]);this.vbd_ScheduleRowsContainer=ko.observableArray([]);this.ConflictBackupValue='';this.EquipmentId=ko.observable(equipmentID||'');this.IsEdit=ko.observable(false);this.IsDeleteSchedule=ko.observable(false);this.UntilDateString=ko.observable('');this.UntilDate=ko.observable(new Date);this.IsEditMode=ko.observable(false);this.DateRange=ko.observable(AppData.formatDate(new Date));this.vbd_SelectedDays=ko.observableArray([]);this.ScheduleInfoArray=(scheduleTypeInfoArray||undefined);this.LinkText=ko.observable('Set Work Hours');this.vbd_PrevDayColl=[];this.vbd_NewDayColl=[];if(timezonecode)
this.TimezoneValue=ko.observable(timezonecode);else
this.TimezoneValue=ko.observable('');this.DaysCollection=ko.observableArray([]);this.IsEditMode=ko.observable((selectedDayWorkHour)?true:false);this.IsEdit=ko.observable((selectedDayWorkHour&&(!IsSingleDayEditOnRecurring))?true:false);this.IsEdit=ko.observable((recurrenceEditSubType&&recurrenceEditSubType==1)?false:this.IsEdit());if(!this.IsEditMode()){this.SelectedWorkDays=ko.observableArray(['SU','MO','TU','WE','TH','FR','SA']);this.DateRange=ko.observable(AppData.formatDate(selectedDateForAddItem));}else{this.SelectedWorkDays=ko.observableArray([]);this.DateRange=ko.observable(AppData.formatDate(new Date));}
this.FacilityName=ko.observable('');this.BindFacilityName(this.EquipmentId());this.IsDeleteAvailable=ko.observable((this.IsEditMode()&&!IsSingleDayEditOnRecurring)?true:false);};WeeklyScheduleViewModel.prototype.BindFacilityName=function(equipmentId){var _this=this;var Model=new Scheduling.Models.ProviderSchedule();Model.GetFaciliytName(equipmentId,function(item){_this.FacilityName(item['ccx_agencylocation_name']);});};WeeklyScheduleViewModel.prototype.SetSpinnerOnTop=function(){setTimeout(function(){$('.w2ui-lock').css('z-index',1000000);$('.w2ui-lock-msg').css('z-index',1000001);},200);};WeeklyScheduleViewModel.prototype.LoadWorkHoursForVaryByDay=function(selectedDayWorkHour){var _this=this;var doneLoading=AppUI.loading('Loading...',10,$('.ccx-ui-popup')[0]);this.SetSpinnerOnTop();this.vbd_ScheduleRowsContainer([]);$('.ccx-ui-popup-content').css('display','block');var startDate=selectedDayWorkHour.ScheduleTypeInfo.StartTime;var endDate=startDate.toString();endDate=new Date(endDate);endDate.setDate(endDate.getDate()+6);var DayCollection;DayCollection=[];$.each(selectedDayWorkHour.ScheduleTypeInfo['Days'].split(','),function(i,day){DayCollection.push(parseInt(DayIndex[day]));_this.vbd_PrevDayColl.push(parseInt(DayIndex[day]));});var Model=new Scheduling.Models.ProviderSchedule();Model.GetProviderWorkHourForEdit(selectedDayWorkHour.EquipmentId,selectedDayWorkHour.Location,startDate,endDate,function(workHours){var workHoursCol;workHoursCol=[];$.each(DayCollection,function(i,d){$.each(workHours,function(k,w){if(w.IsBreak===false&&w.Date.getDay()===d){workHoursCol.push(w);}});});$.each(workHoursCol,function(i,w){var day=w.StartTime.getDay();var WorKHourDetails=_this.LoadWorkHours(AppData.where(workHours,function(whr){return AppData.formatDate(whr.Date)===AppData.formatDate(w.Date);}));var timediff=_this.CalculateTimeDifference(WorKHourDetails[0].WorkStartTime().split(':'),WorKHourDetails[0].WorkEndTime().split(':'));if(timediff>5){_this.DaysCollection()[day].IsChecked(true);var l_text=WorKHourDetails[0].WorkStartTime()+' - '+WorKHourDetails[WorKHourDetails.length-1].WorkEndTime();_this.DaysCollection()[day].vbd_LinkText(l_text);_this.vbd_ScheduleRowsContainer.push({Data:ko.observable(WorKHourDetails),Day:ko.observable(day)});}});doneLoading();});};WeeklyScheduleViewModel.prototype.LoadWorkHours=function(results){var breakCount=0;var workHoursRowCount=0;var workHourDetails;workHourDetails=[];breakCount=AppData.where(results,function(s){return s.IsBreak==true;}).length;if(breakCount>0){workHoursRowCount=(2*breakCount)+1;var workHourStartTime=this.formatTime(AppData.where(results,function(s){return s.IsBreak==false;})[0]['StartTime'],false);var workHoursEndTime=this.formatTime(AppData.where(results,function(s){return s.IsBreak==false;})[0]['EndTime'],false);var l_text=workHourStartTime+' - '+workHoursEndTime;this.LinkText(l_text);var breaks=AppData.where(results,function(s){return s.IsBreak==true;});breaks=AppData.sort(breaks,function(b){return b['StartTime'];},false);var j=0;for(var i=0;i<workHoursRowCount;i++){if(i%2==0){if(i==0){workHourDetails.push({WorkStartTime:ko.observable(workHourStartTime),WorkEndTime:ko.observable(this.formatTime(breaks[0]['StartTime'],false)),IsBreak:ko.observable(false),Index:ko.observable(i),ButtonStatus:ko.observable(true)});}else if(i==(workHoursRowCount-1)){workHourDetails.push({WorkStartTime:ko.observable(this.formatTime(breaks[breakCount-1]['EndTime'],false)),WorkEndTime:ko.observable(workHoursEndTime),IsBreak:ko.observable(false),Index:ko.observable(i),ButtonStatus:ko.observable(true)});}else{workHourDetails.push({WorkStartTime:ko.observable(this.formatTime(breaks[j-1]['EndTime'],false)),WorkEndTime:ko.observable(this.formatTime(breaks[j]['StartTime'],false)),IsBreak:ko.observable(false),Index:ko.observable(i),ButtonStatus:ko.observable(true)});}}else{if(j<breakCount){workHourDetails.push({WorkStartTime:ko.observable(this.formatTime(breaks[j]['StartTime'],false)),WorkEndTime:ko.observable(this.formatTime(breaks[j]['EndTime'],false)),IsBreak:ko.observable(true),Index:ko.observable(i),ButtonStatus:ko.observable(true)});j++;}}
this.EnableDisableButton(i);}}else{workHourDetails.push({WorkStartTime:ko.observable(this.formatTime(results[0]['StartTime'],false)),WorkEndTime:ko.observable(this.formatTime(results[0]['EndTime'],false)),IsBreak:ko.observable(false),Index:ko.observable(i),ButtonStatus:ko.observable(true)});var l_text=this.formatTime(results[0]['StartTime'],false)+' - '+this.formatTime(results[0]['EndTime'],false);this.LinkText(l_text);}
return workHourDetails;};WeeklyScheduleViewModel.prototype.LoadWorkHoursForSingleDayEdit=function(selectedDayWorkHour){var _this=this;var doneLoading=AppUI.loading('Loading...',10,$('.ccx-ui-popup')[0]);this.SetSpinnerOnTop();this.ItemsLoaded=true;this.ScheduleRows.removeAll();var Model=new Scheduling.Models.ProviderSchedule();var stDate;stDate=null;stDate=selectedDayWorkHour.Date;try{Model.GetProviderWorkHourForEdit(selectedDayWorkHour.EquipmentId,selectedDayWorkHour.Location,stDate,stDate,function(results){if(results.length>0){_this.ScheduleRows(_this.LoadWorkHours(results));_this.ComputeWorkAndBreakHours();_this.SetDefaultValuesforConflict();}else{_this.ScheduleRows([]);_this.ScheduleRows.push({WorkStartTime:ko.observable(DEFAULTSTARTTIME),WorkEndTime:ko.observable(DEFAULTENDTIME),IsBreak:ko.observable(false),Index:ko.observable(1),ButtonStatus:ko.observable(true)});_this.ComputeWorkAndBreakHours();}
_this.AdjustButtonsForIE();_this.IsFirstTime=ko.observable(true);doneLoading();});}catch(ex){}};WeeklyScheduleViewModel.prototype.formatTime=function(datetime,military){var jsDate=AppData.parseDate(datetime);if(!jsDate)
return'';var h=jsDate.getHours();var m=jsDate.getMinutes();var s=jsDate.getSeconds();var normalTime='';var a=(h>=12?' PM':' AM');if(h==0)
h=12;if(h>12)
h-=12;if(h<10){normalTime=('0'+h+':'+(m<10?'0':'')+m+a);}else{normalTime=(h+':'+(m<10?'0':'')+m+a);}
if(military){var time=$.datepicker['parseTime']('h:mm tt',normalTime);var timeString=$.datepicker['formatTime']('HH:mm',time);return timeString;}else{return normalTime;}};WeeklyScheduleViewModel.prototype.showSetWorkHour=function(index){if(this.VaryByDay()){if(!this.IsEditMode()){if(this.SetWorkHour()&&index==this.vbd_CurIndex){this.SetWorkHour(false);this.DaysCollection()[index].Color('black');}else{var varybydata=AppData.where(this.vbd_ScheduleRowsContainer(),function(r){return(r.Day()===index);});if(varybydata.length>0){this.ScheduleRows(varybydata[0].Data());}else{this.ScheduleRows([]);this.ScheduleRows.push({WorkStartTime:ko.observable(DEFAULTSTARTTIME),WorkEndTime:ko.observable(DEFAULTENDTIME),IsBreak:ko.observable(false),Index:ko.observable(1),ButtonStatus:ko.observable(true)});this.SetDefaultValuesforConflict();}
this.DaysCollection()[this.vbd_CurIndex].Color('black');this.vbd_CurIndex=index;this.SetWorkHour(true);this.DaysCollection()[index].Color('blue');this.ComputeWorkAndBreakHours();}
this.SelectedWorkDays.removeAll();}else{if(this.SetWorkHour()&&index==this.vbd_CurIndex){this.SetWorkHour(false);this.DaysCollection()[index].Color('black');}else{this.SetWorkHour(true);this.DaysCollection()[this.vbd_CurIndex].Color('black');this.vbd_CurIndex=index;this.DaysCollection()[index].Color('blue');var varybydata=AppData.where(this.vbd_ScheduleRowsContainer(),function(r){return(r.Day()===index);});if(varybydata.length>0){this.ScheduleRows(varybydata[0].Data());window.setTimeout(this.ComputeWorkAndBreakHours(),200);}else{this.ScheduleRows([]);this.ScheduleRows.push({WorkStartTime:ko.observable(DEFAULTSTARTTIME),WorkEndTime:ko.observable(DEFAULTENDTIME),IsBreak:ko.observable(false),Index:ko.observable(1),ButtonStatus:ko.observable(true)});this.SetDefaultValuesforConflict();}}}}else{if(this.IsEditMode()){this.SetWorkHour(true);}else{if(this.SetWorkHour()){this.SetWorkHour(false);}else{this.ScheduleRows.removeAll();this.ScheduleRows.push({WorkStartTime:ko.observable(DEFAULTSTARTTIME),WorkEndTime:ko.observable(DEFAULTENDTIME),IsBreak:ko.observable(false),Index:ko.observable(1),ButtonStatus:ko.observable(true)});this.SetDefaultValuesforConflict();this.SetWorkHour(true);}}}
this.AdjustButtonsForIE();};WeeklyScheduleViewModel.prototype.BindChoices=function(){for(var i=0;i<24;i++){var hr=i>12?i-12:i;if(i==0)
hr=12;var disphr=hr.toString().length==1?'0'+hr.toString():hr.toString();for(var j=0;j<60;j=j+5){var min=j;var dispmin=j.toString().length==1?'0'+j.toString():j.toString();var period=i<12?' AM':' PM';var result=disphr+':'+dispmin+period;this.TimeChoices.push({Text:result,Value:result});}}};WeeklyScheduleViewModel.prototype.CalculateTimeDifference=function(time1,time2){var stHr=time1[1].indexOf('PM')>0&&parseInt(time1[0])!=12?parseInt(time1[0])+12:parseInt(time1[0]);var etHr=time2[1].indexOf('PM')>0&&parseInt(time2[0])!=12?parseInt(time2[0])+12:parseInt(time2[0]);if(stHr==12&&time1[1].indexOf('AM')>0)
stHr=0;if(etHr==12&&time2[1].indexOf('AM')>0)
etHr=0;var date=0;var startDate=new Date(0,0,date,stHr,time1[1].substring(0,2),0);if(time1[1].indexOf('PM')>0&&time2[1].indexOf('AM')>0)
date=1;var endDate=new Date(0,0,date,etHr,time2[1].substring(0,2),0);var diff=Math.abs(endDate.getTime()-startDate.getTime());var hours=Math.floor(diff/1000/60/60);diff=diff-hours*1000*60*60;var minutes=Math.floor(diff/1000/60);return minutes+hours*60;};WeeklyScheduleViewModel.prototype.ComputeDefaultBreak=function(index){if(!this.ScheduleRows()[index])
return;var strtTime=this.ScheduleRows()[index].WorkStartTime().split(':');var endTime=this.ScheduleRows()[index].WorkEndTime().split(':');var diff=this.CalculateTimeDifference(strtTime,endTime);var brkMin=diff>175?30:5;var stHr=strtTime[1].indexOf('PM')>0&&parseInt(strtTime[0])!=12?parseInt(strtTime[0])+12:parseInt(strtTime[0]);var etHr=endTime[1].indexOf('PM')>0&&parseInt(endTime[0])!=12?parseInt(endTime[0])+12:parseInt(endTime[0]);if(stHr==12&&strtTime[1].indexOf('AM')>0)
stHr=0;if(etHr==12&&endTime[1].indexOf('AM')>0)
etHr=0;var stMin=parseInt(strtTime[1].substr(0,2).toString());var diff2=Math.floor(diff/2);var newstHr1=stHr+Math.floor(diff2/60);if(newstHr1>=24&&strtTime[1].indexOf('PM')>0)
newstHr1=newstHr1-24;var newstMin1=stMin+(diff2%60);if(newstMin1>=60){newstHr1=newstHr1+1;newstMin1=newstMin1-60;}
var newstHr=newstHr1;var stAMPM=newstHr<12?' AM':' PM';var newstMin=newstMin1.toString();var newdispstHr=newstHr<=12?(newstHr==0?'12':newstHr.toString()):(newstHr-12).toString();newstMin=parseInt(newstMin)%5==0?newstMin:(parseInt(newstMin)-(parseInt(newstMin)%5)).toString();var newetHr=(newstMin1+brkMin)>=60?newstHr1+1:newstHr1;var etAMPM=newetHr<12?' AM':' PM';var newdispetHr=newetHr<=12?(newetHr==0?'12':newetHr.toString()):(newetHr-12).toString();var newetMin=(newstMin1+brkMin)>=60?(brkMin+newstMin1-60).toString():(newstMin1+brkMin).toString();newetMin=parseInt(newetMin)%5==0?newetMin:(parseInt(newetMin)-(parseInt(newetMin)%5)).toString();newdispstHr=newdispstHr.length==1?'0'+newdispstHr:newdispstHr;newdispetHr=newdispetHr.length==1?'0'+newdispetHr:newdispetHr;newstMin=newstMin.length==1?'0'+newstMin:newstMin;newetMin=newetMin.length==1?'0'+newetMin:newetMin;var newdispStTime=newdispstHr.toString()+':'+newstMin.toString()+stAMPM;var newdispEtTime=newdispetHr.toString()+':'+newetMin.toString()+etAMPM;this.AddDefaultBreak(index,newdispStTime,newdispEtTime);};WeeklyScheduleViewModel.prototype.AddDefaultBreak=function(index,Start,End){this.ScheduleRows()[index+1].WorkStartTime(Start);this.ScheduleRows()[index+1].WorkEndTime(End);this.ScheduleRows()[index+2].WorkEndTime(this.ScheduleRows()[index].WorkEndTime());this.ScheduleRows()[index].WorkEndTime(this.ScheduleRows()[index+1].WorkStartTime());this.ScheduleRows()[index+2].WorkStartTime(this.ScheduleRows()[index+1].WorkEndTime());this.EnableDisableButton(index+2);this.EnableDisableButton(index);};WeeklyScheduleViewModel.prototype.EnableDisableButton=function(index){var _this=this;setTimeout(function(){if(_this.ScheduleRows()[index]&&_this.ScheduleRows()[index].WorkStartTime()&&_this.ScheduleRows()[index].WorkEndTime()){var diff=_this.CalculateTimeDifference(_this.ScheduleRows()[index].WorkStartTime().split(':'),_this.ScheduleRows()[index].WorkEndTime().split(':'));if(diff<15&&!_this.ScheduleRows()[index].IsBreak())
_this.ScheduleRows()[index].ButtonStatus(false);else
_this.ScheduleRows()[index].ButtonStatus(true);}},300);};WeeklyScheduleViewModel.prototype.CalcuateDayPeriod=function(value){if(value.indexOf('AM')>0)
return'AM';else
return'PM';};WeeklyScheduleViewModel.prototype.CompareTimeNew=function(time1,time2){var stHr=time1[1].indexOf('PM')>0&&parseInt(time1[0])!=12?parseInt(time1[0])+12:parseInt(time1[0]);var etHr=time2[1].indexOf('PM')>0&&parseInt(time2[0])!=12?parseInt(time2[0])+12:parseInt(time2[0]);if(stHr==12&&time1[1].indexOf('AM')>0)
stHr=0;if(etHr==12&&time2[1].indexOf('AM')>0)
etHr=0;var startDate=new Date(0,0,0,stHr,time1[1].substring(0,2),0);var endDate=new Date(0,0,0,etHr,time2[1].substring(0,2),0);var diff=endDate.getTime()-startDate.getTime();return diff;};WeeklyScheduleViewModel.prototype.ConvertToHour=function(minute,category){if(minute>=60){this.SetTimeTypes('hours',category);return minute/60;}else{this.SetTimeTypes('minutes',category);return minute;}};WeeklyScheduleViewModel.prototype.SetTimeTypes=function(type,category){if(category=='Working')
this.TimeTypeWorking(type);else if(category=='Total')
this.TimeTypeTotal(type);else if(category=='Breaks')
this.TimeTypeBreaks(type);};WeeklyScheduleViewModel.prototype.vbd_Save=function(){var _this=this;var temp;temp=[];temp=AppData.select(this.ScheduleRows(),function(s){return s;});var varybydata=AppData.where(this.vbd_ScheduleRowsContainer(),function(r){return(r.Day()===_this.vbd_CurIndex);});if(varybydata.length>0)
this.vbd_ScheduleRowsContainer.remove(varybydata[0]);this.vbd_ScheduleRowsContainer.push({Day:ko.observable(this.vbd_CurIndex),Data:ko.observableArray(temp)});this.vbd_SelectedDays.push(this.WorkdaysVBD()[this.vbd_CurIndex].substring(0,1));var l_text=temp[0].WorkStartTime()+' - '+temp[temp.length-1].WorkEndTime();this.DaysCollection()[this.vbd_CurIndex].vbd_LinkText(l_text);this.SetWorkHour(false);this.ScheduleRows([]);this.DaysCollection()[this.vbd_CurIndex].Color('black');};WeeklyScheduleViewModel.prototype.ClosePopup=function(msg){this.IsFirstTime=ko.observable(true);if(this.isClose){this.ClosePopuponSave(event);this.ScheduleRows.removeAll();}
var self=this;CrmData.Common.showMessage(msg);CrmData.Common.disableHTMLScroll();window.setTimeout(self.OnSave(true),1000);};WeeklyScheduleViewModel.prototype.GetVBDDataforSave=function(){var _this=this;this.vbd_NewDayColl=[];if(this.IsEditMode()){var CalId=this.GetInnerCalendarIdsForVaryByEdit();}
var pattern='';var CalendarIdString='';for(var i=0;i<this.DaysCollection().length;i++){if(this.DaysCollection()[i].IsChecked()){this.vbd_NewDayColl.push(DayIndex[this.DaysCollection()[i].WorkDay().substring(0,2).toUpperCase()]);}}
var length=this.vbd_ScheduleRowsContainer().length;for(var i=0;i<length;i++){if(this.IsEditMode()){var CalData=AppData.where(CalId,function(s){return s.Day===_this.Workdays()[_this.vbd_ScheduleRowsContainer()[i].Day()].Value;})[0];if(CalData){CalendarIdString+=CalData.InnerCalendarId;CalendarIdString+=',';}}}
if(CalendarIdString.length>0)
CalendarIdString=CalendarIdString.substring(0,CalendarIdString.length-1);var IsDaysChanged=this.CheckVBDRows();if(IsDaysChanged&&this.IsEditMode()&&this.RecSubType===2){var startDate=(this.RecSubType&&this.RecSubType===2)?$.datepicker.formatDate('yy-mm-dd',this.EditScheduleDetails.ScheduleTypeInfo.StartTime):((this.RecSubType&&this.RecSubType===1)?$.datepicker.formatDate('yy-mm-dd',new Date(this.selectedDate())):$.datepicker.formatDate('yy-mm-dd',new Date(this.DateRange())));var endDate="9999-12-30T23:59:59Z";CrmData.ScheduleData.AddWorkHours(startDate,"12:00 AM",endDate,"12:00 AM","12:00 AM","12:00 AM",this.EquipmentId(),'',parseInt(this.User_TimezoneCode),CalendarIdString,3,false,true,false,$.datepicker.formatDate('yy-mm-dd',new Date(this.selectedDate()))+"T00:00:00Z",'',-1,function(result){if(result&&result.issuccess){pattern=_this.GetPattern();_this.IsVaryDaysChangeOnEdit(true);_this.SaveVaryByDay(pattern);}else{}});}else{pattern=this.GetPattern();if(this.RecSubType===1)
CalendarIdString='';if(this.IsEditMode()&&CalendarIdString.length>0){this.SaveVaryByDay(pattern+'%%%'+CalendarIdString);}else
this.SaveVaryByDay(pattern);}};WeeklyScheduleViewModel.prototype.GetPattern=function(){var data='';var length=this.vbd_ScheduleRowsContainer().length;for(var i=0;i<length;i++){var rowLength=this.vbd_ScheduleRowsContainer()[i].Data().length;data+=this.Workdays()[this.vbd_ScheduleRowsContainer()[i].Day()].Value;var brkStart='';var brkEnd='';for(var j=0;j<rowLength;j++){var row=this.vbd_ScheduleRowsContainer()[i].Data()[j];if(j==0)
data+='#'+row.WorkStartTime();if(j==rowLength-1)
data+='#'+row.WorkEndTime();else{if(row.IsBreak()){brkStart+=row.WorkStartTime();brkEnd+=row.WorkEndTime();if(j!=rowLength-2){brkStart+=',';brkEnd+=',';}}}}
data+='#'+brkStart;data+='#'+brkEnd;if(i!=length-1){data+='$';}}
return data;};WeeklyScheduleViewModel.prototype.SaveWeeklySchedule=function(){if(this.VaryByDay()){this.GetVBDDataforSave();}else if(!this.VaryByDay()){if(this.SetWorkHour()||this.RecSubType>=0){this.onSaveClick(this.ScheduleRows(),this.SelectedWorkDays().toString(),this.isClose,(this.EditScheduleDetails)?this.EditScheduleDetails.CalendarId:'');}}};WeeklyScheduleViewModel.prototype.CheckVBDRows=function(){var _this=this;this.vbd_NewDayColl.sort();this.vbd_PrevDayColl.sort();if(this.vbd_NewDayColl.toString()==this.vbd_PrevDayColl.toString()){return false;}else{var days='';for(var i=0;i<7;i++){days+=!this.DaysCollection()[i].IsChecked()?this.DaysCollection()[i].WorkDay():'';days+=',';}
days=days.substring(0,days.length-1);var DaysColl=days.split(',');for(var i=0;i<DaysColl.length;i++){var varybydata=AppData.where(this.vbd_ScheduleRowsContainer(),function(r){return(r.Day()===_this.WorkdaysVBD.indexOf(DaysColl[i]));});if(varybydata)
this.vbd_ScheduleRowsContainer.remove(varybydata[0]);}
return true;}};WeeklyScheduleViewModel.prototype.SaveVaryByDay=function(pattern){var _this=this;var CalIdString='';if(this.IsEditMode()){CalIdString=pattern.split('%%%')[1];pattern=pattern.split('%%%')[0];}
var utcStart="T00:00:00Z";var utcEnd="T23:59:59Z";var startDate=(this.RecSubType&&this.RecSubType===2)?$.datepicker.formatDate('yy-mm-dd',this.EditScheduleDetails.ScheduleTypeInfo.StartTime):((this.RecSubType&&this.RecSubType===1)?$.datepicker.formatDate('yy-mm-dd',new Date(this.selectedDate())):$.datepicker.formatDate('yy-mm-dd',new Date(this.DateRange())));var businessClosure=(this.BusinessClosure()!==null&&this.BusinessClosure().length>0)?(this.BusinessClosure()==="OBS"?true:false):false;var ConflictStartDate=startDate+"T12:00:00Z";startDate=startDate+utcStart;var endDate='';var eDate='';var typeCode=(this.RecSubType===0&&!this.IsDeleteSchedule())?1:3;if(this.UntilDateString().length>0){eDate=this.UntilDateString();}else{CrmData.Common.showMessage('End date cannot be empty.Please enter an End date');return;}
var subCode=this.RecSubType!==null&&this.RecSubType!==undefined?this.RecSubType:-1;eDate=$.datepicker.formatDate('yy-mm-dd',new Date(eDate));endDate=eDate+utcEnd;this.IsEdit((this.RecSubType==2&&!this.IsDeleteSchedule())?true:false);this.IsEdit(this.IsVaryDaysChangeOnEdit()?false:this.IsEdit());if(this.IsDeleteSchedule()){if(this.RecSubType==0){startDate=$.datepicker.formatDate('yy-mm-dd',new Date(this.selectedDate()));startDate=startDate+utcStart;subCode=0;}else{subCode=this.RecSubType==1?1:-1;}
AppUI.confirm(DELETE_CALENDAR_CONFIRM,function(){var doneLoading=AppUI.loading('Deleting schedule...',10,$('.ccx-ui-popup')[0]);CrmData.ScheduleData.AddWorkHours(startDate,"12:00 AM",endDate,"12:00 AM","12:00 AM","12:00 AM",_this.EquipmentId(),'',parseInt(_this.User_TimezoneCode),CalIdString,typeCode,false,_this.IsDeleteSchedule(),false,$.datepicker.formatDate('yy-mm-dd',new Date(_this.selectedDate()))+"T00:00:00Z",'',subCode,function(result){if(result&&result.issuccess){doneLoading();_this.ClosePopup(DELETE_SUCCESS);}else{doneLoading();CrmData.Common.showMessage(DELETE_FAIL);}});});}else{var doneLoading=AppUI.loading('Please wait...',10,$('.ccx-ui-popup')[0]);this.WorkHoursConflictCheck(startDate,'12:00 AM','12:00 AM',endDate,33,pattern,typeCode,subCode,'',function(SaveDate){if(SaveDate){CrmData.ScheduleData.AddWorkHours(startDate,'12:00 AM',endDate,'12:00 AM','12:00 AM','12:00 AM',_this.EquipmentId(),'',parseInt(_this.User_TimezoneCode),CalIdString,typeCode,_this.IsEdit(),false,businessClosure,startDate,pattern,subCode,function(result){if(result&&result.issuccess){doneLoading();(!_this.IsEdit())?_this.ClosePopup(ADD_SUCCESS):_this.ClosePopup(UPDATE_SUCCESS);}else{doneLoading();CrmData.Common.showMessage(ADD_UPDATE_FAIL);CrmData.Common.disableHTMLScroll();}});}});}};WeeklyScheduleViewModel.prototype.IsMSIE=function(){if(window.navigator.userAgent.toLowerCase().indexOf("msie")>0||window.navigator.userAgent.toLowerCase().indexOf("trident")>0)
return true;else
return false;};WeeklyScheduleViewModel.prototype.GetInnerCalendarIdsForVaryByEdit=function(){var _this=this;var result;result=[];var col;var ruleCollection=AppData.where(CALENDAR_RULES_COLLECTION,function(c){return c.CalendarId===_this.EditScheduleDetails.ScheduleTypeInfo.ParentCalendarId;})[0];if(this.EditScheduleDetails.ScheduleTypeInfo['EffectiveIntervalEnd']){col=AppData.where(ruleCollection['CalendarRules'].scheduleInfo,function(s){return(s['isvaried']&&AppData.formatDate(s['starttime'])===AppData.formatDate(_this.EditScheduleDetails.ScheduleTypeInfo['StartTime'])&&AppData.formatDate(s['effectiveintervalend'])===AppData.formatDate(_this.EditScheduleDetails.ScheduleTypeInfo['EffectiveIntervalEnd']));});}else{col=AppData.where(ruleCollection['CalendarRules'].scheduleInfo,function(s){return(s['isvaried']&&AppData.formatDate(s['starttime'])===AppData.formatDate(_this.EditScheduleDetails.ScheduleTypeInfo['StartTime']));});}
$.each(col,function(i,r){var patternCol=r.pattern.split(';');var day=patternCol[2].split('=')[1];if(day.length>2){var days=day.split(',');$.each(days,function(j,item){result.push({Day:item,InnerCalendarId:r.innercalendarid});});}else{result.push({Day:day,InnerCalendarId:r.innercalendarid});}});return result;};WeeklyScheduleViewModel.prototype.SaveSingleDay=function(){var _this=this;this.IsEdit=ko.observable((this.EntireSchedule())?true:this.IsEdit());var innerCalendarID=(this.EditScheduleDetails&&this.IsEditMode())?this.EditScheduleDetails.CalendarId:'';var typecode=1;var startTime='';var endTime='';var breakStartTime='';var breakEndTime='';var days='';var timezonecode=this.TimezoneValue();var enddate='';var startDate=(this.RecSubType&&this.RecSubType===0)?$.datepicker.formatDate('yy-mm-dd',this.EditScheduleDetails.ScheduleTypeInfo.StartTime):$.datepicker.formatDate('yy-mm-dd',new Date(this.selectedDate()));if(this.ScheduleRows().length>0){startTime=this.ScheduleRows()[0].WorkStartTime();endTime=this.ScheduleRows()[this.ScheduleRows().length-1].WorkEndTime();}
var ConflictStartDate=startDate+"T12:00:00Z";enddate=startDate+"T23:59:59Z";startDate=startDate+"T00:00:00Z";ko.utils.arrayForEach(this.ScheduleRows(),function(elem){if(elem.IsBreak()){breakEndTime=breakEndTime+elem.WorkEndTime()+',';breakStartTime=breakStartTime+elem.WorkStartTime()+',';}});breakEndTime=breakEndTime.substring(0,breakEndTime.length-1);breakStartTime=breakStartTime.substring(0,breakStartTime.length-1);if(this.IsDeleteSchedule()){if(this.ScheduleRows().length>0){AppUI.confirm(DELETE_CALENDAR_CONFIRM,function(){var doneLoading=AppUI.loading('Deleting schedule...',10,$('.ccx-ui-popup')[0]);CrmData.ScheduleData.DeleteSingleDaySchedule(_this.EquipmentId(),startDate,innerCalendarID,1,$.datepicker.formatDate('yy-mm-dd',new Date(_this.selectedDate())),0,function(result){if(result&&result.issuccess){doneLoading();_this.ScheduleRows([]);_this.ResetWorkHoursTotal();_this.ClosePopup(DELETE_SUCCESS);}else{doneLoading();CrmData.Common.showMessage(DELETE_FAIL);}});});}}else{var doneLoading=AppUI.loading('Please wait...',10,$('.ccx-ui-popup')[0]);this.WorkHoursConflictCheck(startDate,startTime,endTime,enddate,22,'',typecode,0,'',function(SaveDate){if(SaveDate){CrmData.ScheduleData.AddWorkHours(startDate,startTime,enddate,endTime,breakStartTime,breakEndTime,_this.EquipmentId(),'',parseInt(_this.User_TimezoneCode),innerCalendarID,1,_this.IsEdit(),_this.IsDeleteSchedule(),false,$.datepicker.formatDate('yy-mm-dd',new Date(_this.selectedDate())),'',0,function(result){if(result&&result.issuccess){doneLoading();(!_this.IsEdit())?_this.ClosePopup(ADD_SUCCESS):_this.ClosePopup(UPDATE_SUCCESS);}else{doneLoading();CrmData.Common.showMessage(ADD_UPDATE_FAIL);CrmData.Common.disableHTMLScroll();}});}});}};WeeklyScheduleViewModel.prototype.ResetWorkHoursTotal=function(){this.Total(this.ConvertToHour(0,'Total').toString());this.Working(this.ConvertToHour(0,'Working').toString());this.Breaks(this.ConvertToHour(0,'Breaks').toString());};WeeklyScheduleViewModel.prototype.SaveWorkHour=function(isClose,event){this.IsFirstTime=ko.observable(true);this.isClose=isClose;if(this.WeeklySchedule()){this.SaveWeeklySchedule();}else if(this.DailySchedule()){if(this.RecSubType===0){if(this.IsDeleteSchedule()){this.SaveWeeklySchedule();}else{this.SaveSingleDay();}}else{this.SaveSingleDay();}}};WeeklyScheduleViewModel.prototype.ClosePopuponSave=function(targetElement){$('.ccx-ui-popup-container .ccx-ui-popup-close').click(targetElement);$('.ccx-ui-popup-container').fadeOut('fast',function(){$('.ccx-ui-popup-container').remove();CrmData.Common.enableHTMLScroll();});};WeeklyScheduleViewModel.prototype.CalculateObservableChanges=function(type,indx){this.ConflictBackupValue='';if(this.IsRemoveItem||this.ItemsAdded||this.ItemsLoaded){this.IsRemoveItem=false;this.ItemsAdded=false;this.ItemsLoaded=false;return;}
switch(type){case'Start':if(indx!=0)
this.ConflictBackupValue=this.ScheduleRows()[indx-1].WorkEndTime();else
this.ConflictBackupValue=this.StartConflictVal();if(!this.ValidateRangeNew('Start',indx)){if(this.ScheduleRows()[indx].IsBreak()){this.ScheduleRows()[indx-1].WorkEndTime(this.ScheduleRows()[indx].WorkStartTime());this.ScheduleRows()[indx+1].WorkStartTime(this.ScheduleRows()[indx].WorkEndTime());}else{if(this.ScheduleRows()[indx-1])
this.ScheduleRows()[indx-1].WorkEndTime(this.ScheduleRows()[indx].WorkStartTime());}}
break;case'End':if(indx!=this.ScheduleRows().length-1)
this.ConflictBackupValue=this.ScheduleRows()[indx+1].WorkStartTime();else
this.ConflictBackupValue=this.EndConflictVal();if(!this.ValidateRangeNew('End',indx)){if(this.ScheduleRows()[indx].IsBreak()){this.ScheduleRows()[indx+1].WorkStartTime(this.ScheduleRows()[indx].WorkEndTime());}else{if(this.ScheduleRows()[indx+1])
this.ScheduleRows()[indx+1].WorkStartTime(this.ScheduleRows()[indx].WorkEndTime());}}
break;}
this.ComputeWorkAndBreakHours();this.EnableDisableButton(indx);this.SetDefaultValuesforConflict();if(this.VaryByDay()&&this.IsEditMode()){var l_text=this.ScheduleRows()[0].WorkStartTime()+' - '+this.ScheduleRows()[this.ScheduleRows().length-1].WorkEndTime();this.DaysCollection()[this.vbd_CurIndex].vbd_LinkText(l_text);}};WeeklyScheduleViewModel.prototype.ValidateRangeNew=function(type,index){if(this.ItemsAdded){this.ItemsAdded=false;return 1;}
var result=false;var TimeSelected=type=='Start'?this.ScheduleRows()[index].WorkStartTime():this.ScheduleRows()[index].WorkEndTime();if(!TimeSelected)
return 1;var diff=0;if(type=='Start'){var diffUp=0;if(index!=0)
diffUp=this.CompareTimeNew(TimeSelected.split(':'),this.ScheduleRows()[index-1].WorkStartTime().split(':'));var diffRight=this.CompareTimeNew(TimeSelected.split(':'),this.ScheduleRows()[index].WorkEndTime().split(':'));if(index!=0)
result=diffUp<=-300000&&diffRight>=300000;else
result=diffRight>=300000;}else{var diffDown=0;if(index!=this.ScheduleRows().length-1)
diffDown=this.CompareTimeNew(TimeSelected.split(':'),this.ScheduleRows()[index+1].WorkEndTime().split(':'));var diffLeft=this.CompareTimeNew(TimeSelected.split(':'),this.ScheduleRows()[index].WorkStartTime().split(':'));if(index!=this.ScheduleRows().length-1)
result=diffDown>=300000&&diffLeft<=-300000;else
result=diffLeft<=-300000;}
var diffResult=false;if(!this.ScheduleRows()[index].IsBreak()&&this.ScheduleRows()[index].WorkStartTime()&&this.ScheduleRows()[index].WorkEndTime()){var start=this.ScheduleRows()[index].WorkStartTime();var end=this.ScheduleRows()[index].WorkEndTime();var diff=this.CalculateTimeDifference(start.split(':'),end.split(':'));diffResult=diff>5?true:false;}
if(result&&diffResult){return;}else{if(type=='Start')
this.ScheduleRows()[index].WorkStartTime(this.ConflictBackupValue);else
this.ScheduleRows()[index].WorkEndTime(this.ConflictBackupValue);if(!result){CrmData.Common.showMessage(WORK_RANGE_CONFLICT);}else if(!diffResult&&result){CrmData.Common.showMessage(MINIMUM_DURATION_ALERT);}
$('#w2ui-popup').css('z-index','1000000');}};WeeklyScheduleViewModel.prototype.ComputeWorkAndBreakHours=function(){var _this=this;setTimeout(function(){var startTime=_this.ScheduleRows()[0].WorkStartTime();var endTime=_this.ScheduleRows()[_this.ScheduleRows().length-1].WorkEndTime();if(!startTime||!endTime)
return;var TotalTime=_this.CalculateTimeDifference(startTime.split(':'),endTime.split(':'));var TotalBreakMinutes=0;for(var i=0;i<_this.ScheduleRows().length;i++){if(_this.ScheduleRows()[i].IsBreak()){TotalBreakMinutes+=_this.CalculateTimeDifference(_this.ScheduleRows()[i].WorkStartTime().split(':'),_this.ScheduleRows()[i].WorkEndTime().split(':'));}}
var TotalWorkHr=TotalTime-TotalBreakMinutes;_this.Total((_this.ConvertToHour(TotalTime,'Total')).toPrecision(3));_this.Working((_this.ConvertToHour(TotalWorkHr,'Working')).toPrecision(3));if(_this.TimeTypeBreaks('minutes'))
_this.Breaks((_this.ConvertToHour(TotalBreakMinutes,'Breaks')).toPrecision(2));else
_this.Breaks((_this.ConvertToHour(TotalBreakMinutes,'Breaks')).toPrecision(3));},300);};WeeklyScheduleViewModel.prototype.CanAddMoreRows=function(index){if(this.ScheduleRows()[index].WorkStartTime()&&this.ScheduleRows()[index].WorkEndTime()){var start=this.ScheduleRows()[index].WorkStartTime();var end=this.ScheduleRows()[index].WorkEndTime();var diff=this.CalculateTimeDifference(start.split(':'),end.split(':'));return diff<15?false:true;}};WeeklyScheduleViewModel.prototype.AddItems=function(index){if(!this.CanAddMoreRows(index))
return;this.ItemsAdded=true;this.ScheduleRows.splice(index+1,0,{WorkStartTime:ko.observable(''),WorkEndTime:ko.observable(''),IsBreak:ko.observable(true),Index:ko.observable(index+1),ButtonStatus:ko.observable(true)});this.ScheduleRows.splice(index+2,0,{WorkStartTime:ko.observable(''),WorkEndTime:ko.observable(''),IsBreak:ko.observable(false),Index:ko.observable(index+2),ButtonStatus:ko.observable(true)});this.BreakCount=this.BreakCount+1;this.AdjustButtonsForIE();this.ComputeDefaultBreak(index);this.ComputeWorkAndBreakHours();this.SetDefaultValuesforConflict();};WeeklyScheduleViewModel.prototype.AdjustButtonsForIE=function(){var _this=this;setTimeout(function(){if(_this.IsMSIE()){$(".dummyClsAddSchedule").css({'padding':'3px','margin':'1px','line-height':'normal'});}},0);};WeeklyScheduleViewModel.prototype.SetDefaultValuesforConflict=function(){if(this.ScheduleRows()[0].WorkStartTime())
this.StartConflictVal(this.ScheduleRows()[0].WorkStartTime());if(this.ScheduleRows()[this.ScheduleRows().length-1].WorkEndTime())
this.EndConflictVal(this.ScheduleRows()[this.ScheduleRows().length-1].WorkEndTime());};WeeklyScheduleViewModel.prototype.DeleteItems=function(index){this.IsRemoveItem=true;this.BreakCount=this.BreakCount-1;this.onRemoveItem(index);this.ScheduleRows.remove(this.ScheduleRows()[index]);this.ScheduleRows.remove(this.ScheduleRows()[index]);this.ComputeWorkAndBreakHours();this.EnableDisableButton(index-1);this.SetDefaultValuesforConflict();};WeeklyScheduleViewModel.prototype.onRemoveItem=function(RowIndex){this.ScheduleRows()[RowIndex-1].WorkEndTime(this.ScheduleRows()[RowIndex+1].WorkEndTime());};WeeklyScheduleViewModel.prototype.onSaveClick=function(arrayValue,day,isClose,innerCalendarID){var endDate='';if(this.UntilDateString().length>0){endDate=this.UntilDateString();}else{CrmData.Common.showMessage('End date cannot be empty.Please enter an End date');return;}
this.SaveDataToCRM(arrayValue,day,isClose,innerCalendarID,endDate);};WeeklyScheduleViewModel.prototype.SaveDataToCRM=function(arrayValue,day,isClose,innerCalendarID,endDate){var _this=this;var utcStart="T00:00:00Z";var utcEnd="T23:59:59Z";var startTime=arrayValue[0].WorkStartTime();var endTime=arrayValue[arrayValue.length-1].WorkEndTime();var typeCode=0;var workDays=day;var startDate=this.DateRange();var breakStartTime="";var breakEndTime="";var subTypeCode=(this.RecSubType!==null&&this.RecSubType!==undefined&&this.RecSubType!==2)?this.RecSubType:-1;var startDate=(this.RecSubType&&this.RecSubType===2)?$.datepicker.formatDate('yy-mm-dd',this.EditScheduleDetails.ScheduleTypeInfo.StartTime):((this.RecSubType&&this.RecSubType===1)?$.datepicker.formatDate('yy-mm-dd',new Date(this.selectedDate())):$.datepicker.formatDate('yy-mm-dd',new Date(this.DateRange())));var ConflictStartDate=startDate+"T12:00:00Z";startDate=startDate+utcStart;var edate=$.datepicker.formatDate('yy-mm-dd',new Date(endDate));endDate=edate+utcEnd;for(var index=1;index<arrayValue.length;index=index+2){breakStartTime=breakStartTime+","+arrayValue[index].WorkStartTime();breakEndTime=breakEndTime+","+arrayValue[index].WorkEndTime();}
breakStartTime=breakStartTime.substr(1,breakStartTime.length);breakEndTime=breakEndTime.substr(1,breakEndTime.length);var isEdit=this.IsEdit();var businessClosure=(this.BusinessClosure()!==null&&this.BusinessClosure().length>0)?(this.BusinessClosure()==="OBS"?true:false):false;if(this.IsDeleteSchedule()){AppUI.confirm(DELETE_CALENDAR_CONFIRM,function(){var doneLoading=AppUI.loading('Deleting Schedule...',10,$('.ccx-ui-popup')[0]);CrmData.ScheduleData.AddWorkHours(startDate,startTime,endDate,endTime,breakStartTime,breakEndTime,_this.EquipmentId(),workDays,parseInt(_this.User_TimezoneCode),innerCalendarID,0,false,_this.IsDeleteSchedule(),false,$.datepicker.formatDate('yy-mm-dd',new Date(_this.selectedDate()))+"T00:00:00Z",'',subTypeCode,function(result){if(result&&result.issuccess){doneLoading();_this.ClosePopup(DELETE_SUCCESS);if(_this.VaryByDay()){_this.vbd_ScheduleRowsContainer([]);}else{_this.ScheduleRows([]);_this.ResetWorkHoursTotal();}}else{doneLoading();CrmData.Common.showMessage(ADD_UPDATE_FAIL);CrmData.Common.disableHTMLScroll();}});});}else{var doneLoading=AppUI.loading('Please wait...',10,$('.ccx-ui-popup')[0]);if(this.RecSubType===null){isEdit=false;}else{isEdit=(this.RecSubType===2)?true:false;}
this.WorkHoursConflictCheck(startDate,startTime,endTime,endDate,11,'',typeCode,subTypeCode,workDays,function(SaveDate){if(SaveDate){CrmData.ScheduleData.AddWorkHours(startDate,startTime,endDate,endTime,breakStartTime,breakEndTime,_this.EquipmentId(),workDays,parseInt(_this.User_TimezoneCode),innerCalendarID,0,isEdit,_this.IsDeleteSchedule(),businessClosure,$.datepicker.formatDate('yy-mm-dd',new Date(_this.selectedDate())),'',subTypeCode,function(result){if(result&&result.issuccess){if(!_this.IsEdit()){doneLoading();_this.ClosePopup(ADD_SUCCESS);}else{doneLoading();_this.ClosePopup(UPDATE_SUCCESS);}}else{doneLoading();CrmData.Common.showMessage(ADD_UPDATE_FAIL);CrmData.Common.disableHTMLScroll();}});}});}};WeeklyScheduleViewModel.prototype.WorkHoursConflictCheck=function(startDate,startTime,endTime,enddate,ConflictTypeCode,pattern,typeCode,subTypeCode,days,callback){var _this=this;var Day='';var SaveDate=true;var CalenderId='';var providerModel=new Scheduling.Models.ProviderSchedule();this.ConflictCheckWorkHour(startDate,startTime,endTime,enddate,ConflictTypeCode,pattern,days,function(result){if(result&&result.issuccess){_this.ShowConflict(result,function(Isave){if(Isave){var d=result.scheduleStartDate;d.setTime(d.getTime()+d.getTimezoneOffset()*60*1000);var scheduleStartDate=new Date(d.getFullYear(),d.getMonth(),d.getDate());CrmData.ScheduleData.AddWorkHours($.datepicker.formatDate('yy-mm-dd',scheduleStartDate)+"T00:00:00Z",startTime,enddate,endTime,'','',result.ConflictEquipmentId,'',parseInt(_this.User_TimezoneCode),result.ConflictCalendarid,result.conflictTypeCode,false,true,false,$.datepicker.formatDate('yy-mm-dd',new Date(startDate))+"T00:00:00Z",'',subTypeCode,function(result){if(result&&result.issuccess){callback(true);}else{CrmData.Common.showMessage('Data delete not successfull');}});}else{callback(false);}});}else{callback(true);}});};WeeklyScheduleViewModel.prototype.ConflictCheckWorkHour=function(startDate,startTime,endTime,enddate,typeCode,pattern,days,callback){CrmData.ScheduleData.AddWorkHours(startDate,startTime,enddate,endTime,'','',this.EquipmentId(),days,parseInt(this.User_TimezoneCode),this.ProviderId(),typeCode,false,false,false,$.datepicker.formatDate('yy-mm-dd',new Date(startDate)),pattern,4,function(result){if(result&&result.isconflict){callback(result);}else{callback(null);}});};WeeklyScheduleViewModel.prototype.ShowConflict=function(result,IsSave){var d=result.ConflictDate;d.setTime(d.getTime()+d.getTimezoneOffset()*60*1000);var conflictDate=new Date(d.getFullYear(),d.getMonth(),d.getDate());var year=(conflictDate).toString().split(' ')[3];if(year=="00:00:00"){year=(conflictDate).toString().split(' ')[5];}
var Day=(conflictDate).toString().split(' ')[0]+' '+(conflictDate).toString().split(' ')[1]+' '+(conflictDate).toString().split(' ')[2]+' '+year;this.ConflictFacilityName=result.locationname;var cStartTime=":00";var cEndTime=":00";var conflictStartTime=result.ConflictStartTime;var conflictEndTime=result.ConflictEndTime;var ScheduleStart='';if(result.conflictTypeCode==0){ScheduleStart="Starts from ";}
var cStartFirst=' ';var cEndTimeFirst='';if((conflictStartTime).toString().split(':')[0].length==1){cStartFirst="0";}
if((conflictEndTime).toString().split(':')[0].length==1){cEndTimeFirst="0";}
if((conflictStartTime).toString().split(':')[1]==0){conflictStartTime=conflictStartTime.toString().split(':')[0]+cStartTime;}
if((conflictEndTime).toString().split(':')[1]==0){conflictEndTime=conflictEndTime.toString().split(':')[0]+cEndTime;}
if((conflictStartTime).toString().split(':')[1]!=0&&(conflictStartTime).toString().split(':')[1].length==1){conflictStartTime=conflictStartTime.toString().split(':')[0]+":"+"0"+(conflictStartTime).toString().split(':')[1];}
if((conflictEndTime).toString().split(':')[1]!=0&&(conflictEndTime).toString().split(':')[1].length==1){conflictEndTime=conflictEndTime.toString().split(':')[0]+":"+"0"+(conflictEndTime).toString().split(':')[1];}
this.ConflictSchedule=ScheduleStart+Day+": "+cStartFirst+conflictStartTime+" - "+cEndTimeFirst+conflictEndTime;var element=AppUI.Popup.show(null,'Schedule Conflict!');CrmData.Common.disableHTMLScroll();var viewContext=new Ccx.Scheduling.ViewModels.ConfirmationViewModel(true,this.ConflictFacilityName,this.ConflictSchedule,function(onsave){if(onsave){IsSave(true);}});App.View.load({ViewName:'Scheduling-ConfirmationView',ViewContext:viewContext},element);};return WeeklyScheduleViewModel;})();ViewModels.WeeklyScheduleViewModel=WeeklyScheduleViewModel;})(Scheduling.ViewModels||(Scheduling.ViewModels={}));var ViewModels=Scheduling.ViewModels;})(Ccx.Scheduling||(Ccx.Scheduling={}));var Scheduling=Ccx.Scheduling;})(Ccx||(Ccx={}));