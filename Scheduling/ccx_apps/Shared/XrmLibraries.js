var AppData, CachedData, CrmData, LocalData, __extends, RestData; XrmServiceToolkit = function () { }; XrmServiceToolkit.Common = function () { var t = function (n, t) { return n === null || t === null || n === undefined || t === undefined ? !1 : n.replace(/[{}]/g, "").toLowerCase() === t.replace(/[{}]/g, "").toLowerCase() }, i = function (n) { Xrm.Page.getControl(n).setDisabled(!1) }, r = function (n) { Xrm.Page.getControl(n).setDisabled(!0) }, u = function (n) { Xrm.Page.getControl(n).setVisible(!0) }, f = function (n) { Xrm.Page.getControl(n).setVisible(!1) }, e = function (n, t) { Xrm.Page.getAttribute(n).setRequiredLevel(t) }, n = function (n) { alert(n.message) }, o = function (t) { try { var i = XrmServiceToolkit.Soap.RetrieveEntityMetadata("Entity", t, !1); return i && i.length === 1 ? i[0].ObjectTypeCode : null } catch (r) { return n(r.message), null } }, s = function (n, t, i) { var u, r; if (Xrm.Page.ui.setFormNotification !== undefined) i ? (Xrm.Page.ui.clearFormNotification(i), t === 1 && Xrm.Page.ui.setFormNotification(n, "ERROR", i), t === 2 && Xrm.Page.ui.setFormNotification(n, "INFO", i), t === 3 && Xrm.Page.ui.setFormNotification(n, "WARNING", i)) : (u = "formNotification00", Xrm.Page.ui.clearFormNotification(u), t === 1 && Xrm.Page.ui.setFormNotification(n, "ERROR", u), t === 2 && Xrm.Page.ui.setFormNotification(n, "INFO", u), t === 3 && Xrm.Page.ui.setFormNotification(n, "WARNING", u)); else { if (r = document.getElementById("crmNotifications"), r === null || r === undefined) { alert("Cannot find the notification area"); return } if (typeof r.AddNotification != "undefined" && typeof r.control.AddNotification != "undefined") { alert("Add Notification is no longer supported"); return } t === 1 && (typeof r.AddNotification != "undefined" ? r.AddNotification("mep1", 1, "source", n) : typeof r.control.AddNotification != "undefined" && r.control.AddNotification("mep1", 1, "source", n)); t === 2 && (typeof r.AddNotification != "undefined" ? r.AddNotification("mep3", 3, "source", n) : typeof r.control.AddNotification != "undefined" && r.control.AddNotification("mep3", 3, "source", n)); t === 3 && (typeof r.AddNotification != "undefined" ? r.AddNotification("mep2", 2, "source", n) : typeof r.control.AddNotification != "undefined" && r.control.AddNotification("mep2", 2, "source", n)); n === "" && (typeof r.SetNotifications != "undefined" ? r.SetNotifications(null, null) : typeof r.control.SetNotifications != "undefined" ? r.control.SetNotifications(null, null) : alert("Set Notification is no longer supported")) } }, h = function (n, t) { Xrm.Page.getControl(n).setNotification !== undefined && Xrm.Page.getControl(n).setNotification(t) }, c = function (n, t) { var i = n.getTime(), r = t.getTime(), u = Math.abs(i - r); return Math.round(u / 864e5) }, l = function (n) { var t = Xrm.Page.ui.tabs.get(n); t != null && Xrm.Page.ui.controls.forEach(function (n) { n.getParent().getParent() === t && n.getControlType() != "subgrid" && n.setDisabled(!0) }) }, a = function (n) { for (var f, r, t, e, u = Xrm.Page.ui.tabs, i = 0; i < u.getLength() ; i++) for (f = u.get(i), r = f.sections, t = 0; t < r.getLength() ; t++) if (e = r.get(t), e.getLabel().toLowerCase() === n.toLowerCase()) { Xrm.Page.ui.controls.forEach(function (t) { t.getParent().getLabel() === n && t.getControlType() != "subgrid" && t.setDisabled(!0) }); break } }; return { EnableField: i, DisableField: r, ShowField: u, HideField: f, UpdateRequiredLevel: e, GetObjectTypeCode: o, CalculateDaysBetween: c, AddNotification: s, AddControlNotification: h, ShowError: n, GuidsAreEqual: t, DisableAllControlsInTab: l, DisableAllControlsInSection: a } }(); XrmServiceToolkit.Rest = function () { var l = function (n) { var t; if (n === null || n === "" || n === undefined) return n; for (var f = 0, i = "", r = "", u = 0; u < n.length; u++) t = n.charCodeAt(u), i += t > 96 && t < 123 || t > 64 && t < 91 || t === 32 || t > 47 && t < 58 || t === 46 || t === 44 || t === 45 || t === 95 ? String.fromCharCode(t) : "&#" + t + ";", ++f == 500 && (r += i, i = "", f = 0); return i.length && (r += i), r }, a = function (n) { for (var u, r = "", t, i = 0; i < n.length; i++) t = n.charCodeAt(i), t >= 55296 && t <= 57343 ? i + 1 < n.length ? (u = n.charCodeAt(i + 1), u >= 56320 && u <= 57343 ? (r += "CRMEntityReferenceOpen" + ((t - 55296) * 1024 + (u & 1023) + 65536).toString(16) + "CRMEntityReferenceClose", i++) : r += String.fromCharCode(t)) : r += String.fromCharCode(t) : r += String.fromCharCode(t); for (n = r, r = "", i = 0; i < n.length; i++) t = n.charCodeAt(i), r += t >= 55296 && t <= 57343 ? String.fromCharCode(65533) : String.fromCharCode(t); return n = r, n = l(n), n = n.replace(/CRMEntityReferenceOpen/g, "&#x"), n.replace(/CRMEntityReferenceClose/g, ";") }, g = function (n) { return "undefined" == typeof n || "unknown" == typeof n || null === n ? n : (typeof n != "string" && (n = n.toString()), a(n)) }, nt = function (n) { return typeof n != "string" && (n = n.toString()), n }, o = function () { var n; if (typeof GetGlobalContext != "undefined") n = window.GetGlobalContext(); else if (typeof Xrm != "undefined") n = Xrm.Page.context; else if (typeof window.parent.Xrm != "undefined") n = window.parent.Xrm.Page.context; else throw new Error("Context is not available."); return n }, v = function () { var n = typeof o().getClientUrl != "undefined" ? o().getClientUrl() : o().getServerUrl(); return n.match(/\/$/) && (n = n.substring(0, n.length - 1)), n }, r = function () { return v() + "/XRMServices/2011/OrganizationData.svc/" }, u = function (n) { return new Error("Error : " + n.status + ": " + n.statusText + ": " + JSON.parse(n.responseText).error.message.value) }, s = function (n, t) { var i; return typeof t == "string" && (i = /Date\(([-+]?\d+)\)/.exec(t), i) ? new Date(parseInt(t.replace("/Date(", "").replace(")/", ""), 10)) : t }, t = function (n, t) { if (typeof n == "undefined" || n === null) throw new Error(t); }, i = function (n, t) { if (typeof n != "string") throw new Error(t); }, n = function (n, t) { if (typeof n != "function") throw new Error(t); }, f = function (n, t) { if (typeof n != "boolean") throw new Error(t); }, e = function () { if (XMLHttpRequest) return new XMLHttpRequest; try { return new ActiveXObject("MSXML2.XMLHTTP.6.0") } catch (n) { try { return new ActiveXObject("MSXML2.XMLHTTP.3.0") } catch (n) { return alert("This browser is not AJAX enabled."), null } } }, y = function (o, h, c, l, a) { t(o, "XrmServiceToolkit.REST.createRecord requires the object parameter."); i(h, "XrmServiceToolkit.REST.createRecord requires the type parameter is a string."); n(c, "XrmServiceToolkit.REST.createRecord requires the successCallback is a function."); n(l, "XrmServiceToolkit.REST.createRecord requires the errorCallback is a function."); f(a, "XrmServiceToolkit.REST.createRecord requires the async is a boolean."); var v = e(); v.open("POST", r() + h, a); v.setRequestHeader("Accept", "application/json"); v.setRequestHeader("Content-Type", "application/json; charset=utf-8"); v.onreadystatechange = function () { this.readyState === 4 && (v.onreadystatechange = null, this.status === 201 ? c(JSON.parse(this.responseText, s).d) : l(u(this))) }; v.send(JSON.stringify(o)) }, p = function (t, o, h, c, l, a, v) { var y, w, p; i(t, "XrmServiceToolkit.REST.retrieveRecord requires the id parameter is a string."); i(o, "XrmServiceToolkit.REST.retrieveRecord requires the type parameter is a string."); h != null && i(h, "XrmServiceToolkit.REST.retrieveRecord requires the select parameter is a string."); c != null && i(c, "XrmServiceToolkit.REST.retrieveRecord requires the expand parameter is a string."); n(l, "XrmServiceToolkit.REST.retrieveRecord requires the successCallback parameter is a function."); n(a, "XrmServiceToolkit.REST.retrieveRecord requires the errorCallback parameter is a function."); f(v, "XrmServiceToolkit.REST.retrieveRecord requires the async parameter is a boolean."); y = ""; (h != null || c != null) && (y = "?", h != null && (w = "$select=" + h, c != null && (w = w + "," + c), y = y + w), c != null && (y = y + "&$expand=" + c)); p = e(); p.open("GET", r() + o + "(guid'" + t + "')" + y, v); p.setRequestHeader("Accept", "application/json"); p.setRequestHeader("Content-Type", "application/json; charset=utf-8"); p.onreadystatechange = function () { this.readyState === 4 && (this.status === 200 ? l(JSON.parse(this.responseText, s).d) : a(u(this))) }; p.send() }, w = function (o, s, h, c, l, a) { i(o, "XrmServiceToolkit.REST.updateRecord requires the id parameter."); t(s, "XrmServiceToolkit.REST.updateRecord requires the object parameter."); i(h, "XrmServiceToolkit.REST.updateRecord requires the type parameter."); n(c, "XrmServiceToolkit.REST.updateRecord requires the successCallback is a function."); n(l, "XrmServiceToolkit.REST.updateRecord requires the errorCallback is a function."); f(a, "XrmServiceToolkit.REST.updateRecord requires the async parameter is a boolean."); var v = e(); v.open("POST", r() + h + "(guid'" + o + "')", a); v.setRequestHeader("Accept", "application/json"); v.setRequestHeader("Content-Type", "application/json; charset=utf-8"); v.setRequestHeader("X-HTTP-Method", "MERGE"); v.onreadystatechange = function () { this.readyState === 4 && (this.status === 204 || this.status === 1223 ? c() : l(u(this))) }; v.send(JSON.stringify(s)) }, b = function (t, o, s, h, c) { i(t, "XrmServiceToolkit.REST.deleteRecord requires the id parameter."); i(o, "XrmServiceToolkit.REST.deleteRecord requires the type parameter."); n(s, "XrmServiceToolkit.REST.deleteRecord requires the successCallback is a function."); n(h, "XrmServiceToolkit.REST.deleteRecord requires the errorCallback is a function."); f(c, "XrmServiceToolkit.REST.deleteRecord requires the async parameter is a boolean."); var l = e(); l.open("POST", r() + o + "(guid'" + t + "')", c); l.setRequestHeader("Accept", "application/json"); l.setRequestHeader("Content-Type", "application/json; charset=utf-8"); l.setRequestHeader("X-HTTP-Method", "DELETE"); l.onreadystatechange = function () { this.readyState === 4 && (this.status === 204 || this.status === 1223 ? s() : h(u(this))) }; l.send() }, h = function (t, o, c, l, a, v) { var p, y; i(t, "XrmServiceToolkit.REST.retrieveMultipleRecords requires the type parameter is a string."); o != null && i(o, "XrmServiceToolkit.REST.retrieveMultipleRecords requires the options parameter is a string."); n(c, "XrmServiceToolkit.REST.retrieveMultipleRecords requires the successCallback parameter is a function."); n(l, "XrmServiceToolkit.REST.retrieveMultipleRecords requires the errorCallback parameter is a function."); n(a, "XrmServiceToolkit.REST.retrieveMultipleRecords requires the OnComplete parameter is a function."); f(v, "XrmServiceToolkit.REST.retrieveMultipleRecords requires the async parameter is a boolean."); p = ""; o != null && (p = o.charAt(0) != "?" ? "?" + o : o); y = e(); y.open("GET", r() + t + p, v); y.setRequestHeader("Accept", "application/json"); y.setRequestHeader("Content-Type", "application/json; charset=utf-8"); y.onreadystatechange = function () { var n, i; this.readyState === 4 && (this.status === 200 ? (n = JSON.parse(this.responseText, s).d, c(n.results), n.__next != null ? (i = n.__next.substring((r() + t).length), h(t, i, c, l, a, v)) : a()) : l(u(this))) }; y.send() }, c = function (n) { t(n, "The value passed to the performRequest function settings parameter is null or undefined."); var i = e(); i.open(n.type, n.url, n.async); i.setRequestHeader("Accept", "application/json"); n.action != null && i.setRequestHeader("X-HTTP-Method", n.action); i.setRequestHeader("Content-Type", "application/json; charset=utf-8"); i.onreadystatechange = function () { this.readyState === 4 && (this.status === 204 || this.status === 1223 || this.status === 201 ? n.success(this) : n.error ? n.error(u(this)) : u(this)) }; typeof n.data == "undefined" ? i.send() : i.send(n.data) }, k = function (i, u, e, o, s, h, l, a) { var v, y; t(i, "XrmServiceToolkit.REST.associateRecord requires the entityid1 parameter."); t(u, "XrmServiceToolkit.REST.associateRecord requires the odataSetName1 parameter."); t(e, "XrmServiceToolkit.REST.associateRecord requires the entityid2 parameter."); t(o, "XrmServiceToolkit.REST.associateRecord requires the odataSetName2 parameter."); t(s, "XrmServiceToolkit.REST.associateRecord requires the relationship parameter."); n(h, "XrmServiceToolkit.REST.associateRecord requires the successCallback is a function."); n(l, "XrmServiceToolkit.REST.associateRecord requires the errorCallback is a function."); f(a, "XrmServiceToolkit.REST.associateRecord requires the async parameter is a boolean"); v = {}; v.uri = r() + "/" + o + "(guid'" + e + "')"; y = window.JSON.stringify(v); c({ type: "POST", url: r() + "/" + u + "(guid'" + i + "')/$links/" + s, data: y, success: h, error: l, async: a }) }, d = function (i, u, e, o, s, h, l) { t(i, "XrmServiceToolkit.REST.disassociateRecord requires the entityid1 parameter."); t(u, "XrmServiceToolkit.REST.disassociateRecord requires the odataSetName parameter."); t(e, "XrmServiceToolkit.REST.disassociateRecord requires the entityid2 parameter."); t(o, "XrmServiceToolkit.REST.disassociateRecord requires the relationship parameter."); n(s, "XrmServiceToolkit.REST.disassociateRecord requires the successCallback is a function."); n(h, "XrmServiceToolkit.REST.disassociateRecord requires the errorCallback is a function."); f(l, "XrmServiceToolkit.REST.disassociateRecord requires the async parameter is a boolean."); var a = r() + "/" + u + "(guid'" + i + "')/$links/" + o + "(guid'" + e + "')"; c({ url: a, type: "POST", action: "DELETE", error: h, success: s, async: l }) }; return { Create: y, Retrieve: p, Update: w, Delete: b, RetrieveMultiple: h, Associate: k, Disassociate: d } }(); XrmServiceToolkit.Soap = function () { var nt = function (n) { var t; if (n === null || n === "" || n === undefined) return n; for (var f = 0, i = "", r = "", u = 0; u < n.length; u++) t = n.charCodeAt(u), i += t > 96 && t < 123 || t > 64 && t < 91 || t === 32 || t > 47 && t < 58 || t === 46 || t === 44 || t === 45 || t === 95 ? String.fromCharCode(t) : "&#" + t + ";", ++f == 500 && (r += i, i = "", f = 0); return i.length && (r += i), r }, tt = function (n) { for (var u, r = "", t, i = 0; i < n.length; i++) t = n.charCodeAt(i), t >= 55296 && t <= 57343 ? i + 1 < n.length ? (u = n.charCodeAt(i + 1), u >= 56320 && u <= 57343 ? (r += "CRMEntityReferenceOpen" + ((t - 55296) * 1024 + (u & 1023) + 65536).toString(16) + "CRMEntityReferenceClose", i++) : r += String.fromCharCode(t)) : r += String.fromCharCode(t) : r += String.fromCharCode(t); for (n = r, r = "", i = 0; i < n.length; i++) t = n.charCodeAt(i), r += t >= 55296 && t <= 57343 ? String.fromCharCode(65533) : String.fromCharCode(t); return n = r, n = nt(n), n = n.replace(/CRMEntityReferenceOpen/g, "&#x"), n.replace(/CRMEntityReferenceClose/g, ";") }, s = function (n) { return "undefined" == typeof n || "unknown" == typeof n || null === n ? n : (typeof n != "string" && (n = n.toString()), tt(n)) }, r = function (n) { return typeof n != "string" && (n = n.toString()), n }, f = function (n, t) { for (t = t || 2, n = "" + n; n.length < t;) n = "0" + n; return n }, it = function (n) { return n.getFullYear() + "-" + f(n.getMonth() + 1) + "-" + f(n.getDate()) + "T" + f(n.getHours()) + ":" + f(n.getMinutes()) + ":" + f(n.getSeconds()) }, n = function (n) { return typeof n == "string" && n.slice(0, 1) == "{" && n.slice(-1) == "}" && (n = n.slice(1, -1)), typeof n == "object" && n.getTime ? it(n) : s(n) }, l = function () { var n; if (typeof GetGlobalContext != "undefined") n = window.GetGlobalContext(); else if (typeof Xrm != "undefined") n = Xrm.Page.context; else if (typeof window.parent.Xrm != "undefined") n = window.parent.Xrm.Page.context; else throw new Error("Context is not available."); return n }, rt = function () { var n = typeof l().getClientUrl != "undefined" ? l().getClientUrl() : l().getServerUrl(); return n.match(/\/$/) && (n = n.substring(0, n.length - 1)), n }, ut = function () { return rt() + "/XRMServices/2011/Organization.svc/web" }, li = function (n, t) { var i; return typeof t == "string" && (i = /Date\(([-+]?\d+)\)/.exec(t), i) ? new Date(parseInt(t.replace("/Date(", "").replace(")/", ""), 10)) : t }, p = function (n, t) { this.type = n; this.value = t }, a = function (n, t, i) { this.id = n; this.logicalName = t; this.name = i; this.type = "EntityReference" }, ft = function (n) { this.value = n; this.type = "EntityCollection" }, et = function (n, t) { this.value = n; this.formattedValue = t; this.type = "OptionSetValue" }, u = function (n, t) { this.id = t ? t : "00000000-0000-0000-0000-000000000000"; this.logicalName = n; this.attributes = {} }, ot = function () { if (XMLHttpRequest) return new XMLHttpRequest; try { return new ActiveXObject("MSXML2.XMLHTTP.6.0") } catch (n) { try { return new ActiveXObject("MSXML2.XMLHTTP.3.0") } catch (n) { return alert("This browser is not AJAX enabled."), null } } }, st = function (n) { var t = n.split(/\D/); return new Date(Date.UTC(t[0], --t[1], t[2], t[3], t[4], t[5])) }; u.prototype = { serialize: function () { var t = ['<entity xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts">'], y, r, o, u, f, h, c, l, a, p, v, e, w; t.push('<a:Attributes xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic">'); for (y in this.attributes) { if (r = this.attributes[y], t.push("<a:KeyValuePairOfstringanyType>"), t.push("<b:key>", y, "<\/b:key>"), r === null || r.value === null) t.push('<b:value i:nil="true" />'); else { o = r.type ? s(r.type) : typeof r; switch (o) { case "OptionSetValue": u = r.hasOwnProperty("value") ? r.value : r; f = n(u); t.push('<b:value i:type="a:OptionSetValue">'); t.push("<a:Value>", f, "<\/a:Value>", "<\/b:value>"); break; case "EntityCollection": for (t.push('<b:value i:type="a:EntityCollection">'), t.push("<a:Entities>"), u = r.hasOwnProperty("value") ? r.value : r, p = i(u) ? u : [u], v = 0; v < p.length; v++) e = p[v], h = e.hasOwnProperty("id") ? e.id : e, c = n(h), l = e.hasOwnProperty("logicalName") ? e.logicalName : e, a = n(l), t.push("<a:Entity>"), t.push("<a:Attributes>"), t.push("<a:KeyValuePairOfstringanyType>"), t.push("<b:key>partyid<\/b:key>"), t.push('<b:value i:type="a:EntityReference">'), t.push("<a:Id>", c, "<\/a:Id>"), t.push("<a:LogicalName>", a, "<\/a:LogicalName>"), t.push('<a:Name i:nil="true" />'), t.push("<\/b:value>"), t.push("<\/a:KeyValuePairOfstringanyType>"), t.push("<\/a:Attributes>"), t.push('<a:EntityState i:nil="true" />'), t.push("<a:FormattedValues />"), t.push("<a:Id>00000000-0000-0000-0000-000000000000<\/a:Id>"), t.push("<a:LogicalName>activityparty<\/a:LogicalName>"), t.push("<a:RelatedEntities />"), t.push("<\/a:Entity>"); t.push("<\/a:Entities>"); t.push('<a:EntityName i:nil="true" />'); t.push('<a:MinActiveRowVersion i:nil="true" />'); t.push("<a:MoreRecords>false<\/a:MoreRecords>"); t.push('<a:PagingCookie i:nil="true" />'); t.push("<a:TotalRecordCount>0<\/a:TotalRecordCount>"); t.push("<a:TotalRecordCountLimitExceeded>false<\/a:TotalRecordCountLimitExceeded>"); t.push("<\/b:value>"); break; case "EntityReference": h = r.hasOwnProperty("id") ? r.id : r; c = n(h); l = r.hasOwnProperty("logicalName") ? r.logicalName : r; a = n(l); t.push('<b:value i:type="a:EntityReference">'); t.push("<a:Id>", c, "<\/a:Id>"); t.push("<a:LogicalName>", a, "<\/a:LogicalName>"); t.push('<a:Name i:nil="true" />', "<\/b:value>"); break; case "Money": u = r.hasOwnProperty("value") ? r.value : r; f = n(u); t.push('<b:value i:type="a:Money">'); t.push("<a:Value>", f, "<\/a:Value>", "<\/b:value>"); break; case "guid": u = r.hasOwnProperty("value") ? r.value : r; f = n(u); t.push('<b:value i:type="c:guid" xmlns:c="http://schemas.microsoft.com/2003/10/Serialization/">'); t.push(f, "<\/b:value>"); break; case "number": u = r.hasOwnProperty("value") ? r.value : r; f = n(u); w = parseInt(f) === f ? "c:int" : "c:decimal"; t.push('<b:value i:type="', w, '" xmlns:c="http://www.w3.org/2001/XMLSchema">'); t.push(f, "<\/b:value>"); break; default: u = r.hasOwnProperty("value") ? r.value : r; f = n(u); o = typeof u == "object" && u.getTime ? "dateTime" : o; t.push('<b:value i:type="c:', o, '" xmlns:c="http://www.w3.org/2001/XMLSchema">', f, "<\/b:value>") } } t.push("<\/a:KeyValuePairOfstringanyType>") } return t.push('<\/a:Attributes><a:EntityState i:nil="true" />'), t.push('<a:FormattedValues xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic" />'), t.push("<a:Id>", n(this.id), "<\/a:Id>"), t.push("<a:LogicalName>", this.logicalName, "<\/a:LogicalName>"), t.push('<a:RelatedEntities xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic" />'), t.push("<\/entity>"), t.join("") }, deserialize: function (n) { for (var t, u, r, e, v, f, i, b, d, y, l, s, w, k, h = {}, c = n.childNodes, o = 0; o < c.length; o++) switch (c[o].nodeName) { case "a:Attributes": for (r = c[o], t = 0; t < r.childNodes.length; t++) { for (u = jQuery(r.childNodes[t].firstChild).text(), e = "", v = 0; v < r.childNodes[t].childNodes[1].attributes.length; v++) r.childNodes[t].childNodes[1].attributes[v].nodeName === "i:type" && (e = jQuery(r.childNodes[t].childNodes[1].attributes[v]).val()); switch (e) { case "a:OptionSetValue": b = new et; b.type = e.replace("a:", ""); b.value = parseInt(jQuery(r.childNodes[t].childNodes[1]).text()); h[u] = b; break; case "a:EntityReference": f = new a; f.type = e.replace("a:", ""); f.id = jQuery(r.childNodes[t].childNodes[1].childNodes[0]).text(); f.logicalName = jQuery(r.childNodes[t].childNodes[1].childNodes[1]).text(); f.name = jQuery(r.childNodes[t].childNodes[1].childNodes[2]).text(); h[u] = f; break; case "a:EntityCollection": for (f = new ft, f.type = e.replace("a:", ""), d = [], y = 0; y < r.childNodes[t].childNodes[1].childNodes[0].childNodes.length; y++) for (l = r.childNodes[t].childNodes[1].childNodes[0].childNodes[y].childNodes[0].childNodes, s = 0; s < l.length; s++) jQuery(l[s].childNodes[0]).text() === "partyid" && (w = new a, w.id = jQuery(l[s].childNodes[1].childNodes[0]).text(), w.logicalName = jQuery(l[s].childNodes[1].childNodes[1]).text(), w.name = jQuery(l[s].childNodes[1].childNodes[2]).text(), d[y] = w); f.value = d; h[u] = f; break; case "a:Money": i = new p; i.type = e.replace("a:", ""); i.value = parseFloat(jQuery(r.childNodes[t].childNodes[1]).text()); h[u] = i; break; default: i = new p; i.type = e.replace("c:", "").replace("a:", ""); i.type === "int" ? i.value = parseInt(jQuery(r.childNodes[t].childNodes[1]).text()) : i.type === "decimal" || i.type === "double" ? i.value = parseFloat(jQuery(r.childNodes[t].childNodes[1]).text()) : i.type === "dateTime" ? i.value = st(jQuery(r.childNodes[t].childNodes[1]).text()) : i.type === "boolean" ? i.value = jQuery(r.childNodes[t].childNodes[1]).text() === "false" ? !1 : !0 : i.type === "AliasedValue" ? (i.value = jQuery(r).children().eq(t).children().eq(1).children().eq(2).text(), jQuery(r).children().eq(t).children().eq(1).children().eq(2).attr("i:type") === "a:EntityReference" && (i = new a, i.type = "EntityReference", i.id = jQuery(r).children().eq(t).children().eq(1).children().eq(2).children().eq(0).text(), i.logicalName = jQuery(r).children().eq(t).children().eq(1).children().eq(2).children().eq(1).text(), i.name = jQuery(r).children().eq(t).children().eq(1).children().eq(2).children().eq(2).text())) : i.value = jQuery(r.childNodes[t].childNodes[1]).text(); h[u] = i } } this.attributes = h; break; case "a:Id": this.id = jQuery(c[o]).text(); break; case "a:LogicalName": this.logicalName = jQuery(c[o]).text(); break; case "a:FormattedValues": for (k = c[o], t = 0; t < k.childNodes.length; t++) u = jQuery(k.childNodes[t].firstChild).text(), this.attributes[u].formattedValue = jQuery(k.childNodes[t].childNodes[1]).text(), isNaN(this.attributes[u].value) && this.attributes[u].type === "dateTime" && (this.attributes[u].value = new Date(this.attributes[u].formattedValue)) } } }; var v = function (n) { var t = null, i; try { window.DOMParser ? (i = new DOMParser, t = i.parseFromString(n, "text/xml")) : (t = new ActiveXObject("Microsoft.XMLDOM"), t.async = !1, t.loadXML(n)) } catch (r) { alert("Cannot convert the XML string to a cross-browser XML object.") } return t }, w = function (n) { var t = ""; try { n != null && (typeof XMLSerializer != "undefined" && typeof n.xml == "undefined" ? t = (new XMLSerializer).serializeToString(n[0]) : typeof n.xml != "undefined" ? t = n.xml : typeof n[0].xml != "undefined" && (t = n[0].xml)) } catch (i) { alert("Cannot convert the XML to a string.") } return t }, t = function (n, t, i, r) { var e, u, f; if (i = i || !1, e = ["<soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>", "<soap:Body>", "<", t, " xmlns='http://schemas.microsoft.com/xrm/2011/Contracts/Services' xmlns:i='http://www.w3.org/2001/XMLSchema-instance'>", n, "<\/", t, ">", "<\/soap:Body>", "<\/soap:Envelope>"].join(""), u = ot(), u.open("POST", ut(), i), u.setRequestHeader("Accept", "application/xml, text/xml, */*"), u.setRequestHeader("Content-Type", "text/xml; charset=utf-8"), u.setRequestHeader("SOAPAction", "http://schemas.microsoft.com/xrm/2011/Contracts/Services/IOrganizationService/" + t), u.send(e), i) u.onreadystatechange = function () { u.readyState === 4 && (u.onreadystatechange = null, u.status === 200 ? r(y(u.responseXML, u.responseText)) : y(u.responseXML, u.responseText)) }; else return f = y(u.responseXML, u.responseText), !r ? f : r(f) }, y = function (n, t) { var i, r, u; if (n === null || typeof n == "undefined" || n.xml === null || n.xml === "") if (t !== null && t !== "") throw new Error(t); else throw new Error("No response received from the server. "); if (typeof n.xml == "undefined") { if (i = jQuery(t).find("error").text(), r = jQuery(t).find("faultstring").text(), i != "" || r != "") throw new Error(i !== "" ? jQuery(t).find("description").text() : r); u = v(t) } else { if (i = jQuery(n).find("error").text(), r = jQuery(n).find("faultstring").text(), i != "" || r != "") throw new Error(i != "" ? jQuery(n).find("description").text() : r); u = v(w(n)) } return u }, ht = function (n, i) { var f = n.serialize(), u = !!i; return t(f, "Create", u, function (n) { var f = jQuery(n).find("CreateResult").eq(0), t = r(f.text()); if (u) i(t); else return t }) }, ct = function (n, i) { var f = n.serialize(), u = !!i; return t(f, "Update", u, function (n) { var f = jQuery(n).find("UpdateResponse").eq(0), t = r(f.text()); if (u) i(t); else return t }) }, lt = function (n, i, u) { var e = ["<entityName>", n, "<\/entityName>", "<id>", i, "<\/id>"].join(""), f = !!u; return t(e, "Delete", f, function (n) { var i = jQuery(n).find("DeleteResponse").eq(0), t = r(i.text()); if (f) u(t); else return t }) }, at = function (n, i) { var r = !!i; return t(n, "Execute", r, function (n) { if (r) i(n); else return n }) }, b = function (n, i, r, f) { var e = ["<fetch mapping='logical' page='" + i + "' count='5000' paging-cookie='" + r + "'>", n, "<\/fetch>"].join(""), o = "<query i:type='a:FetchExpression' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'><a:Query>" + s(e) + "<\/a:Query><\/query>"; return t(o, "RetrieveMultiple", !1, function (t) { var e, s, r, o, h; for (e = jQuery(t).find("a\\:Entities").length != 0 ? jQuery(t).find("a\\:Entities").eq(0)[0] : jQuery(t).find("Entities").eq(0)[0], s = jQuery(t).find("a\\:MoreRecords").length != 0 ? jQuery(t).find("a\\:MoreRecords").eq(0)[0].firstChild.text === "true" : jQuery(t).find("MoreRecords").eq(0)[0].firstChild.text === "true", r = 0; r < e.childNodes.length; r++) o = new u, o.deserialize(e.childNodes[r]), f.push(o); if (s) i += 1, h = jQuery(t).find("a\\:PagingCookie").length != 0 ? jQuery(t).find("a\\:PagingCookie").eq(0)[0].firstChild.text.replace(/\"/g, "'").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/'/g, "&quot;") : jQuery(t).find("PagingCookie").eq(0)[0].firstChild.text.replace(/\"/g, "'").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/'/g, "&quot;"), b(n, i, h, f); else return f }) }, h = function (n, i, r) { var l = n.indexOf("aggregate") !== -1, e, f, o, h, c; if (typeof i != "function" && n.slice(0, 6) === "<fetch") { if (e = jQuery(v(n)).find("entity"), e.length < 1) throw new Error("XrmServiceToolkit.Fetch: No 'entity' node in the provided FetchXML."); f = e; try { n = w(f) } catch (a) { if (f.xml) n = f.xml; else throw new Error("XrmServiceToolkit.Fetch: This client does not provide the necessary XML features to continue."); } } return o = ["<fetch mapping='logical'", l ? " aggregate='true'>" : ">", n, "<\/fetch>"].join(""), typeof i == "function" && (o = n), h = "<query i:type='a:FetchExpression' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'><a:Query>" + s(o) + "<\/a:Query><\/query>", c = !!r, t(h, "RetrieveMultiple", !!r, function (t) { var o, f, e, s, l, h; for (o = jQuery(t).find("a\\:Entities").length != 0 ? jQuery(t).find("a\\:Entities").eq(0)[0] : jQuery(t).find("Entities").eq(0)[0], moreRecords = jQuery(t).find("a\\:MoreRecords").length != 0 ? jQuery(t).find("a\\:MoreRecords").eq(0)[0].firstChild.text === "true" : jQuery(t).find("MoreRecords").eq(0)[0].firstChild.text === "true", f = [], e = 0; e < o.childNodes.length; e++) s = new u, s.deserialize(o.childNodes[e]), f.push(s); if (i && moreRecords) { if (l = 2, h = jQuery(t).find("a\\:PagingCookie").length != 0 ? jQuery(t).find("a\\:PagingCookie").eq(0)[0].firstChild.text.replace(/\"/g, "'").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/'/g, "&quot;") : jQuery(t).find("PagingCookie").eq(0)[0].firstChild.text.replace(/\"/g, "'").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/'/g, "&quot;"), typeof i == "function") { i(h); return } b(n, l, h, f) } if (c) r(f); else return f }) }, vt = function (n, i, r, f) { var s = "", o = "", e, h, c; if (r != null) { for (e = 0; e < r.length; e++) s += "<b:string>" + r[e] + "<\/b:string>"; o = "<a:AllColumns>false<\/a:AllColumns><a:Columns xmlns:b='http://schemas.microsoft.com/2003/10/Serialization/Arrays'>" + s + "<\/a:Columns>" } else o = "<a:AllColumns>true<\/a:AllColumns><a:Columns xmlns:b='http://schemas.microsoft.com/2003/10/Serialization/Arrays' />"; return h = ["<entityName>", n, "<\/entityName>", "<id>", i, "<\/id>", "<columnSet xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'>", o, "<\/columnSet>"].join(""), c = !!f, t(h, "Retrieve", !!f, function (n) { var i = jQuery(n).find("RetrieveResult").eq(0)[0], t = new u; if (t.deserialize(i), c) f(t); else return t }) }, yt = function (n, i) { var f = ["<query i:type='a:QueryExpression' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'>", n, "<\/query>"].join(""), r = !!i; return t(f, "RetrieveMultiple", r, function (n) { var e, f, t, o; for (e = jQuery(n).find("a\\:Entities").length != 0 ? jQuery(n).find("a\\:Entities").eq(0)[0] : jQuery(n).find("Entities").eq(0)[0], f = [], t = 0; t < e.childNodes.length; t++) o = new u, o.deserialize(e.childNodes[t]), f[t] = o; if (r) i(f); else return f }) }, c = function (n, t, i) { for (var u = [], r = 0; r < t.length; r++) t[r] != "" && t[r] != undefined && u.push(n, t[r], i); return u.join("") }, k = function (t, i) { for (var f, e, u = [], r = 0; r < t.length; r++) if (t[r] != "") if (typeof i[r] == typeof []) { u.push("<condition attribute='", t[r], "' operator='in' >"); for (f in i[r]) e = n(i[r][f]), u.push("<value>" + e + "<\/value>"); u.push("<\/condition>") } else typeof i[r] == "string" && u.push("<condition attribute='", t[r], "' operator='eq' value='", n(i[r]), "' />"); return u.join("") }, i = function (n) { return n.constructor.toString().indexOf("Array") != -1 }, pt = function (n, t) { var s = n.entityName, f = n.attributes, e = n.values, r = n.columnSet, u = n.orderBy || "", o; return f = i(f) ? f : [f], e = i(e) ? e : [e], u = !!u && i(u) ? u : [u], r = !!r && i(r) ? r : [r], o = ["   <entity name='", s, "'>", c("<attribute name='", r, "' />"), c("<order attribute='", u, "' />"), "      <filter>", k(f, e), "      <\/filter>", "   <\/entity>"].join(""), h(o, !1, t) }, wt = function (n, t) { var l = n.entityName, f = n.attributes, e = n.values, r = n.columnSet, u = n.orderBy || "", o, s; return f = i(f) ? f : [f], e = i(e) ? e : [e], u = !!u && i(u) ? u : [u], r = !!r && i(r) ? r : [r], o = ["   <entity name='", l, "'>", c("<attribute name='", r, "' />"), c("<order attribute='", u, "' />"), "      <filter>", k(f, e), "      <\/filter>", "   <\/entity>"].join(""), s = !!t, h(o, !0, s) }, bt = function (n, i, u, f, e) { var s = ["<request i:type='b:SetStateRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'>", "<a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>", "<a:KeyValuePairOfstringanyType>", "<c:key>EntityMoniker<\/c:key>", "<c:value i:type='a:EntityReference'>", "<a:Id>", i, "<\/a:Id>", "<a:LogicalName>", n, "<\/a:LogicalName>", "<a:Name i:nil='true' />", "<\/c:value>", "<\/a:KeyValuePairOfstringanyType>", "<a:KeyValuePairOfstringanyType>", "<c:key>State<\/c:key>", "<c:value i:type='a:OptionSetValue'>", "<a:Value>", u.toString(), "<\/a:Value>", "<\/c:value>", "<\/a:KeyValuePairOfstringanyType>", "<a:KeyValuePairOfstringanyType>", "<c:key>Status<\/c:key>", "<c:value i:type='a:OptionSetValue'>", "<a:Value>", f.toString(), "<\/a:Value>", "<\/c:value>", "<\/a:KeyValuePairOfstringanyType>", "<\/a:Parameters>", "<a:RequestId i:nil='true' />", "<a:RequestName>SetState<\/a:RequestName>", "<\/request>"].join(""), o = !!e; return t(s, "Execute", o, function (n) { var i = jQuery(n).find("ExecuteResult").eq(0), t = r(i.text()); if (o) e(t); else return t }) }, kt = function (n, u, f, e, o, s) { var h = o, l, c; for (h = i(h) ? h : [h], l = [], c = 0; c < h.length; c++) h[c].id != "" && l.push("<a:EntityReference>", "<a:Id>", h[c].id, "<\/a:Id>", "<a:LogicalName>", e, "<\/a:LogicalName>", "<a:Name i:nil='true' />", "<\/a:EntityReference>"); var v = l.join(""), y = ["<request i:type='a:AssociateRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'>", "<a:Parameters xmlns:b='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>", "<a:KeyValuePairOfstringanyType>", "<b:key>Target<\/b:key>", "<b:value i:type='a:EntityReference'>", "<a:Id>", f, "<\/a:Id>", "<a:LogicalName>", u, "<\/a:LogicalName>", "<a:Name i:nil='true' />", "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<a:KeyValuePairOfstringanyType>", "<b:key>Relationship<\/b:key>", "<b:value i:type='a:Relationship'>", "<a:PrimaryEntityRole i:nil='true' />", "<a:SchemaName>", n, "<\/a:SchemaName>", "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<a:KeyValuePairOfstringanyType>", "<b:key>RelatedEntities<\/b:key>", "<b:value i:type='a:EntityReferenceCollection'>", v, "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<\/a:Parameters>", "<a:RequestId i:nil='true' />", "<a:RequestName>Associate<\/a:RequestName>", "<\/request>"].join(""), a = !!s; return t(y, "Execute", a, function (n) { var i = jQuery(n).find("ExecuteResult").eq(0), t = r(i.text()); if (a) s(t); else return t }) }, dt = function (n, u, f, e, o, s) { var h = o, l, c; for (h = i(h) ? h : [h], l = [], c = 0; c < h.length; c++) h[c].id != "" && l.push("<a:EntityReference>", "<a:Id>", h[c].id, "<\/a:Id>", "<a:LogicalName>", e, "<\/a:LogicalName>", "<a:Name i:nil='true' />", "<\/a:EntityReference>"); var v = l.join(""), y = ["<request i:type='a:DisassociateRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'>", "<a:Parameters xmlns:b='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>", "<a:KeyValuePairOfstringanyType>", "<b:key>Target<\/b:key>", "<b:value i:type='a:EntityReference'>", "<a:Id>", f, "<\/a:Id>", "<a:LogicalName>", u, "<\/a:LogicalName>", "<a:Name i:nil='true' />", "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<a:KeyValuePairOfstringanyType>", "<b:key>Relationship<\/b:key>", "<b:value i:type='a:Relationship'>", "<a:PrimaryEntityRole i:nil='true' />", "<a:SchemaName>", n, "<\/a:SchemaName>", "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<a:KeyValuePairOfstringanyType>", "<b:key>RelatedEntities<\/b:key>", "<b:value i:type='a:EntityReferenceCollection'>", v, "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<\/a:Parameters>", "<a:RequestId i:nil='true' />", "<a:RequestName>Disassociate<\/a:RequestName>", "<\/request>"].join(""), a = !!s; return t(y, "Execute", a, function (n) { var i = jQuery(n).find("ExecuteResult").eq(0), t = r(i.text()); if (a) s(t); else return t }) }, gt = function () { var n = t("<request i:type='b:WhoAmIRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'><a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic' /><a:RequestId i:nil='true' /><a:RequestName>WhoAmI<\/a:RequestName><\/request>", "Execute"); return jQuery(n).find("a\\:Results").length != 0 ? jQuery(n).find("a\\:Results").children().eq(0).children().eq(1).text() : jQuery(n).find("Results").children().eq(0).children().eq(1).text() }, ni = function () { var n = t("<request i:type='b:WhoAmIRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'><a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic' /><a:RequestId i:nil='true' /><a:RequestName>WhoAmI<\/a:RequestName><\/request>", "Execute"); return jQuery(n).find("a\\:Results").length != 0 ? jQuery(n).find("a\\:Results").children().eq(1).children().eq(1).text() : jQuery(n).find("Results").children().eq(1).children().eq(1).text() }, d = function () { var r = "<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='true'><entity name='role'><attribute name='name' /><attribute name='businessunitid' /><attribute name='roleid' /><order attribute='name' descending='false' /><link-entity name='systemuserroles' from='roleid' to='roleid' visible='false' intersect='true'><link-entity name='systemuser' from='systemuserid' to='systemuserid' alias='aa'><filter type='and'><condition attribute='systemuserid' operator='eq-userid' /><\/filter><\/link-entity><\/link-entity><\/entity><\/fetch>", t = h(r), i = [], n; if (t !== null && typeof t != "undefined") for (n = 0; n < t.length; n++) i[n] = t[n].attributes.name.value; return i }, ti = function () { for (var n, i = d(), t = 0; t < i.length; t++) for (n = 0; n < arguments.length; n++) if (i[t] === arguments[n]) return !0; return !1 }, ii = function (n, i, u, f, e) { var s = "<request i:type='b:AssignRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'><a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic'><a:KeyValuePairOfstringanyType><c:key>Target<\/c:key><c:value i:type='a:EntityReference'><a:Id>" + i + "<\/a:Id><a:LogicalName>" + n + "<\/a:LogicalName><a:Name i:nil='true' /><\/c:value><\/a:KeyValuePairOfstringanyType><a:KeyValuePairOfstringanyType><c:key>Assignee<\/c:key><c:value i:type='a:EntityReference'><a:Id>" + f + "<\/a:Id><a:LogicalName>" + u + "<\/a:LogicalName><a:Name i:nil='true' /><\/c:value><\/a:KeyValuePairOfstringanyType><\/a:Parameters><a:RequestId i:nil='true' /><a:RequestName>Assign<\/a:RequestName><\/request>", o = !!e; return t(s, "Execute", o, function (n) { var i = jQuery(n).find("ExecuteResult").eq(0), t = r(i.text()); if (o) e(t); else return t }) }, ri = function (u, f) { var l = u.targetEntityName, a = u.targetEntityId, v = u.principalEntityName, y = u.principalEntityId, e = u.accessRights, s, o, c, h; for (e = i(e) ? e : [e], s = "", o = 0; o < e.length; o++) s += n(e[o]) + " "; return c = "<request i:type='b:GrantAccessRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'><a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic'><a:KeyValuePairOfstringanyType><c:key>Target<\/c:key><c:value i:type='a:EntityReference'><a:Id>" + a + "<\/a:Id><a:LogicalName>" + l + "<\/a:LogicalName><a:Name i:nil='true' /><\/c:value><\/a:KeyValuePairOfstringanyType><a:KeyValuePairOfstringanyType><c:key>PrincipalAccess<\/c:key><c:value i:type='b:PrincipalAccess'><b:AccessMask>" + s + "<\/b:AccessMask><b:Principal><a:Id>" + y + "<\/a:Id><a:LogicalName>" + v + "<\/a:LogicalName><a:Name i:nil='true' /><\/b:Principal><\/c:value><\/a:KeyValuePairOfstringanyType><\/a:Parameters><a:RequestId i:nil='true' /><a:RequestName>GrantAccess<\/a:RequestName><\/request>", h = !!f, t(c, "Execute", h, function (n) { var i = jQuery(n).find("ExecuteResult").eq(0), t = r(i.text()); if (h) f(t); else return t }) }, ui = function (u, f) { var l = u.targetEntityName, a = u.targetEntityId, v = u.principalEntityName, y = u.principalEntityId, e = u.accessRights, s, o, c, h; for (e = i(e) ? e : [e], s = "", o = 0; o < e.length; o++) s += n(e[o]) + " "; return c = "<request i:type='b:ModifyAccessRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'><a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic'><a:KeyValuePairOfstringanyType><c:key>Target<\/c:key><c:value i:type='a:EntityReference'><a:Id>" + a + "<\/a:Id><a:LogicalName>" + l + "<\/a:LogicalName><a:Name i:nil='true' /><\/c:value><\/a:KeyValuePairOfstringanyType><a:KeyValuePairOfstringanyType><c:key>PrincipalAccess<\/c:key><c:value i:type='b:PrincipalAccess'><b:AccessMask>" + s + "<\/b:AccessMask><b:Principal><a:Id>" + y + "<\/a:Id><a:LogicalName>" + v + "<\/a:LogicalName><a:Name i:nil='true' /><\/b:Principal><\/c:value><\/a:KeyValuePairOfstringanyType><\/a:Parameters><a:RequestId i:nil='true' /><a:RequestName>ModifyAccess<\/a:RequestName><\/request>", h = !!f, t(c, "Execute", h, function (n) { var i = jQuery(n).find("ExecuteResult").eq(0), t = r(i.text()); if (h) f(t); else return t }) }, fi = function (n, i) { var f = n.targetEntityName, e = n.targetEntityId, o = n.revokeeEntityName, s = n.revokeeEntityId, h = "<request i:type='b:RevokeAccessRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'><a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic'><a:KeyValuePairOfstringanyType><c:key>Target<\/c:key><c:value i:type='a:EntityReference'><a:Id>" + e + "<\/a:Id><a:LogicalName>" + f + "<\/a:LogicalName><a:Name i:nil='true' /><\/c:value><\/a:KeyValuePairOfstringanyType><a:KeyValuePairOfstringanyType><c:key>Revokee<\/c:key><c:value i:type='a:EntityReference'><a:Id>" + s + "<\/a:Id><a:LogicalName>" + o + "<\/a:LogicalName><a:Name i:nil='true' /><\/c:value><\/a:KeyValuePairOfstringanyType><\/a:Parameters><a:RequestId i:nil='true' /><a:RequestName>RevokeAccess<\/a:RequestName><\/request>", u = !!i; return t(h, "Execute", u, function (n) { var f = jQuery(n).find("ExecuteResult").eq(0), t = r(f.text()); if (u) i(t); else return t }) }, ei = function (n, i) { var f = n.targetEntityName, e = n.targetEntityId, o = n.principalEntityName, s = n.principalEntityId, h = "<request i:type='b:RetrievePrincipalAccessRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'><a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic'><a:KeyValuePairOfstringanyType><c:key>Target<\/c:key><c:value i:type='a:EntityReference'><a:Id>" + e + "<\/a:Id><a:LogicalName>" + f + "<\/a:LogicalName><a:Name i:nil='true' /><\/c:value><\/a:KeyValuePairOfstringanyType><a:KeyValuePairOfstringanyType><c:key>Principal<\/c:key><c:value i:type='a:EntityReference'><a:Id>" + s + "<\/a:Id><a:LogicalName>" + o + "<\/a:LogicalName><a:Name i:nil='true' /><\/c:value><\/a:KeyValuePairOfstringanyType><\/a:Parameters><a:RequestId i:nil='true' /><a:RequestName>RetrievePrincipalAccess<\/a:RequestName><\/request>", u = !!i; return t(h, "Execute", u, function (n) { var f, t; if (f = jQuery(n).find("c\\:value").length != 0 ? jQuery(n).find("c\\:value").eq(0) : jQuery(n).find("value").eq(0), t = r(f.text()), u) i(t); else return t }) }, g = ["Attributes", "ManyToManyRelationships", "ManyToOneRelationships", "OneToManyRelationships", "Privileges", "LocalizedLabels", "Options", "Targets"], oi = function (n) { for (var t = 0; t < g.length; t++) if (n === g[t]) return !0; return !1 }, e = function (n) { return typeof n.baseName != "undefined" ? n.baseName : n.localName }, o = function (n) { var s, u, t, h, f, r, i; if (n.attributes != null && n.attributes.length == 1 && n.attributes.getNamedItem("i:nil") != null && n.attributes.getNamedItem("i:nil").nodeValue == "true") return null; if (n.firstChild != null && n.firstChild.nodeType == 3) { s = e(n); switch (s) { case "ActivityTypeMask": case "ObjectTypeCode": case "ColumnNumber": case "DefaultFormValue": case "MaxValue": case "MinValue": case "MaxLength": case "Order": case "Precision": case "PrecisionSource": case "LanguageCode": return parseInt(n.firstChild.nodeValue, 10); case "AutoRouteToOwnerQueue": case "CanBeChanged": case "CanTriggerWorkflow": case "IsActivity": case "IsActivityParty": case "IsAvailableOffline": case "IsChildEntity": case "IsCustomEntity": case "IsCustomOptionSet": case "IsDocumentManagementEnabled": case "IsEnabledForCharts": case "IsGlobal": case "IsImportable": case "IsIntersect": case "IsManaged": case "IsReadingPaneEnabled": case "IsValidForAdvancedFind": case "CanBeSecuredForCreate": case "CanBeSecuredForRead": case "CanBeSecuredForUpdate": case "IsCustomAttribute": case "IsPrimaryId": case "IsPrimaryName": case "IsSecured": case "IsValidForCreate": case "IsValidForRead": case "IsValidForUpdate": case "IsCustomRelationship": case "CanBeBasic": case "CanBeDeep": case "CanBeGlobal": case "CanBeLocal": return n.firstChild.nodeValue === "true" ? !0 : !1; case "Value": return n.firstChild.nodeValue === "true" || n.firstChild.nodeValue == "false" ? n.firstChild.nodeValue == "true" ? !0 : !1 : n.firstChild.nodeValue == "ApplicationRequired" || n.firstChild.nodeValue == "None" || n.firstChild.nodeValue == "Recommended" || n.firstChild.nodeValue == "SystemRequired" ? n.firstChild.nodeValue : parseInt(n.firstChild.nodeValue, 10); default: return n.firstChild.nodeValue } } if (oi(e(n))) { for (u = [], t = 0; t < n.childNodes.length; t++) h = n.childNodes[t].attributes != null && n.childNodes[t].attributes.getNamedItem("i:type") != null ? n.childNodes[t].attributes.getNamedItem("i:type").nodeValue.split(":")[1] : e(n.childNodes[t]), f = o(n.childNodes[t]), f._type = h, u.push(f); return u } if (n.childNodes.length == 0) return null; for (r = {}, n.attributes.getNamedItem("i:type") != null && (r._type = n.attributes.getNamedItem("i:type").nodeValue.split(":")[1]), i = 0; i < n.childNodes.length; i++) r[e(n.childNodes[i])] = n.childNodes[i].nodeType == 3 ? n.childNodes[i].nodeValue : o(n.childNodes[i]); return r }, si = function (r, u, f) { var s, e, c, h; for (r = i(r) ? r : [r], s = "", e = 0; e < r.length; e++) s += n(r[e]) + " "; return c = ['<request i:type="a:RetrieveAllEntitiesRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts">', '<a:Parameters xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic">', "<a:KeyValuePairOfstringanyType>", "<b:key>EntityFilters<\/b:key>", '<b:value i:type="c:EntityFilters" xmlns:c="http://schemas.microsoft.com/xrm/2011/Metadata">' + n(s) + "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<a:KeyValuePairOfstringanyType>", "<b:key>RetrieveAsIfPublished<\/b:key>", '<b:value i:type="c:boolean" xmlns:c="http://www.w3.org/2001/XMLSchema">' + n(u.toString()) + "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<\/a:Parameters>", '<a:RequestId i:nil="true" />', "<a:RequestName>RetrieveAllEntities<\/a:RequestName>", "<\/request>"].join(""), h = !!f, t(c, "Execute", h, function (n) { var r, t, i, u; for (r = jQuery(n).find("c\\:EntityMetadata").length != 0 ? jQuery(n).find("c\\:EntityMetadata") : jQuery(n).find("EntityMetadata"), t = [], i = 0; i < r.length; i++) u = o(r[i]), u._type = "EntityMetadata", t.push(u); if (h) f(t); else return t }) }, hi = function (r, u, f, e) { var h, s, l, c; for (r = i(r) ? r : [r], h = "", s = 0; s < r.length; s++) h += n(r[s]) + " "; return l = ['<request i:type="a:RetrieveEntityRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts">', '<a:Parameters xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic">', "<a:KeyValuePairOfstringanyType>", "<b:key>EntityFilters<\/b:key>", '<b:value i:type="c:EntityFilters" xmlns:c="http://schemas.microsoft.com/xrm/2011/Metadata">' + n(h) + "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<a:KeyValuePairOfstringanyType>", "<b:key>MetadataId<\/b:key>", '<b:value i:type="c:guid"  xmlns:c="http://schemas.microsoft.com/2003/10/Serialization/">' + n("00000000-0000-0000-0000-000000000000") + "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<a:KeyValuePairOfstringanyType>", "<b:key>RetrieveAsIfPublished<\/b:key>", '<b:value i:type="c:boolean" xmlns:c="http://www.w3.org/2001/XMLSchema">' + n(f.toString()) + "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<a:KeyValuePairOfstringanyType>", "<b:key>LogicalName<\/b:key>", '<b:value i:type="c:string" xmlns:c="http://www.w3.org/2001/XMLSchema">' + n(u) + "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<\/a:Parameters>", '<a:RequestId i:nil="true" />', "<a:RequestName>RetrieveEntity<\/a:RequestName>", "<\/request>"].join(""), c = !!e, t(l, "Execute", c, function (n) { var r, t, i, u; for (r = jQuery(n).find("b\\:value").length != 0 ? jQuery(n).find("b\\:value") : jQuery(n).find("value"), t = [], i = 0; i < r.length; i++) u = o(r[i]), u._type = "EntityMetadata", t.push(u); if (c) e(t); else return t }) }, ci = function (i, r, u, f) { var s = ['<request i:type="a:RetrieveAttributeRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts">', '<a:Parameters xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic">', "<a:KeyValuePairOfstringanyType>", "<b:key>EntityLogicalName<\/b:key>", '<b:value i:type="c:string" xmlns:c="http://www.w3.org/2001/XMLSchema">' + n(i) + "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<a:KeyValuePairOfstringanyType>", "<b:key>MetadataId<\/b:key>", '<b:value i:type="ser:guid"  xmlns:ser="http://schemas.microsoft.com/2003/10/Serialization/">' + n("00000000-0000-0000-0000-000000000000") + "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<a:KeyValuePairOfstringanyType>", "<b:key>RetrieveAsIfPublished<\/b:key>", '<b:value i:type="c:boolean" xmlns:c="http://www.w3.org/2001/XMLSchema">' + n(u.toString()) + "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<a:KeyValuePairOfstringanyType>", "<b:key>LogicalName<\/b:key>", '<b:value i:type="c:string"   xmlns:c="http://www.w3.org/2001/XMLSchema">' + n(r) + "<\/b:value>", "<\/a:KeyValuePairOfstringanyType>", "<\/a:Parameters>", '<a:RequestId i:nil="true" />', "<a:RequestName>RetrieveAttribute<\/a:RequestName>", "<\/request>"].join(""), e = !!f; return t(s, "Execute", e, function (n) { var r, t, i, u; for (r = jQuery(n).find("b\\:value").length != 0 ? jQuery(n).find("b\\:value") : jQuery(n).find("value"), t = [], i = 0; i < r.length; i++) u = o(r[i]), t.push(u); if (e) f(t); else return t }) }; return { BusinessEntity: u, Execute: at, Fetch: h, Retrieve: vt, RetrieveMultiple: yt, Create: ht, Update: ct, Delete: lt, QueryByAttribute: pt, QueryAll: wt, SetState: bt, Associate: kt, Disassociate: dt, Assign: ii, RetrievePrincipalAccess: ei, GrantAccess: ri, ModifyAccess: ui, RevokeAccess: fi, GetCurrentUserId: gt, GetCurrentUserBusinessUnitId: ni, GetCurrentUserRoles: d, IsCurrentUserRole: ti, RetrieveAllEntitiesMetadata: si, RetrieveEntityMetadata: hi, RetrieveAttributeMetadata: ci } }(); XrmServiceToolkit.Extension = function () { var i = function (n, t) { function i(n) { var t = Xrm.Page.data.entity.getEntityName().toString().toLowerCase(), i = jQuery("entity[name=" + t + "]", n); jQuery(i).children().each(function () { var n = jQuery(this).attr("name"), i = jQuery(this).find("shorthelp").text(); r(t, n, i) }) } function r(n, i, r) { var u = jQuery("#" + i + "_c").children(":first"), f; u != null && (f = '<img id="img_' + i + '" src="/_imgs/ico/16_help.gif" alt="' + r + '" width="16" height="16" /><div id="help_' + i + '" style="visibility: hidden; position: absolute;">: ' + r + "<\/div>", jQuery(u).append(f), jQuery("#img_" + i).css("display", t ? "inline" : "none")) } if (Xrm.Page.ui.setFormNotification !== undefined) { alert("XrmServiceToolkit.Extension.JQueryXrmFieldTooltip is not supported in CRM2013.\nPlease use the out of box functionality"); return } if (typeof jQuery == "undefined") { alert("jQuery is not loaded.\nPlease ensure that jQuery is included\n as web resource in the form load."); return } jQuery.support.cors = !0; jQuery.ajax({ type: "GET", url: "../WebResources/" + n, dataType: "xml", success: i, error: function () { alert("Something is wrong to setup the tooltip for the fields. Please contact your administrator") } }) }, t = function (n) { function i(n) { for (var o, i, s, u, f, h, e, c, a, p, w, b = Xrm.Page.data.entity.getEntityName().toString().toLowerCase(), k = jQuery("entity[name=" + b + "]", n), v = k.children("ParentField"), y = [], l = 0; l < v.length; l++) { for (o = v[l], i = {}, i.parent = jQuery(o).attr("id"), i.dependent = jQuery(o).children("DependentField:first").attr("id"), i.options = [], s = jQuery(o).children("Option"), u = 0; u < s.length; u++) { for (f = {}, f.value = jQuery(s[u]).attr("value"), f.showOptions = [], h = jQuery(s[u]).children("ShowOption"), e = 0; e < h.length; e++) c = {}, c.value = jQuery(h[e]).attr("value"), c.text = jQuery(h[e]).attr("label"), f.showOptions.push(c); i.options.push(f) } y.push(i) } t.config = y; for (a in t.config) p = t.config[a].parent, w = t.config[a].dependent, r(p, w, t) } function r(n, t, i) { var l, e, y, s, o, p, h, c, w, b; for (l in i.config) if (e = i.config[l], e.parent === n && e.dependent === t) { var a = Xrm.Page.data.entity.attributes.get(n), r = Xrm.Page.data.entity.attributes.get(t), k = Xrm.Page.getControl(n), d = Xrm.Page.getControl(t), v = r.getValue(), u, f; if (a.getValue() === null) { r.setValue(null); r.setSubmitMode("always"); r.fireOnChange(); u = r.controls.get(); for (f in u) u[f].setDisabled(!0); return } for (y in e.options) if (s = e.options[y], o = s.showOptions, a.getValue() === s.value) { u = r.controls.get(); for (f in u) { u[f].setDisabled(!1); u[f].clearOptions(); for (p in o) u[f].addOption(o[p]) } h = !1; c = o; for (w in c) if (b = c[w].value, v === b) { h = !0; break } h ? r.setValue(v) : r.setValue(null); r.setSubmitMode("always"); r.fireOnChange(); k.getDisabled() === !0 && d.setDisabled(!0); break } } } if (typeof jQuery == "undefined") { alert("jQuery is not loaded.\nPlease ensure that jQuery is included\n as web resource in the form load."); return } jQuery.support.cors = !0; jQuery.ajax({ type: "GET", url: "../WebResources/" + n, dataType: "xml", success: i, error: function () { alert("Something is wrong to setup the dependent picklist. Please contact your administrator") } }) }, n = function (t) { function r(t) { for (var o, e, s, a, w, h, f, v, b, k = Xrm.Page.data.entity.getEntityName().toString().toLowerCase(), d = jQuery("entity[name=" + k + "]", t), y = d.children("TargetField"), p = [], c = 0; c < y.length; c++) o = y[c], e = {}, e.target = jQuery(o).attr("id"), e.entityName = jQuery(o).attr("viewentity"), e.viewName = jQuery(o).attr("viewname"), e.dynamic = jQuery(o).children("dynamic").children(), e.fetchXml = i(jQuery(o).children("fetch")), e.layoutXml = i(jQuery(o).children("grid")), p.push(e); n.config = p; for (s in n.config) { var g = n.config[s].target, nt = n.config[s].entityName, tt = n.config[s].viewName, r = n.config[s].dynamic, l = n.config[s].fetchXml, it = n.config[s].layoutXml; if (r != null) for (a = 0; a < r.length; a++) { if (w = Xrm.Page.getControl(jQuery(r).attr("name")).getControlType(), h = jQuery(r).attr("fieldvaluetype"), Xrm.Page.getAttribute(jQuery(r).attr("name")).getValue() === null) { alert(jQuery(r).attr("name") + " does not have a value. Please put validation logic on the field change to call this function. Only use XrmServiceToolkit.Extension.JQueryXrmCustomFilterView when the field has a value."); return } f = null; switch (w) { case "standard": f = Xrm.Page.getAttribute(jQuery(r).attr("name")).getValue(); break; case "optionset": f = h != null && h === "label" ? Xrm.Page.getAttribute(jQuery(r).attr("name")).getSelectionOption().text : Xrm.Page.getAttribute(jQuery(r).attr("name")).getValue(); break; case "lookup": f = h != null && h === "name" ? Xrm.Page.getAttribute(jQuery(r).attr("name")).getValue()[0].name : Xrm.Page.getAttribute(jQuery(r).attr("name")).getValue()[0].id; break; default: alert(jQuery(r).attr("name") + " is not supported for filter lookup view. Please change the configuration.") } if (v = jQuery(r).attr("operator"), v === null) { alert("operator is missing in the configuration file. Please fix the issue"); return } b = jQuery(r).attr("fetchnote"); switch (v.toLowerCase()) { case "contains": case "does not contain": f = "%" + f + "%"; break; case "begins with": case "does not begin with": f = f + "%"; break; case "ends with": case "does not end with": f = "%" + f; break; default: f = f } l = l.replace(b, f) } u(g, nt, tt, l, it) } } function u(n, t, i, r, u) { Xrm.Page.getControl(n).addCustomView("{1DFB2B35-B07C-44D1-868D-258DEEAB88E2}", t, i, r, u, !0) } function i(n) { try { if (n != null && n.length > 0) return window.ActiveXObject ? n[0].xml : (new XMLSerializer).serializeToString(n[0]) } catch (t) { alert("Cannot convert the XML to a string.") } return "" } if (typeof jQuery == "undefined") { alert("jQuery is not loaded.\nPlease ensure that jQuery is included\n as web resource in the form load."); return } jQuery.support.cors = !0; jQuery.ajax({ type: "GET", url: "../WebResources/" + t, dataType: "xml", success: r, error: function () { alert("Something is wrong to setup the custom filter view. Please contact your administrator") } }) }, r = function (n, t) { var i, r, u; if (Xrm.Page.ui.setFormNotification !== undefined) { alert("XrmServiceToolkit.Extension.JQueryXrmFormatNotesControl is not supported in CRM2013"); return } if (typeof jQuery == "undefined") { alert("jQuery is not loaded.\nPlease ensure that jQuery is included\n as web resource in the form load."); return } (jQuery.support.cors = !0, i = jQuery("#notescontrol"), i !== null && i !== undefined) && (r = i.attr("url"), r != null ? (n ? t || (r = r.replace("EnableInlineEdit=true", "EnableInlineEdit=false")) : r = r.replace("EnableInsert=true", "EnableInsert=false"), i.attr("url", r)) : (u = i.attr("src"), u != null && (n ? t || (u = u.replace("EnableInlineEdit=true", "EnableInlineEdit=false")) : u = u.replace("EnableInsert=true", "EnableInsert=false"), i.attr("src", u)))) }; return { JQueryXrmFieldTooltip: i, JQueryXrmDependentOptionSet: t, JQueryXrmCustomFilterView: n, JQueryXrmFormatNotesControl: r } }(); __extends = this.__extends || function (n, t) { function r() { this.constructor = n } for (var i in t) t.hasOwnProperty(i) && (n[i] = t[i]); r.prototype = t.prototype; n.prototype = new r }, function (n) { function b(t, i, r, u, f, e, o, s) { t.execute(function (n) { for (var h, c = u, o = 0; o < i.length; o++) h = i[o], s && s(h), l(t, h, r, u, f, e); n() }, function () { return o(n.where(i, function (n) { return n.changeFailed }).length == 0) }, function () { return o(!1) }) } function l(n, t, i, r, u, f) { var e = t, o = function (n) { n ? (e.isAdded && (t[r] = n), t.hasOwnProperty("changeFailed") && (e.changeFailed = !1, delete e.changeFailed)) : e.changeFailed = !0 }; e.isAdded ? n.create(t, i, o) : e.isDeleted ? n.change(i, t[r], u, f, o) : e.isModified && n.update(t, i, t[r], o) } function k(n) { var t = n; t.isAdded = !0 } function d(n) { var t = n; t.isAdded || (t.isModified = !0) } function g(n) { var t = n, i = t.isAdded; return t.isDeleted = !0, i } function nt(n) { var t = n; return t.isAdded ? AppUI.icons.add : t.isModified ? AppUI.icons.edit : t.isDeleted ? AppUI.icons.remove : "" } function tt(n, t) { for (var f, i, r = [], u = 0; u < arguments.length - 2; u++) r[u] = arguments[u + 2]; return f = n[t], i = r.pop(), i && $.isArray(i) ? r = r.concat(i) : i && r.push(i), f.apply(n, i) } function it(n, t, i, r) { typeof r == "undefined" && (r = "_observe"); var f = i + r, u = n[f]; return typeof u != "function" && (n[f] = u = ko.observable(t[i]), u.subscribe(function (n) { t[i] = n })), u } function rt(n, t, i) { typeof i == "undefined" && (i = ""); var r = ko.observable(n[t]); return r.subscribe(function (r) { i && f(n, i, !0); f(n, t, r) }), r } function ut(n, t) { return typeof n[t] != "function" && (n[t] = ko.observable(n[t])), n[t] } function f(n, t, i) { typeof n[t] == "function" ? n[t](i) : n[t] = i } function ft(n, t) { for (var r = [], i = 0; i < n.length; i++) r.push(t(n[i])); return r } function a(n, t) { for (var r = [], i = 0; i < n.length; i++) t(n[i]) && r.push(n[i]); return r } function et(n, t) { for (var u, i, f = [], r = 0; r < n.length; r++) for (u = t(n[r]) || [], i = 0; i < u.length; i++) f.push(u[i]); return f } function ot(n, t, i) { for (var f, r, e = [], o = {}, u = 0; u < n.length; u++) f = n[u], r = f[t], o[r] || (e.push({ Group: i ? i(f) : r, Items: a(n, function (n) { return n[t] == r }) }), o[r] = !0); return e } function st(n, t, i) { return n.slice(0).sort(function (n, r) { var u = t(n), f = t(r); return u > f ? i ? -1 : 1 : u < f ? i ? 1 : -1 : 0 }) } function v(n, t) { for (var u = [], f = {}, i = 0; i < n.length; i++) { var r = n[i], e = t ? t(r) : r; f[e] || (u.push(r), f[e] = !0) } return u } function ht(n) { return Math.min.apply(Math, n) } function ct(n) { return Math.max.apply(Math, n) } function t(n) { try { if (n) { if (typeof n == "object") return n; if (n.indexOf("/Date(") == 0) return new Date(parseInt(n.substr(6))); var t = new Date(n); return t.toString().indexOf("Invalid") > -1 ? null : t } return null } catch (i) { return null } } function lt(n, i) { var r = t(n); return r ? y(n) + " " + p(n, i) : "" } function y(n) { var i = t(n), r, u; return i ? (r = i.getMonth() + 1, u = i.getDate(), (r < 10 ? "0" : "") + r + "/" + (u < 10 ? "0" : "") + u + "/" + i.getFullYear()) : "" } function p(n, i) { var u = t(n), f, o, s; if (!u) return ""; var r = u.getHours(), e = u.getMinutes(), h = r >= 12 ? "PM" : "AM"; return r == 0 && (r = 12), r > 12 && (r -= 12), f = r + ":" + (e < 10 ? "0" : "") + e + " " + h, i ? (o = $.datepicker.parseTime("h:mm tt", f), s = $.datepicker.formatTime("HHmm", o), s) : f } function at(n, i) { n = t(n); i = t(i); return Math.round((i.getTime() - n.getTime()) / 864e5) } function vt(n, i) { n = t(n); i = t(i); return Math.round((i.getTime() - n.getTime()) / 6e4) } function yt(t, i) { return isNaN(t) ? "" : t == n.ZERO ? "0" : (i > 0 && (t = (+t).toFixed(i).toString()), t === 0 || t == "0") ? "" : t ? (t = t.toString(), t = t.indexOf(".") > -1 ? t.replace(/^0+|0+$/g, "") : t.replace(/^0+/g, ""), t.indexOf(".") == 0 && (t = "0" + t), t.indexOf(".") == t.length - 1 && (t = t.replace(".", "")), t === 0 || t == "0") ? "" : t : "" } function pt() { var n = (new Date).getTime(); return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (t) { var i = (n + Math.random() * 16) % 16 | 0; return n = Math.floor(n / 16), (t == "x" ? i : i & 7 | 8).toString(16) }) } function wt(n) { var t = 0, i, r; if (n) for (i = 0; i < n.length; i++) r = n.charCodeAt(i), t = (t << 5) - t + r, t = t & t; return t } var e, r, w, o, u, i, s, h, c; n.ZERO = "00"; e = function () { function n(n) { this.DataAccess = r.create(n) } return n }(); n.Model = e; r = function () { function n() { } return n.create = function (t) { if (n.DataAccessType) return t ? new CachedData.CachedDataAccess(t, new n.DataAccessType) : new n.DataAccessType; throw new Error("DataAccessFactory Error: no type was specified for IDataAccess"); }, n }(); n.DataAccessFactory = r, function (n) { n[n.Contains = 0] = "Contains"; n[n.StartsWith = 1] = "StartsWith"; n[n.Equals = 2] = "Equals"; n[n.NotEquals = 3] = "NotEquals"; n[n.GreaterThan = 4] = "GreaterThan"; n[n.LessThan = 5] = "LessThan"; n[n.In = 6] = "In"; n[n.NotIn = 7] = "NotIn"; n[n.OnOrBefore = 8] = "OnOrBefore"; n[n.OnOrAfter = 9] = "OnOrAfter"; n[n.Null = 10] = "Null"; n[n.NotNull = 11] = "NotNull"; n[n.IsOwner = 12] = "IsOwner" }(n.ExpressionOperator || (n.ExpressionOperator = {})); w = n.ExpressionOperator; o = function () { function n(n) { this.expression = n; this.PageNumber = 1 } return n.prototype.next = function (n) { this.HasNextPage && (this.PageNumber += 1, this.expression.QueryProvider.execute(this.expression, n, this)) }, n }(); n.PagingContext = o; u = function () { function n(n, t, i) { this.EntityName = n; this.QueryProvider = t; this.PropertyNames = []; this.Constraints = []; this.OrExpressions = []; this.Joins = []; this.Orders = []; this.PageSize = 1e3; this.RootExpression = this; this.DeferredExecutionContainer = i } return n.prototype.select = function () { for (var n = [], t = 0; t < arguments.length - 0; t++) n[t] = arguments[t + 0]; return $.isArray(n[0]) && (n = n[0]), this.PropertyNames = v(this.PropertyNames.concat(n)), this }, n.prototype.where = function (n, t) { for (var i = [], r = 0; r < arguments.length - 2; r++) i[r] = arguments[r + 2]; return $.isArray(i[0]) && (i = i[0]), this.Constraints.push({ PropertyName: n, Operator: t, Values: i }), this }, n.prototype.or = function (t) { var i = new n(this.EntityName, this.QueryProvider); return i.RootExpression = this.RootExpression, this.OrExpressions.push(i), t(i), this }, n.prototype.orderBy = function (n, t) { return this.Orders.push({ PropertyName: n, SortDescending: t }), this }, n.prototype.outer = function (n, t, r) { var u = new i(n, t, r, this.RootExpression, this.QueryProvider); return this.RootExpression.Joins.push(u), u }, n.prototype.join = function (n, t, r) { var u = new i(n, t, r, this.RootExpression, this.QueryProvider); return this.Joins.push(u), u }, n.prototype.execute = function (n) { var t = this; if (this.RootExpression.DeferredExecutionContainer && this.PageSize == 1e3) this.RootExpression.DeferredExecutionContainer.execute(function (i) { t.QueryProvider.execute(t.RootExpression, function (t) { n(t); i(t) }) }); else return this.QueryProvider.execute(this.RootExpression, n) }, n.prototype.pageSize = function (n) { return this.PageSize = n, this }, n }(); n.Expression = u; i = function (n) { function t(t, i, r, u, f) { n.call(this, t, f); this.FromProperty = i; this.ToProperty = r; this.RootExpression = u } return __extends(t, n), t }(u); n.JoinExpression = i; s = function () { function t() { this.cachedData = {} } return t.prototype.generateKey = function () { for (var t = [], i = 0; i < arguments.length - 0; i++) t[i] = arguments[i + 0]; return $.isArray(t[0]) && (t = t[0]), n.getHashCode(t.join("")).toString() }, t.prototype.clear = function () { this.cachedData = {} }, t.prototype.resetData = function (n) { this.cachedData[n] = null }, t.prototype.getData = function (n) { return this.cachedData[n] }, t.prototype.listData = function (n) { var t = []; for (var i in this.cachedData) (!n || n(i)) && t.push(this.cachedData[i]); return t }, t.prototype.storeData = function (n, t) { this.cachedData[n] = t }, t }(); n.InMemoryDataCache = s; h = function () { function t(n) { this.storageId = n } return t.prototype.generateKey = function () { for (var t = [], i = 0; i < arguments.length - 0; i++) t[i] = arguments[i + 0]; return $.isArray(t[0]) && (t = t[0]), n.getHashCode(t.join("")).toString() }, t.prototype.clear = function () { this.localData = {}; this.setStorage() }, t.prototype.resetData = function (n) { this.getStorage(); this.localData[n] = null; this.setStorage() }, t.prototype.getData = function (n) { return this.getStorage(), this.localData[n] }, t.prototype.listData = function (n) { var t, i; this.getStorage(); t = []; for (i in this.localData) (!n || n(i)) && t.push(this.localData[i]); return t }, t.prototype.storeData = function (n, t) { this.getStorage(); this.localData[n] = t; this.setStorage() }, t.prototype.getStorage = function () { if (!this.localData) { var n = localStorage.getItem(this.storageId); this.localData = n ? JSON.parse(n) : {} } }, t.prototype.setStorage = function () { localStorage.setItem(this.storageId, JSON.stringify(this.localData)) }, t }(); n.LocalStorageDataCache = h; c = function () { function n() { } return n.prototype.execute = function (n, t, i) { var u, r, f; if (this.isExecuting) this.deferredOperations.push(n); else if (t) { this.deferredOperations = []; this.isExecuting = !0; n(function () { }); u = []; try { for (r = 0; r < this.deferredOperations.length; r++) f = $.Deferred(), this.deferredOperations[r](f.resolve), u.push(f) } catch (e) { if (i) i(e.toString()); else throw e; } $.when.apply(null, u).then(function () { return t(arguments) }); this.isExecuting = !1 } else n(function () { }) }, n }(); n.DeferredExecutionContainer = c; n.processChanges = b; n.processChange = l; n.changeAdded = k; n.changeModified = d; n.changeRemoved = g; n.changeIcon = nt; n.invoke = tt; n.observe = it; n.modifier = rt; n.makeObservable = ut; n.setObservable = f; n.select = ft; n.where = a; n.many = et; n.group = ot; n.sort = st; n.distinct = v; n.min = ht; n.max = ct; n.parseDate = t; n.formatDateTime = lt; n.formatDate = y; n.formatTime = p; n.daysApart = at; n.minutesApart = vt; n.formatNumber = yt; n.createId = pt; n.getHashCode = wt }(AppData || (AppData = {})); Function.prototype.bind || (Function.prototype.bind = function (n) { var i = this, t = Array.prototype.slice, r = t.call(arguments, 1); return function () { return i.apply(n, r.concat(t.call(arguments))) } }), function (n) { var i = function () { function n(n, i) { this.cache = n; this.DataAccess = i; this.QueryProvider = new t(this.cache, i.QueryProvider) } return n.prototype.execute = function (n, t, i) { this.DataAccess.execute(n, t, i) }, n.prototype.single = function (n, t, i) { var f = this, r = this.cache.generateKey(n, t), u = this.cache.getData(r); u ? i(u) : this.DataAccess.single(n, t, function (n) { f.cache.storeData(r, n); i(n) }) }, n.prototype.create = function (n, t, i) { this.cache.clear(t); this.DataAccess.create(n, t, i) }, n.prototype.update = function (n, t, i, r) { var u = this.cache.generateKey(t, i); this.cache.resetData(u); this.DataAccess.update(n, t, i, r) }, n.prototype.change = function (n, t, i, r, u) { var f = this.cache.generateKey(n, t); this.cache.resetData(f); this.DataAccess.change(n, t, i, r, u) }, n.prototype.query = function (n) { return new AppData.Expression(n, this.QueryProvider) }, n.prototype.optionset = function (n, t, i, r) { this.DataAccess.optionset(n, t, i, r) }, n.prototype.booleanOptions = function (n, t, i, r) { this.DataAccess.booleanOptions(n, t, i, r) }, n }(), t; n.CachedDataAccess = i; t = function () { function n(n, t) { this.cache = n; this.QueryProvider = t } return n.prototype.execute = function (n, t, i) { var e = this, f = [], r, u; return this.addEntityNames(n, f), r = this.cache.generateKey(f), u = this.cache.getData(r), u ? (t(u), i) : this.QueryProvider.execute(n, function (n) { e.cache.storeData(r, n); t(n) }, i) }, n.prototype.addEntityNames = function (n, t) { t.push(n.EntityName); for (var i = 0; i < n.Joins.length; i++) this.addEntityNames(n.Joins[i], t) }, n }(); n.CachedQueryProvider = t }(CachedData || (CachedData = {})); __extends = this.__extends || function (n, t) { function r() { this.constructor = n } for (var i in t) t.hasOwnProperty(i) && (n[i] = t[i]); r.prototype = t.prototype; n.prototype = new r }, function (n) { function r() { return typeof Xrm != "undefined" || typeof parent.Xrm != "undefined" } function u() { return parent.Xrm.Page.context.getUserId() } var t, i; n.inCrm = r; n.getCurrentUserId = u; n.MetadataCache = new AppData.InMemoryDataCache; t = function (t) { function r() { t.call(this); this.QueryProvider = new i } return __extends(r, t), r.prototype.single = function (n, t, i) { this.execute(function (u) { XrmServiceToolkit.Soap.Retrieve(n, t, null, function (n) { var t = r.MapEntity(n); i(t); u(t) }) }) }, r.prototype.create = function (n, t, i) { var r = this; this.execute(function (u) { r.createEntity(t, function (t) { var f = r.applyChanges(t, n); f ? XrmServiceToolkit.Soap.Create(f, function (n) { i(n); u(n) }) : (i(""), u("")) }) }) }, r.prototype.update = function (n, t, i, u) { var f = this; this.execute(function (e) { f.createEntity(t, function (o) { XrmServiceToolkit.Soap.Retrieve(t, i, null, function (t) { var h = r.MergeEntities(o, t), s = f.applyChanges(h, n); s ? (s.id = i, XrmServiceToolkit.Soap.Update(s, function () { u(i); e(i) })) : (u(i), e(i)) }) }) }) }, r.prototype.change = function (n, t, i, r, u) { this.execute(function (f) { XrmServiceToolkit.Soap.SetState(n, t, i, r, function () { u(!0); f(!0) }) }) }, r.prototype.assign = function (n, t, i, r, u) { this.execute(function (f) { XrmServiceToolkit.Soap.Assign(n, t, i, r, function () { u(!0); f(!0) }) }) }, r.prototype.query = function (n) { return new AppData.Expression(n, this.QueryProvider, this) }, r.prototype.fetch = function (n, t) { XrmServiceToolkit.Soap.Fetch(n, null, function (n) { t(n) }) }, r.prototype.optionset = function (n, t, i, r) { var u = this; this.execute(function (f) { u.getEntityMetadata(n, function (n) { var u = null, e; n.length > 0 && (e = AppData.where(n, function (n) { return n.LogicalName == t })[0], e && (u = AppData.select(e.OptionSet.Options, function (n) { var i = n.Label && n.Label.UserLocalizedLabel || { Label: t + "_" + n.Value }, r = n.Description && n.Description.UserLocalizedLabel || { Label: "" }; return { Text: i.Label, Description: r.Label, Value: n.Value } }))); u == null && (u = i ? AppUI.listMap(i) : []); r(u); f(u) }) }) }, r.prototype.booleanOptions = function (n, t, i, r) { var u = this; this.execute(function (f) { u.getEntityMetadata(n, function (n) { var e = [], u, o, s; n.length > 0 && (u = AppData.where(n, function (n) { return n.LogicalName == t })[0], u && u.OptionSet.TrueOption && u.OptionSet.FalseOption && (o = { Text: u.OptionSet.TrueOption.Label.UserLocalizedLabel.Label, Value: Boolean(u.OptionSet.TrueOption.Value) }, s = { Text: u.OptionSet.FalseOption.Label.UserLocalizedLabel.Label, Value: Boolean(u.OptionSet.FalseOption.Value) }, i ? (e.push(o), e.push(s)) : (e.push(s), e.push(o)))); r(e); f(e) }) }) }, r.prototype.soapExecuteRequest = function (n, t, i) { this.execute(function (r) { var u = []; u.push('<request xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts">'); u.push('<a:Parameters xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic">'); $.each(t, function (n, t) { t.type == "a:EntityReference" ? (u.push("<a:KeyValuePairOfstringanyType>"), u.push("<b:key>" + n + "<\/b:key>"), u.push('<b:value i:type="' + t.type + '">'), u.push("<a:Id>" + t.value + "<\/a:Id>"), u.push("<a:LogicalName>" + t.logicalName + "<\/a:LogicalName>"), u.push('<a:Name i:nil="true" />'), u.push("<\/b:value>"), u.push("<\/a:KeyValuePairOfstringanyType>")) : (u.push("<a:KeyValuePairOfstringanyType>"), u.push("<b:key>" + n + "<\/b:key>"), u.push('<b:value i:type="' + t.type + '" xmlns:c="http://www.w3.org/2001/XMLSchema">' + t.value + "<\/b:value>"), u.push("<\/a:KeyValuePairOfstringanyType>")) }); u.push("<\/a:Parameters>"); u.push('<a:RequestId i:nil="true" />'); u.push("<a:RequestName>" + n + "<\/a:RequestName>"); u.push("<\/request>"); XrmServiceToolkit.Soap.Execute(u.join(""), function (n) { var t = {}, u = $(n).find("a\\:Results a\\:KeyValuePairOfstringanyType"); u.each(function (n, i) { var r = $(i), u = r.find("b\\:key").text(), f = r.find("b\\:value").text(); t[u] = f }); i(t); r(t) }) }) }, r.prototype.getEntityMetadata = function (n, t) { r.GetEntityMetadata(n, t) }, r.MapEntity = function (n) { var r = {}, i, t; for (i in n.attributes) t = n.attributes[i], t.type == "EntityReference" ? (r[i] = t.id, r[i + "_name"] = t.name) : t.type == "OptionSetValue" ? (r[i] = t.value, r[i + "_label"] = t.formattedValue) : r[i] = t.type == "boolean" ? t.value : t.type == "dateTime" ? t.value : t.type == "int" || t.type == "decimal" || t.type == "double" ? t.value === 0 || t.value == "0" ? AppData.ZERO : t.value : t.formattedValue || t.value; return r }, r.MergeEntities = function (n, t) { var r = new XrmServiceToolkit.Soap.BusinessEntity(t.logicalName, t.id); for (var i in n.attributes) r.attributes[i] = t.attributes[i] || n.attributes[i]; return r }, r.GetEntityMetadata = function (t, i, r) { var u, f, e, o; typeof r == "undefined" && (r = !1); u = n.MetadataCache.generateKey(t); f = n.MetadataCache.getData(u); f ? i(f) : (e = function (t) { if (t) { var r = t[0].Attributes; n.MetadataCache.storeData(u, r); i(r) } else i([]) }, o = XrmServiceToolkit.Soap.RetrieveEntityMetadata("Attributes", t, !0, r && e), r || e(o)) }, r.prototype.createEntity = function (n, t) { var i = this; this.getEntityMetadata(n, function (r) { t(i.createEntityFromMetadata(n, r)) }) }, r.prototype.createEntityFromMetadata = function (n, t) { for (var i, r = new XrmServiceToolkit.Soap.BusinessEntity(n, ""), u = 0; u < t.length; u++) { i = t[u]; switch (i.AttributeType) { case "Picklist": case "State": case "Status": r.attributes[i.LogicalName] = { type: "OptionSetValue", value: "" }; break; case "Lookup": case "Owner": r.attributes[i.LogicalName] = { type: "EntityReference", logicalName: "", id: "00000000-0000-0000-0000-000000000000", value: "" }; break; case "Boolean": r.attributes[i.LogicalName] = { type: "boolean", value: !1 }; break; case "DateTime": r.attributes[i.LogicalName] = { type: "dateTime", value: "" }; break; case "Decimal": case "Money": r.attributes[i.LogicalName] = { type: "decimal", value: 0 }; break; case "Double": r.attributes[i.LogicalName] = { type: "double", value: 0 }; break; case "Integer": case "BigInt": r.attributes[i.LogicalName] = { type: "int", value: 0 }; break; case "Memo": case "String": r.attributes[i.LogicalName] = { type: "string", value: "" }; break; case "Uniqueidentifier": r.attributes[i.LogicalName] = { type: "guid", value: "00000000-0000-0000-0000-000000000000" } } } return r }, r.prototype.applyChanges = function (n, t) { var f = new XrmServiceToolkit.Soap.BusinessEntity(n.logicalName, n.id), e, r, u, i; for (r in t) u = n.attributes[r], i = t[r], this.IsChanged(u, i) && (e = !0, i && typeof i == "object" && (i.type == "EntityReference" || i.type == "OptionSetValue") ? f.attributes[r] = i : i == null ? f.attributes[r] = i : u && u.type == "EntityReference" ? f.attributes[r] = { type: "EntityReference", logicalName: "", id: i, value: "" } : u && (u.type == "int" || u.type == "decimal" || u.type == "double") ? i === "" ? f.attributes[r] = null : !isNaN(i) && (i || i === 0) && (f.attributes[r] = { type: u.type, value: i }) : u ? f.attributes[r] = { type: u.type, value: i } : r.indexOf("_label") != r.length - 6 && r.indexOf("_name") != r.length - 5); if (e) return f }, r.prototype.IsChanged = function (n, t) { if (n && typeof n == "object" && n.type == "EntityReference") return t && typeof t == "object" && t.type == "EntityReference" ? n.id != t.id : n.id != t; if (n && typeof n == "object" && n.type == "OptionSetValue") return t && typeof t == "object" && t.type == "OptionSetValue" ? n.value != t.value : t ? n.value != t : !1; if ((n && typeof n == "object" && n.type && (n = n.value), t && typeof t == "object" && t.type && (t = t.value), n === !0 && t === !1) || n === !1 && t === !0) return !0; if (n === !1) return t != undefined && t.toString() == "true"; if (n === !0) return t != undefined && t.toString() == "false"; if (n === 0 && t === "" || n === 0 && parseInt(t) === 0) return !1; if (n !== 0 && (t === 0 || t === AppData.ZERO)) return !0; if (n && typeof n == "object" && n.getTime) return t && typeof t == "object" && t.getTime ? n.toString() != t.toString() : t ? n.toString() != t : !1; var i = n && n.toString() || "", r = t && t.toString() || ""; return i !== r }, r }(AppData.DeferredExecutionContainer); n.CrmDataAccess = t; i = function () { function n() { } return n.prototype.execute = function (n, t, i) { return i || (i = new AppData.PagingContext(n)), i.HasNextPage = !1, XrmServiceToolkit.Soap.Fetch(this.formatRequest(n, i), function (n) { i.PageCookie = n; i.HasNextPage = !0 }, this.formatResponse.bind(this, t, n)), i }, n.prototype.formatRequest = function (n, t) { var i = []; return t.PageNumber > 1 ? i.push('<fetch version="1.0" output-format="xml-platform" mapping="logical" page="' + t.PageNumber + '" count="' + n.PageSize + '" paging-cookie="' + t.PageCookie + '">') : i.push('<fetch version="1.0" output-format="xml-platform" mapping="logical" count="' + n.PageSize + '">'), i.push('<entity name="' + this.xmlEncode(n.EntityName) + '">'), i.push(this.getXml(n)), i.push("<\/entity>"), i.push("<\/fetch>"), i.join("") }, n.prototype.formatResponse = function (n, i, r) { for (var e, o, f = [], u = 0; u < r.length; u++) e = r[u], o = t.MapEntity(e), f.push(o); n(f) }, n.prototype.getXml = function (n) { var r = this, t = [], i; if (this.appendNodes(t, "attribute", n.PropertyNames, function (n) { return { name: n } }), this.appendNodes(t, "order", n.Orders, function (n) { return { attribute: n.PropertyName, descending: (n.SortDescending === !0).toString() } }), n.Constraints.length > 0 && t.push(this.getFilter(n)), n.OrExpressions) for (i = 0; i < n.OrExpressions.length; i++) t.push(this.getFilter(n.OrExpressions[i], "or")); return this.appendNodes(t, "link-entity", n.Joins, function (n) { return { name: n.EntityName, from: n.FromProperty, to: n.ToProperty, alias: n.EntityName, "link-type": n.PropertyNames.length > 0 ? "outer" : "inner", xml: r.getXml(n) } }), t.join("") }, n.prototype.getFilter = function (n, t) { var u, i, f, r; if (typeof t == "undefined" && (t = "and"), u = this, i = [], i.push('<filter type="' + t + '">'), this.appendNodes(i, "condition", n.Constraints, function (n) { if (n.Operator != 12) { var t = { attribute: n.PropertyName, operator: u.getOperator(n.Operator) }; return n.Operator == 6 || n.Operator == 7 ? t.values = n.Values : t.value = n.Values[0], t } }), f = AppData.where(n.Constraints, function (n) { return n.Operator == 12 })[0], f && (i.push('<filter type="or">'), this.appendNode(i, "condition", { attribute: "ownerid", operator: "eq-userid" }), this.appendNode(i, "condition", { attribute: "ownerid", operator: "eq-userteams" }), i.push("<\/filter>")), n.OrExpressions) for (r = 0; r < n.OrExpressions.length; r++) i.push(this.getFilter(n.OrExpressions[r], "or")); return i.push("<\/filter>"), i.join("") }, n.prototype.getOperator = function (n) { switch (n) { case 0: return "like"; case 1: return "begins-with"; case 2: return "eq"; case 3: return "neq"; case 4: return "gt"; case 5: return "lt"; case 6: return "in"; case 7: return "not-in"; case 8: return "on-or-before"; case 9: return "on-or-after"; case 10: return "null"; case 11: return "not-null"; default: throw new Error("QueryExpression error: unsupported filter operator (" + n + ")"); } }, n.prototype.appendNodes = function (n, t, i, r) { var f, u; if (i) for (f = 0; f < i.length; f++) u = i[f], r && (u = r(u)), u && this.appendNode(n, t, u) }, n.prototype.appendNode = function (n, t, i) { var u = "", r, e, o, f; if (n.push("<" + t), i) for (r in i) if (r == "xml") u = i[r]; else if (r == "values" && i[r]) { for (e = i[r], o = [], f = 0; f < e.length; f++) o.push("<value>" + this.xmlEncode(e[f]) + "<\/value>"); u = o.join("") } else n.push(" " + r + '="' + this.encodeValue(i[r]) + '"'); u ? (n.push(">"), n.push(u), n.push("<\/" + t + ">")) : n.push(" />") }, n.prototype.encodeValue = function (n) { return n === 0 ? "0" : n === !0 ? "true" : n === !1 ? "false" : n ? typeof n == "object" && n.getTime ? this.encodeDate(n) : this.xmlEncode(n.toString()) : "" }, n.prototype.xmlEncode = function (n) { return n === null || typeof n != "string" ? n : (n = n.replace(/&/g, "&amp;"), n = n.replace(/\"/g, "&quot;"), n = n.replace(/\'/g, "&apos;"), n = n.replace(/</g, "&lt;"), n.replace(/>/g, "&gt;")) }, n.prototype.encodeDate = function (n) { return n.getFullYear() + "-" + this.padNumber(n.getMonth() + 1) + "-" + this.padNumber(n.getDate()) + "T" + this.padNumber(n.getHours()) + ":" + this.padNumber(n.getMinutes()) + ":" + this.padNumber(n.getSeconds()) }, n.prototype.padNumber = function (n, t) { for (typeof t == "undefined" && (t = 2), n = n && n.toString() || ""; n.length < t;) n = "0" + n; return n }, n }(); n.CrmQueryProvider = i }(CrmData || (CrmData = {})), function (n) { var i = function () { function n() { this.localData = {}; this.QueryProvider = new t(this.localData) } return n.prototype.execute = function (n, t) { n(function () { return t(arguments) }) }, n.prototype.load = function () { this.localData }, n.prototype.serialize = function () { return JSON.stringify(this.localData) }, n.prototype.single = function (n, t, i) { var r = this.localData[n + "_" + t]; i(r) }, n.prototype.create = function (n, t, i) { var r = AppData.createId(); this.localData[t + "_" + r] = n; i(r) }, n.prototype.update = function (n, t, i, r) { this.localData[t + "_" + i] = n; r(i) }, n.prototype.change = function (n, t, i, r, u) { var f = this.localData[n + "_" + t]; f ? (f.state = i, f.status = r, u(!0)) : u(!1) }, n.prototype.query = function (n) { return new AppData.Expression(n, this.QueryProvider) }, n.prototype.optionset = function (n, t, i, r) { r(AppUI.listMap(i)) }, n.prototype.booleanOptions = function (n, t, i, r) { var u = [], f = { Text: "True", Value: !0 }, e = { Text: "False", Value: !1 }; i ? (u.push(f), u.push(e)) : (u.push(e), u.push(f)); r(u) }, n }(), t; n.LocalDataAccess = i; t = function () { function n(n) { this.localData = n } return n.prototype.execute = function (n, t, i) { var r = this.getData(n); return t(r), i }, n.prototype.getData = function (n) { for (var o, i, t, c, r, s, u, h, l = n.EntityName + "_", a = this.listData(function (n) { return n.indexOf(l) == 0 }), f = this.filter(a, n), e = 0; e < n.Orders.length; e++) o = n.Orders[e], f = AppData.sort(f, function (n) { return n[o.PropertyName] }, o.SortDescending); if (n.Joins.length > 0) for (i = 0; i < n.Joins.length; i++) for (t = n.Joins[i], c = this.getData(t), r = 0; r < n.Joins.length; r++) if (s = n[r], u = AppData.where(c, function (n) { return n[t.ToProperty] == s[t.FromProperty] })[0], u) for (h in u) s[t.EntityName + "." + h] = u[h]; return f }, n.prototype.listData = function (n) { var t = []; for (var i in this.localData) (!n || n(i)) && t.push(this.localData[i]); return t }, n.prototype.filter = function (n, t) { var i = this; if (t.Constraints.length > 0) n = AppData.where(n, function (n) { return i.or(n, t) }); else if (t.OrExpressions) throw new Error("Encountered query expression with no constraints, but had an OR operator (" + t.EntityName + ")"); return n }, n.prototype.or = function (n, t) { var i = this.and(n, t.Constraints); if (i || !t.OrExpressions) return i }, n.prototype.and = function (n, t) { for (var i = 0; i < t.length; i++) if (!this.decide(n, t[i])) return !1; return !0 }, n.prototype.decide = function (n, t) { var i = (n[t.PropertyName] || "").toLowerCase(), r = (t.Values[0] || "").toLowerCase(), u, f; switch (t.Operator) { case 0: return i.indexOf(r) > -1; case 1: return i.indexOf(r) == 0; case 2: return i == r; case 3: return i != r; case 4: return i > r; case 5: return i < r; case 8: return i <= r; case 9: return i >= r; case 10: return !i; case 11: return Boolean(i); case 6: for (u = 0; u < t.Values.length; u++) if (f = (t.Values[0] || "").toLowerCase(), i == f) return !0; break; case 7: for (u = 0; u < t.Values.length; u++) if (f = (t.Values[0] || "").toLowerCase(), i == f) return !1; return !0 } }, n }(); n.LocalQueryProvider = t }(LocalData || (LocalData = {})); __extends = this.__extends || function (n, t) { function r() { this.constructor = n } for (var i in t) t.hasOwnProperty(i) && (n[i] = t[i]); r.prototype = t.prototype; n.prototype = new r }, function (n) { function r() { return "" } var t, i; n.getCurrentUserId = r; t = function (n) { function t(t) { n.call(this); this.url = t; this.QueryProvider = new i(t) } return __extends(t, n), t.prototype.single = function (n, i, r) { var u = this; this.execute(function (f) { t.request(u.url, n + "(" + i + ")", function (n) { r(n); f(n) }) }) }, t.prototype.create = function (n, i, r) { var u = this; this.execute(function (f) { t.invoke(u.url, i, n, "POST", function (n) { var t = n[i + "id"]; r(t); f(t) }) }) }, t.prototype.update = function (n, i, r, u) { var f = this; this.execute(function (e) { t.invoke(f.url, i + "(" + r + ")", n, "MERGE", function () { u(r); e(r) }) }) }, t.prototype.change = function (n, i, r, u, f) { var e = this; this.execute(function (o) { e.single(n, i, function (s) { s.state = r; s.status = u; t.invoke(e.url, n + "(" + i + ")", s, "MERGE", function () { f(!0); o(!0) }) }) }) }, t.prototype.query = function (n) { return new AppData.Expression(n, this.QueryProvider) }, t.prototype.optionset = function (n, t, i, r) { var u = this; this.execute(function () { u.getOptions(n + "_" + t + "_list", function (n) { n && n.length > 0 ? r(n) : u.getOptions(t + "_list", r) }) }) }, t.prototype.booleanOptions = function (n, t, i, r) { this.execute(function () { r([{ Text: "True", Value: 1 }, { Text: "False", Value: 0 }]) }) }, t.prototype.getOptions = function (n, t) { this.query(n).execute(t) }, t.request = function (n, t, i) { $.ajax({ url: n + "/" + t, type: "GET", dataType: "json", contentType: "application/json", success: function (n) { i(n && (n.d || n.value || n)) } }) }, t.invoke = function (n, t, i, r, u) { $.ajax({ url: n + "/" + t, data: i ? JSON.stringify(i) : null, type: r, dataType: "json", contentType: "application/json", success: function (n) { u(n && (n.d || n)) } }) }, t }(AppData.DeferredExecutionContainer); n.RestDataAccess = t; i = function () { function i(n) { this.url = n } return i.prototype.execute = function (n, i, r) { var u = this.getQuery(n); return r && (u += "$top=" + n.PageSize + "&$skip=" + (r.PageNumber - 1) * n.PageSize), t.request(this.url, u, i), r }, i.prototype.getQuery = function (n) { var t = [], i, e, r, o, s, f, u, h; if (t.push(n.EntityName + "?"), n.PropertyNames.length > 0) { for (t.push("$select="), i = 0; i < n.PropertyNames.length; i++) e = n.PropertyNames[i], t.push(e), i < n.PropertyNames.length - 1 && t.push(","); t.push("&") } if (n.Orders.length > 0) { for (t.push("$orderby="), r = 0; r < n.Orders.length; r++) o = n.Orders[r], t.push(o.PropertyName), r < n.Orders.length - 1 && t.push(","); t.push("&") } if (n.Constraints.length > 0) { if (t.push("$filter="), t.push("("), s = this.getFilters(n.Constraints), t.push(s), n.OrExpressions && n.OrExpressions.length > 0) for (f = 0; f < n.OrExpressions.length; f++) t.push(" and ("), t.push(this.getFilters(n.OrExpressions[f].Constraints, "or")), t.push(")"); t.push(")"); t.push("&") } if (n.Joins.length > 0) { for (t.push("$expand="), u = 0; u < n.Joins.length; u++) h = n.Joins[u], t.push(h.EntityName), u < n.Joins.length - 1 && t.push(","); t.push("&") } return t.join("") }, i.prototype.getFilters = function (n, t) { var r, i; for (typeof t == "undefined" && (t = "and"), r = [], i = 0; i < n.length; i++) r.push(this.getFilter(n[i])); return r.join(" " + t + " ") }, i.prototype.getFilter = function (t) { var i = this.getLiteral(t.Values[0]), r, u; if (t.Operator == 6 || t.Operator == 7) { for (r = [], r.push(encodeURIComponent("[")), u = 0; u < t.Values.length; u++) r.push(this.getLiteral(t.Values[u])); r.push(encodeURIComponent("]")); i = r.join("") } switch (t.Operator) { case 0: return "substringof(" + i + "," + t.PropertyName + ")"; case 1: return "startswith(" + t.PropertyName + "," + i + ")"; case 2: return t.PropertyName + " eq " + i; case 3: return "not " + t.PropertyName + " eq " + i; case 10: return t.PropertyName + " eq null"; case 11: return "not " + t.PropertyName + " eq null"; case 4: return t.PropertyName + " gt " + i; case 5: return t.PropertyName + " lt " + i; case 8: return t.PropertyName + " le " + i; case 9: return t.PropertyName + " ge " + i; case 12: return "createdby eq '" + n.getCurrentUserId() + "'"; case 6: return t.PropertyName + " eq " + i; case 7: return "not " + t.PropertyName + " eq " + i } return "" }, i.prototype.getLiteral = function (n) { if (n) { if (typeof n == "string" && n.indexOf("-") > -1 && n.length == 36) return n; if (typeof n == "string" && n.indexOf("{") == 0 && n.indexOf("-") > -1 && n.length == 38) return n.slice(1, -1); if (n.getTime) return n.getFullYear() + "-" + this.padNumber(n.getMonth() + 1) + "-" + this.padNumber(n.getDate()) + "T" + this.padNumber(n.getHours()) + ":" + this.padNumber(n.getMinutes()) + ":" + this.padNumber(n.getSeconds()) + "Z"; if (typeof n == "string") n = "'" + n + "'"; else return n.toString() } else return "" }, i.prototype.padNumber = function (n, t) { for (typeof t == "undefined" && (t = 2), n = n && n.toString() || ""; n.length < t;) n = "0" + n; return n }, i }(); n.RestQueryProvider = i }(RestData || (RestData = {}));